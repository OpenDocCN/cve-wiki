# Apache ActiveMQ任意文件写入漏洞（CVE-2016-3088）复现 - Zh1z3ven - 博客园

> 原文：[https://www.cnblogs.com/CoLo/p/13715531.html](https://www.cnblogs.com/CoLo/p/13715531.html)

### Apache ActiveMQ任意文件写入漏洞（CVE-2016-3088）复现

#### 一、漏洞简介

​ 2016年4月14日，国外安全研究人员 Simon Zuckerbraun 曝光 Apache ActiveMQ Fileserver 存在多个安全漏洞，可使远程攻击者用恶意代码替代Web应用，在受影响系统上执行远程代码（CVE-2016-3088）。

​ 该漏洞出现在fileserver应用中,漏洞原理:ActiveMQ中的fileserver服务允许用户通过HTTP PUT方法上传文件到指定目录。Fileserver支持写入文件(不解析jsp),但是支持移动文件(Move)我们可以将jsp的文件PUT到Fileserver下,然后再通过Move指令移动到可执行目录下访问。

#### 二、漏洞影响

漏洞影响版本：Apache ActiveMQ 5.x ~ 5.14.0

#### 三、漏洞复现

通过PUT方法上传JSP马

![image-20200922224007847](../Images/4413bca33ce794c67a21c546b6ef87b5.png)

可以看到并没有解析jsp马

![image-20200922224900423](../Images/4d0fa3cb5f156d7fabcd66377a761905.png)

此版本还可通过构造请求爆出绝对路径

![image-20200922231153506](../Images/356c7a98fc357d93f23c2881683f0800.png)

MOVE方法移动到可解析的路径下，如下图

![image-20200922225117412](../Images/ee18559deb5cb1d3e309812948bab1c3.png)

访问webshell并执行命令

访问 [http://192.168.124.128:8161/admin/1.jsp?cmd=ls](http://192.168.124.128:8161/admin/1.jsp?cmd=ls)

![image-20200922225253724](../Images/62cee7f05f8177fc55cd8b1942de92af.png)

下面尝试传个大马，并MOVE到admin目录下

请求方式改为MOVE并添加如下字段

```
Destination:file:///usr/local/apache-activemq-5.7.0/webapps/admin/1.jsp 
```

![image-20200922225653300](../Images/c51433d1e9fb95232af74347db061978.png)

![image-20200922225733586](../Images/4285b9a9703eb81c9e6a8da42400a3d4.png)

尝试访问

![image-20200922225813806](../Images/2943c82c4d745d490189a1283a82549d.png)

...大马好像回显有问题

#### 四、wireshark流量

上传马：

![image-20200922230037087](../Images/da16b8fc8fd7e45a516e43060a8941b4.png)

![image-20200922230052307](../Images/16b1267738d7ae41d6876b739eda7a6d.png)

执行命令：

ls：

![image-20200922230536358](../Images/66674955ce620655fd48eafc2b83e3ad.png)

![image-20200922230610862](../Images/baee7ac2f7cb55d93bcd5b8963207882.png)

#### 五、修复建议

​ ActiveMQ Fileserver 的功能在 5.14.0 及其以后的版本中已被移除。建议用户升级至 5.14.0 及其以后版本。

或者在不影响业务的情况下临时做如下图整改

![image-20200922231459526](../Images/f0cff8adee8b715850617bc82228b252.png)

#### 六、参考文章

[https://www.cnblogs.com/yuzly/p/11278131.html](https://www.cnblogs.com/yuzly/p/11278131.html)

[https://www.secpulse.com/archives/60064.html](https://www.secpulse.com/archives/60064.html)