# solr 远程代码执行(CVE-2019-12409) - g7y12 - 博客园

> 原文：[`www.cnblogs.com/dddjh/p/11896624.html`](https://www.cnblogs.com/dddjh/p/11896624.html)

# Apache Solr 远程代码执行漏洞（CVE-2019-12409）

# 简介

* * *

Solr 是一个独立的企业级搜索应用服务器，它对外提供类似于 Web-service 的 API 接口。是 apache 的顶级开源项目，使用 java 开发 ，基于 lucene 的全文检索服务器。

# 影响范围

Solr 8.1.1

Solr 8.2.0

# 漏洞成因

Java ManagementExtensions（JMX）是一种 Java 技术，为管理和监视应用程序、系统对象、设备（如打印机）和面向服务的网络提供相应的工具。JMX 作为 Java 的一种 Bean 管理机制，如果 JMX 服务端口暴露，那么远程攻击者可以让该服务器远程加载恶意的 Bean 文件，随着 Bean 的滥用导致远程代码执行。

# 修复方法

1、保证 Solr 集群只能被可信任端点访问；

2、启用 Solr JMX 服务身份验证；

3、关闭 Solr JMX 服务。

# 环境搭建

1、测试环境

靶机：

Linux kali 4.19.0-kali1-amd64

IP:192.168.157.138

攻击机：

Linux kali

IP:192.168.157.133

2、下载最新的 Solr

*   [`www.apache.org/dyn/closer.lua/lucene/solr/8.2.0/solr-8.2.0.zip`](https://www.apache.org/dyn/closer.lua/lucene/solr/8.2.0/solr-8.2.0.zip)

3、安装 slor 8.2.0 版本到靶机，进入到 solr-8.2.0/bin 目录下

```
~/solr-8.2.0/bin# ./solr -e dih -force 
```

安装成功后，启动服务，可正常访问网站,且 solr 版本为 8.2.0
![](img/8abbd3befdd50101d35cd51cf7865bd7.png)

# 漏洞复现

1、进入到 solr-8.2.0/bin 目录下，查看 solr.in.sh ,发现 ENABLE_REMOTE_JMX_OPTS="true"，该版本存在漏洞
![](img/652a7d7746fe0175eb9db5b3284de66e.png)

2、利用 nmap 扫描端口，确认 18983 端口开放

nmap -p 18983 -Pn -T5 -n -sC -sV 10.10.20.166 -sC -sV
![](img/85b7ee86fa06dbebdaa3ace997f549ce.png)

3、利用 msf 上 exploit/multi/misc/java_jmx_server 远程代码执行模块进行漏洞利用，成功执行代码，详情如下图。
![](img/6d5c2f22d92e12daaa702e17bb3a10c6.png)
![](img/104cdac1825c59c6d9b65c4508e6796c.png)
![](img/d59a6dd83d48ef9a364b4ee518edb0cd.png)

# 参考链接：

*   [`blog.nsfocus.net/cve-2019-12409/`](http://blog.nsfocus.net/cve-2019-12409/)
*   [`mogwailabs.de/blog/2019/04/attacking-rmi-based-jmx-services/`](https://mogwailabs.de/blog/2019/04/attacking-rmi-based-jmx-services/)
*   [`github.com/mogwailabs/mjet`](https://github.com/mogwailabs/mjet)