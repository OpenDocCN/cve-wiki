# nginx 禁用 3DES 和 DES 弱加密算法，保证 SSL 证书安全 SSL/TLS 协议信息泄露漏洞(CVE-2016-2183) - 全琪俊 - 博客园

> 原文：[`www.cnblogs.com/wjsqqj/p/17129809.html`](https://www.cnblogs.com/wjsqqj/p/17129809.html)

cp -r nginx-1.19.2 ./nginx-1.19.2.bak

查看完旧版本信息可以执行如下命令，给旧版本改个名

mv ./nginx ./nginx.old

漏洞名称

SSL/TLS 协议信息泄露漏洞(CVE-2016-2183)【原理扫描】

详细描述

TLS 是安全传输层协议，用于在两个通信应用程序之间提供保密性和数据完整性。

TLS, SSH, IPSec 协商及其他产品中使用的 DES 及 Triple DES 密码或者 3DES 及 Triple 3DES 存在大约四十亿块的生日界，这可使远程攻击者通过 Sweet32 攻击，获取纯文本数据。

{

listen 80;

listen 443 ssl https2;

#使用 HTTP/2，需要 Nginx1.9.7 以上的版本

ssl on;

server_name [`ykqi.cn`](https://link.zhihu.com/?target=http%3A//ykqi.cn) www.ykqi.cn;

index index.php index.html index.htm default.php default.htm default.html;

root /www/wwwroot/dist/ykqi;

#SSL-START SSL 相关配置，请勿删除或修改下一行带注释的 404 规则

#error_page 404/404.html;

add_header X-Frame-Options DENY;

#禁止被嵌入框架

add_header X-Content-Type-Options nosniff;

#防止在 IE9、Chrome 和 Safari 中的 MIME 类型混淆攻击

ssl_certificate /www/server/panel/vhost/ssl/1_ykqi_bundle.crt;

ssl_certificate_key /www/server/panel/vhost/ssl/2_ykqi.key;

#SSL 证书文件位置

ssl_dhparam /www/server/panel/vhost/ssl/dhparam.pem;

#DH-Key 交换**文件位置

#SSL 优化配置

ssl_protocols TLSv1 TLSv1.1 TLSv1.2;

#只允许 TLS 协议

ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

或者

我的选择

`ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!3DES:!ADH:!RC4:!DH:!DHE;`

#加密套件,这里用了 CloudFlares Internet facing SSL cipher configuration

ssl_prefer_server_ciphers on;

.......此处省略

配置完重新启动 Nginx!

通过命令： `nmap -sV --script ssl-enum-ciphers -p 443 www.example.com` 可得：

结果中 weak(柔弱的)、broken(损坏的)、strong(坚固的)字段表示加密强度，为了安全需要将 128 位以下弱加密算法禁用，Nginx 配置 SSL 需明确指定算法：

重启是`nginx.conf`配置生效