# CVE-1999-0554 | 目标主机 showmount -e 信息泄露漏洞修复 - 时光不改 - 博客园

> 原文：[`www.cnblogs.com/zhaijiahui/p/13957551.html`](https://www.cnblogs.com/zhaijiahui/p/13957551.html)

# 详细描述

可以对目标主机进行"showmount -e"操作，此操作将泄露目标主机大量敏感信息，比如目录结构。更糟糕的是，如果访问控制不严的话，攻击者有可能直接访问到目标主机上的数据。

允许指定主机通过 mount 到 nfs 服务器上，阻止其他主机通过 showmount -e 方式，泄露 NFS 共享目录结构信息。

**测试方式：**showmount -e <IP>

## 绿盟漏洞解决办法

建议您采取以下措施以降低威胁:

* 限制可以获取 NFS 输出列表的 IP 和用户。

* 除非绝对必要，请关闭 NFS 服务、MOUNTD。

# 具体实施方式

## 方式 1：修改配置文件

对共享服务器的 hosts.allow 和 hosts.deny 两个文件进行配置修改。具体修改如下：

Centos6 的 NFS 服务叫做 rpcbind，Centos5 的 NFS 服务叫 portmap。

```
/etc/hosts.allow

mountd:192.168.131.1　　　　　　　　 #cent7.0 设置方式
Portmap:192.168.131.1:allow　　　　#cent5.0 设置方式
rpcbind: 192.168.56.4:allow       #cent6.0 设置方式
```

```
/etc/hosts.deny

mountd:all                         #cent7.0 设置方式
Portmap:ALL:deny                   #cent6.0 设置方式
rpcbind: ALL : deny                #cent5.0 设置方式
```

注意：无需重启 rpc.bind 和 nfs。

## 方式 2：采用 iptables 防火墙限制

1）修改 nfs 配置文件，分配未使用的端口。

```
[root@xxxxx /]# vi /etc/sysconfig/nfs
#在文件最下面添加如下信息
RQUOTAD_PORT=30001 LOCKD_TCPPORT=30002 LOCKD_UDPPORT=30002 MOUNTD_PORT=30003 STATD_PORT=30004
```

2）重启 nfs 服务

```
/etc/init.d/rpcbind restart /etc/init.d/nfs restart
```

3）允许客户端挂载主机的 ip 地址

```
iptables -A INPUT -p tcp -s 192.168.85.15 --dport 111 -j ACCEPT
iptables -A INPUT -p udp -s 192.168.85.15 --dport 111 -j ACCEPT
iptables -A INPUT -p tcp -s 192.168.85.15 --dport 2049 -j ACCEPT
iptables -A INPUT -p udp -s 192.168.85.15 --dport 2049 -j ACCEPT
iptables -A INPUT -p tcp -s 192.168.85.15 --dport 30001:30004 -j ACCEPT
iptables -A INPUT -p udp -s 192.168.85.15 --dport 30001:30004 -j ACCEPT
```

或是

```
vi /etc/sysconfig/iptables

#下面是要添加的规则
#允许 nfs 客户端 10.194.212.132 访问本机 nfs 服务端 10.194.212.131 的相关 nfs 端口 -A INPUT -p tcp -s 10.194.212.132 --dport 111 -j ACCEPT -A INPUT -p udp -s 10.194.212.132 --dport 111 -j ACCEPT -A INPUT -p tcp -s 10.194.212.132 --dport 2049 -j ACCEPT -A INPUT -p udp -s 10.194.212.132 --dport 2049 -j ACCEPT -A INPUT -p tcp -s 10.194.212.132 --dport 30001:30004 -j ACCEPT -A INPUT -p udp -s 10.194.212.132 --dport 30001:30004 -j ACCEPT
```

4）其他客户端全部拒绝访问 nfs 服务

```
iptables -A INPUT -p tcp --dport 111 -j DROP
iptables -A INPUT -p udp --dport 111 -j DROP
iptables -A INPUT -p tcp --dport 2049 -j DROP
iptables -A INPUT -p udp --dport 2049 -j DROP
iptables -A INPUT -p tcp --dport 30001:30004 -j DROP
iptables -A INPUT -p udp --dport 30001:30004 -j DROP
```

5）开机启动服务加载

```
vim /etc/profile.d/iptables-nfs.sh #!/bin/bash
#允许客户端挂载主机的 ip 地址
iptables -A INPUT -p tcp -s 192.168.85.15 --dport 111 -j ACCEPT
iptables -A INPUT -p udp -s 192.168.85.15 --dport 111 -j ACCEPT
iptables -A INPUT -p tcp -s 192.168.85.15 --dport 2049 -j ACCEPT
iptables -A INPUT -p udp -s 192.168.85.15 --dport 2049 -j ACCEPT
iptables -A INPUT -p tcp -s 192.168.85.15 --dport 30001:30004 -j ACCEPT
iptables -A INPUT -p udp -s 192.168.85.15 --dport 30001:30004 -j ACCEPT
```

#其他客户端全部拒绝访问 nfs 服务

```
iptables -A INPUT -p tcp --dport 111 -j DROP
iptables -A INPUT -p udp --dport 111 -j DROP
iptables -A INPUT -p tcp --dport 2049 -j DROP
iptables -A INPUT -p udp --dport 2049 -j DROP
iptables -A INPUT -p tcp --dport 30001:30004 -j DROP
iptables -A INPUT -p udp --dport 30001:30004 -j DROP
```

# 参考文章：

[`www.cnblogs.com/slyy/p/12133098.html`](https://www.cnblogs.com/slyy/p/12133098.html "https://www.cnblogs.com/slyy/p/12133098.html")

[`blog.csdn.net/qq_26614295/article/details/103119982`](https://blog.csdn.net/qq_26614295/article/details/103119982 "https://blog.csdn.net/qq_26614295/article/details/103119982")