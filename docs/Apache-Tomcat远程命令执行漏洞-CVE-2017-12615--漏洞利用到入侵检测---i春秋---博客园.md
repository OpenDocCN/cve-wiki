# Apache Tomcat 远程命令执行漏洞(CVE-2017-12615) 漏洞利用到入侵检测 - i 春秋 - 博客园

> 原文：[`www.cnblogs.com/ichunqiu/p/8352505.html`](https://www.cnblogs.com/ichunqiu/p/8352505.html)

> **[本文作者：i 春秋作家——Anythin9](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)**

**1.漏洞简介**

当 Tomcat 运行在 Windows 操作系统时，且启用了 HTTP PUT 请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求数据包向服务器上传包含任意代码的 JSP 文件，JSP 文件中的[**恶意代码**](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)将能被服务器执行。导致服务器上的数据泄露或获取服务器权限。

影响范围

Apache Tomcat 7.0.0 – 7.0.81

**2.漏洞分析****2.1 环境介绍**服务端 Windows7   IP: 192.168.116.128

攻击端 Kali Linux  IP:192.168.116.137

Apache Tomcat 7.0.79

**2.2.  实验环境搭建**

**2.2.1 java 环境安装**

1.官网下载 jdk 安装包[**http://www.oracle.com/technetwork/java/javase/downloads/index.html**](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

2.根据提示安装 jdk

![1.jpg](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

3.配置路径，我的电脑->属性->高级系统设置->环境变量->ath 添加 jdk 和 jre 路径

![2.png](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

4.配置成功后如图：

![3.png](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

**2.2.2 Apache Tomcat 安装**1．下载地址：

**[`www.liangchan.net/soft/download.asp?softid=9366&downid=8&id=9430`](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)**

2.按照步骤提示，安装

![4.png](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

3.安装成功后，访问**[`127.0.0.1:8080`](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)**

![5.jpg](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

**2.2.3 配置 Apache Tomcat 服务器**1．打开 Tomcat 安装目录的 Tomcat7.0\conf\web.xml 添加如下配置，在 Tomcat7.0 版本下默认配置是开启 readonly 的，需要手动配置 readonly 为 false 才可以进行漏洞利用

![6.jpg](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

**2.3 漏洞利用**

**2.3.1 远程命令执行漏洞利用**

1.利用 PUT 方法上传构造好的 shell

![7.jpg](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

查看服务器上已经存在 test.jsp

![8.jpg](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

在构造上传方法时有三种

PUT /test.jsp%20

PUT /test.jsp/

通过构造特殊的后缀来绕过，Tomcat 的检测，将 jsp 的 shell 上传到服务器中。

2.利用上传的 shell 来进行命令执行

![9.jpg](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

攻击成功。

**2.3.2 漏洞主要攻击特征**

1.攻击方法 PUT

2.主要攻击方法 .jsp:DATA .jsp%20 .jsp/

**3．入侵检测规则编写**

**3.1 CVE-2017-12615 漏洞入侵检测规则**

alert tcp any any -> any any (msg:” CVE-2017-12615″;flow:to_server,established;content:”UT”;nocase;content:”.jsp/”;nocase;reference:cve,2017-12615;sid:2000015;rev:1;)

alert tcp any any -> any any (msg:”CVE-2017-12615″;flow:to_server,established;content:”UT”;nocase;content:”.jsp:DATA”;nocase;reference:cve,2017-12615;sid:2000015;rev:1;)

alert tcp any any -> any any (msg:”CVE-2017-12615″;flow:to_server,established;content:”UT”;nocase;content:”.jsp%20″;nocase;reference:cve,2017-12615;sid:2000015;rev:1;)

**4\. 入侵检测效果验证**

**4.1 CVE-2017-12615 漏洞入侵检测验证**

回放包 cve-2017-12615.tcap

![10.png](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

![11.png](https://bbs.ichunqiu.com/thread-33171-1-1.html?from=bkyl)

**[>>>>>>黑客入门必备技能](https://www.ichunqiu.com/zhihu?from=bkyl)   带你入坑和逗比表哥们一起聊聊黑客的事儿他们说高精尖的技术比农药都好玩**