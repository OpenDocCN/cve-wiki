# SaltStack 水平权限绕过漏洞（CVE-2020-11651） - NoCirc1e - 博客园

> 原文：[`www.cnblogs.com/NoCirc1e/p/16283224.html`](https://www.cnblogs.com/NoCirc1e/p/16283224.html)

SaltStack 是基于 Python 开发的一套 C/S 架构配置管理工具。国外某安全团队披露了 SaltStack 存在认证绕过漏洞（CVE-2020-11651）和目录遍历漏洞（CVE-2020-11652）。

在 CVE-2020-11651 认证绕过漏洞中，攻击者通过构造恶意请求，可以绕过 Salt Master 的验证逻辑，调用相关未授权函数功能，从而可以造成远程命令执行漏洞。

参考链接：

*   [`labs.f-secure.com/advisories/saltstack-authorization-bypass`](https://labs.f-secure.com/advisories/saltstack-authorization-bypass)
*   [`github.com/rossengeorgiev/salt-security-backports`](https://github.com/rossengeorgiev/salt-security-backports)
*   [`github.com/saltstack/salt/blob/a67d76b15615983d467ed81371b38b4a17e4f3b7/tests/integration/master/test_clear_funcs.py`](https://github.com/saltstack/salt/blob/a67d76b15615983d467ed81371b38b4a17e4f3b7/tests/integration/master/test_clear_funcs.py)

## 影响版本

*   SaltStack Version < 2019.2.4
*   SaltStack Version < 3000.2

## 漏洞环境

执行如下命令启动一个 SaltStack Master 服务：

```
docker-compose up -d
```

![](img/8596ba08ff0cea1d1510e3695e5e381f.png)

环境启动后，将会在本地监听如下端口：

*   4505/4506 这是 SaltStack Master 与 minions 通信的端口
*   8000 这是 Salt 的 API 端口
*   2222 这是容器内部的 SSH 服务器监听的端口

## 漏洞复现

首先我们下载 poc

```
git clone https://github.com/heikanet/CVE-2020-11651-CVE-2020-11652-EXP.git
```

![](img/1a161cedfd2987151a600a1c35df2cca.png)![](img/21ebc8bed506f6959fd2b54ffa7edae8.png)

安装好 salt 即可运行

```
apt-get update
apt install python3-pip
pip install salt
```

![](img/e9e1a8d85e919e89720cda79ed68c7cb.png)![](img/f6c1eb59391fb7b814c9870eb15c0640.png)

尝试反弹 shell

![](img/0c193f552b96b59ce0b1203c823b4ad8.png)