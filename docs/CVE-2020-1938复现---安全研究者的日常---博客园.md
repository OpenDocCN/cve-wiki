# CVE-2020-1938 复现 - 安全研究者的日常 - 博客园

> 原文：[`www.cnblogs.com/A66666/p/048ac3f5170d724b03f62531da252a20.html`](https://www.cnblogs.com/A66666/p/048ac3f5170d724b03f62531da252a20.html)

**一、漏洞描述**
       Tomcat 是 Apache 开源组织开发的用于处理 HTTP 服务的项目，两者都是免费的，都可以做为独立的 Web 服务器运行。Apache Tomcat 服务器存在文件包含漏洞，攻击者可利用该漏洞读取或包含 Tomcat 上所有 webapp 目录下的任意文件，如：webapp 配置文件或源代码等。 

## 二、漏洞危害等级

##         高

## **三、影响版本**

Apache Tomcat 6  Tomcat 7 系列  <7.0.100Tomcat 8 系列 < 8.5.51Tomcat 9 系列 <9.0.31

## **四、漏洞原理**

        tomcat 默认的 conf/server.xml 中配置了 2 个 Connector，一个为 8080 的对外提供的 HTTP 协议端口，另外一个就是默认的 8009 AJP 协议端口，两个端口默认均监听在外网 ip。![](img/7617c92cbbf03369580a0966db530f43.png)![](img/3be1b3e31cb1a8d5e0ae5959fb22fbc4.png)        tomcat 在接收 ajp 请求的时候调用 org.apache.coyote.ajp.AjpProcessor 来处理 ajp 消息，prepareRequest 将 ajp 里面的内容取出来设置成 request 对象的 Attribute 属性。可以通过此种特性从而可以控制 request 对象的下面三个 Attribute 属性 javax.servlet.include.request_urijavax.servlet.include.path_infojavax.servlet.include.servlet_path    再通过控制 ajp 控制的上述三个属性来读取文件,通过操控上述三个属性从而可以读取到应用目录下的任何文件。

## **五、漏洞复现**

    这里下载了 apache-tomcat-8.5.32 版本进行漏洞复现目前网上有多个 POC 版本流传，这里列局其中两个，还有很多的 SRC 和安全中心给了验证方法。[`github.com/nibiwodong/CNVD-2020-10487-Tomcat-Ajp-lfi-POC`](https://github.com/nibiwodong/CNVD-2020-10487-Tomcat-Ajp-lfi-POC)[`github.com/0nise/CVE-2020-1938`](https://github.com/0nise/CVE-2020-1938)![](img/66ef4b49307e93dfb84edb3ae1e5b591.png)![](img/6d74de64a96a4e92cff5b059240507d7.png)

## **六、漏洞修复**

****1.更新到安全版本**** ****Apache Tomcat 7.0.100********Apache Tomcat 8.5.51********Apache Tomcat 9.0.31********https://tomcat.apache.org/download-70.cgi********https://tomcat.apache.org/download-80.cgi********https://tomcat.apache.org/download-90.cgi********或 Github 下载：[`github.com/apache/tomcat/releases`](https://github.com/apache/tomcat/releases)********2.关闭 AJP 服务，修改 Tomcat 配置文件 Service.xml,注释掉********<Connector port="8009" protocol="AJP/1.3" redirectPort="8443" />********3、配置 ajp 配置中的 secretRequired 跟 secret 属性来限制认证**** ****<wiz_tmp_tag id="wiz-table-range-border" contenteditable="false" style="display: none">[来自为知笔记(Wiz)](http://www.wiz.cn/i/433734bc "来自为知笔记(Wiz)")</wiz_tmp_tag>****