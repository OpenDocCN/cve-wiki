# 详细分析 CVE-2011-1149 (KillingInTheNameOf) - ybdesire - 博客园

> 原文：[`www.cnblogs.com/ybdesire/p/8653128.html`](https://www.cnblogs.com/ybdesire/p/8653128.html)

# CVE-2011-1149 (KillingInTheNameOf)

这个漏洞是 2011 年发现的。利用它能让 ADB 获取 root 权限。这个漏洞存在于 Android<=2.2。

从 adb 的[源码](https://github.com/karfield/adb/blob/2096ff9a64ae8fe1f0d160870d1bb990fc914d8b/src/adb.c)中，可以看到 db 的权限由属性`ro.secure`来控制。

```
property_get("ro.secure", value, "1");
if (strcmp(value, "1") == 0) {
    // don't run as root if ro.secure is set... 
```

要让 adb 获得系统权限，就要将`ro.secure`设置为 0。

adb 运行时，`ro.secure`的值已经被写入到 adb 进程虚拟地址空间中。而低版本的 Android 系统并没有对进程地址空间中的`ro.secure`内容做读写限制。
我们可通过 linux 的`/proc/self/maps`来查看进程的虚拟地址空间是如何使用的。而`ro.secure`的值被存储在进程地址空间的`system_properties`区域。只要找到这个区域，将`ro.secure`的值改为 0，adb 就能运行在 root 权限。

所以，这个漏洞的 Vulnerability（描述）为：
Vulnerability: Android 2.3 之前的版本，没有限制 system property space（系统属性空间）的访问。

Exploit(利用这个漏洞的描述)为：
Exploit: (1) 通过 linux 的`/proc/self/maps`来查看进程的虚拟地址空间是如何使用的。找到这个区域`system_properties`，将`ro.secure`的值改为 0。(2) 重启 adb。(3) adb 运行在了 root 权限。

这个`exploit`名称为`KillingInTheNameOf`。可以从参考 3 中找到如何利用这个漏洞的源代码。这个漏洞是 Android 匿名共享内存 ashmem 机制的处理缺陷导致的。

# 参考

*   (1) p21\. [`www.slideshare.net/scovetta/android-attacks`](http://www.slideshare.net/scovetta/android-attacks)
*   (2) CVE-2011-1149\. [`cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-1149`](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-1149)
*   (3) KillingInTheNameOf. [`c-skills.blogspot.com/2011/01/adb-trickery-again.html`](http://c-skills.blogspot.com/2011/01/adb-trickery-again.html)