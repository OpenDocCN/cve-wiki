# SPRING FRAMEWORK 反射型文件下载漏洞(CVE-2020-5421) - 小泉哥 - 博客园

> 原文：[`www.cnblogs.com/penghq/p/13712899.html`](https://www.cnblogs.com/penghq/p/13712899.html)

## 一、综述

近日，VMware Tanzu 发布安全公告，公布了一个存在于 Spring Framework 中的反射型文件下载（Reflected File Download,RFD）漏洞 CVE-2020-5421。CVE-2020-5421 可通过 jsessionid 路径参数，绕过防御 RFD 攻击的保护。先前针对 RFD 的防护是为应对 CVE-2015-5211 添加的。

攻击者通过向用户发送带有批处理脚本扩展名的 URL，使用户下载并执行文件，从而危害用户系统。

官方已发布修复了漏洞的新版本。

Spring Framework 是 Java 平台的一个开源全栈应用程序框架和控制反转容器实现，一般被直接称为 Spring。

## 二、影响范围

### 受影响产品版本

*   Spring Framework 5.2.0 – 5.2.8
*   Spring Framework 5.1.0 – 5.1.17
*   Spring Framework 5.0.0 – 5.0.18
*   Spring Framework 4.3.0 – 4.3.28
*   以及其他已不受支持的版本

### 不受影响产品版本

*   Spring Framework 5.2.9
*   Spring Framework 5.1.18
*   Spring Framework 5.0.19
*   Spring Framework 4.3.29

## 三、解决方案

官方已发布修复了漏洞的新版本，建议相关用户尽快升级进行防护。

## 四、项目整改示例

涉及相关 jar 包：

![](img/254d53e19946e6191de9366baefdd2a4.png)

更换为：

![](img/a0291c583ab39302468968732ca667ac.png)

 涉及配置文件：spring-mvc.xml

```
<!-- 支持返回 json(避免 IE 在 ajax 请求时，返回 json 出现下载 ) -->
    <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter">
        <property name="messageConverters">
            <list>
            <bean class="org.springframework.http.converter.ByteArrayHttpMessageConverter"/>  
                <ref bean="mappingJacksonHttpMessageConverter"/>
            </list>
        </property>
    </bean>
    <bean id="mappingJacksonHttpMessageConverter" class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter">
        <property name="supportedMediaTypes">
            <list>
                <value>text/plain;charset=UTF-8</value>
                <value>application/json;charset=UTF-8</value>
            </list>
        </property>
    </bean>
```

更改为：

```
<!-- 支持返回 json(避免 IE 在 ajax 请求时，返回 json 出现下载 ) -->
    <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter">
        <property name="messageConverters">
            <list>
            <bean class="org.springframework.http.converter.ByteArrayHttpMessageConverter"/>  
                <ref bean="mappingJacksonHttpMessageConverter"/>
            </list>
        </property>
    </bean>
    <bean id="mappingJacksonHttpMessageConverter" class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
        <property name="supportedMediaTypes">
            <list>
                <value>text/plain;charset=UTF-8</value>
                <value>application/json;charset=UTF-8</value>
            </list>
        </property>
    </bean>
```

 完毕！