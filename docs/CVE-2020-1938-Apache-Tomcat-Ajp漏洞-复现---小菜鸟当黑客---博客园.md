# CVE-2020-1938:Apache-Tomcat-Ajp 漏洞-复现 - 小菜鸟当黑客 - 博客园

> 原文：[`www.cnblogs.com/bflw/p/12342713.html`](https://www.cnblogs.com/bflw/p/12342713.html)

### 0x00 漏洞简介

    Apache 与 Tomcat 都是 Apache 开源组织开发的用于处理 HTTP 服务的项目，两者都是免费的，都可以做为独立的 Web 服务器运行。

    Apache Tomcat 服务器存在文件包含漏洞，攻击者可利用该漏洞读取或包含 Tomcat 上所有 webapp 目录下的任意文件，如：webapp 配置文件或源代码等。

    由于 Tomcat 默认开启的 AJP 服务（8009 端口）存在一处文件包含缺陷，攻击者可构造恶意的请求包进行文件包含操作，进而读取受影响 Tomcat 服务器上的 Web 目录文件。

### 0x01 漏洞编号

    原：CNVD-2020-10487   后录入 cve CVE-2020-1938

### 0x02 漏洞影响版本

    Apache Tomcat  6

    Apache Tomcat  7 < 7.0.100

    Apache Tomcat  8 < 8.5.51

    Apache Tomcat  9 < 9.0.31

### 0x03 复现环境

   虚拟机 windows 7

    Apache tomcat 9.0.13

### 0x04 复现过程

    （一）安装 Apache tomcat 启动 tomcat 服务，访问 127.0.0.1:8080 正常

![](img/4eff87ac4ebdb5dab5f95145aee8a95d.png)

    （二）查看是否看起 8009，8080 若果开启证明该漏洞纯在。

       命令 ： netstat -ano

     ![](img/ac9b82072257acec728e8ea027c69cce.png)

  （三）利用 poc //这里我用的是 poc2

     poc1 地址：[`github.com/0nise/CVE-2020-1938`](https://github.com/0nise/CVE-2020-1938)

     poc2 地址：[`github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi`](https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi)

     下载好后进入该文件夹 cmd 命令执行并加上网址参数利用 poc

     注意 poc 为 py2 环境

     命令为：**python ./ CNVD-2020-10487-Tomcat-Ajp-lfi.py 本地 ip –p 8009 –f WEB-INF/web.xml**

     执行成功后可以看到成功访问到该文件。

     ![](img/5c886b771b1f75f0c7283ab90ca97da1.png)

### 0x05 漏洞修复建议

    1、临时禁用 AJP 协议端口，在 conf/server.xml 配置文件中注释掉

     <Connector port="8009" protocol="AJP/1.3"redirectPort="8443" />

    2、配置 ajp 配置中的 secretRequired 跟 secret 属性来限制认证

    3、官方下载最新版下载地址：

       https://tomcat.apache.org/download-70.cgi

       https://tomcat.apache.org/download-80.cgi

       https://tomcat.apache.org/download-90.cgi

       或 Github 下载：[`github.com/apache/tomcat/releases`](https://github.com/apache/tomcat/releases)

# 0x06 AJP 协议规范

    详见 https://tomcat.apache.org/connectors-doc/ajp/ajpv13a.html

### Tanke You！！

   FOFA 访问贼慢，傻蛋也是，百万黑客同时在线。。。

### 批量搞起来，呀呼！

### 博主公众号

![](img/c6c1a4b057b858c88387a767f55d83a4.png)

本文欢迎转载。 如转载请务必注明出处。 觉得写的不错的可以右侧打赏一手。 群在上边欢迎大家来撩。