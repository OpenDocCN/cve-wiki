# CVE-2016-7124漏洞复现 - 娘家人 - 博客园

> 原文：[https://www.cnblogs.com/zy-king-karl/p/11436872.html](https://www.cnblogs.com/zy-king-karl/p/11436872.html)

# CVE-2016-7124漏洞复现

## __wakeup()魔术方法绕过

## 实验环境

操作机：Windows 10

服务器：apache 2.4

数据库：mysql 5.0

PHP版本：5.5

## 漏洞影响版本：

PHP5 < 5.6.25

PHP7 < 7.0.10

## 漏洞产生原因：

如果存在__wakeup方法，调用 unserilize() 方法前则先调用__wakeup方法，但是序列化字符串中表示对象属性个数的值大于 真实的属性个数时会跳过__wakeup的执行

## 漏洞复现

编写测试脚本

Test1.php

![](../Images/8088e745a7eb215e42bf19233506fb90.png)

脚本上标明接收s参数，对其反序列化后输出name属性的值

访问test1.php

根据代码可以看出反序列化之前先调用了__wakeup 方法，再调用_destruct 方法。

![](../Images/e21d0cbe60f3f07522d275182537a80c.png)

将传入的序列化数据的对象变量个数由1更改为2，页面只执行了__destruct方法，而且输出name属性时报错，是由于反序列化数据时失败无法创建对象。

 ![](../Images/a277b3f71a1ff89b3e1ec19ac14b8ffe.png)

## 漏洞利用

更改测试代码

test.php

 ![](../Images/7fe7d9374369f740a3f4afa792a5d55c.png)

其中 __destruct方法在调用时将name参数写入wcute.php文件但是由于__wakeup方法清除了对象属性，所以在调用__destruct时已经没有了name属性，因此文件将会写入失败。

 ![](../Images/a15fa9d0e5aa32c06d1c8fdc42ea96f4.png)

将对象属性个数改为2继续尝试，成功绕过__wakeup方法执行，将代码写入文件

![](../Images/7065337aa43c2d7a89f3cc485f2d997a.png)

 ![](../Images/f861ebaa9750c7a0a936d7e854d67b6e.png)