# （CVE-2017-7494）Samba 远程代码执行[Linux] - 暮日温柔 - 博客园

> 原文：[`www.cnblogs.com/daiorz/p/12019613.html`](https://www.cnblogs.com/daiorz/p/12019613.html)

**简介**

此漏洞是针对开启了共享的 smb 服务

**漏洞利用**

**启动 msfconsole**

**search is_known_pipename   　　搜索此模块**

**![](img/a39d6f27f398beaf3821ae7c8dd8d224.png)**

use exploit/linux/samba/is_known_pipename 调用此模块

配置目标靶机 IP 地址，配置目标靶机文件共享名

![](img/e355a3a0491f3751082a88f478ef021b.png)

rexploit 　　运行

![](img/7ca8143fc5a605f22b21cf46149e8e2e.png)

查看靶机信息   id　 whoam   cat /proc/version

![](img/a423058cd35c7b6183d5a78567e6e1e9.png)

拿到目标后可以进行提权了

**解决漏洞方案**

在靶机上编辑 Samba 服务配置文件 smb.config

vim /etc/samba/smb.conf

在第 76 行添加   nt pipe support = no

![](img/f3281d428dbaebc5e8ef7de61498c501.png)

service smb restart　重启 smb 服务，然后回到渗透机上，重新使用溢出模块对靶机的 smb 服务进行溢出操作，使用命令 rexploit

此时发现利用脚本给出的操作提示：] 172.16.1.29:445-No suitable share and path were found, try setting SMB_SHARE_NAMEand SMB_FOLDER//没有找到合适的共享和路径，尝试设置 Smb_Share_Name 和 SMB_FOLDER 由于我们关闭了 pipe support 会禁用 Windows 客户端的共享列表。所以此处漏洞无法成功进行利用

 ![](img/b442066410cc0d83c2046770b2f4f584.png)