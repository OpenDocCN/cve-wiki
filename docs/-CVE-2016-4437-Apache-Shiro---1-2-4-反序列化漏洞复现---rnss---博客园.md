# （CVE-2016-4437）Apache Shiro <=1.2.4 反序列化漏洞复现 - rnss - 博客园

> 原文：[https://www.cnblogs.com/rnss/p/13575615.html](https://www.cnblogs.com/rnss/p/13575615.html)

# 0x01  漏洞简介

Apache shiro默认使用了`CookieRememberMeManager`，其处理cookie的流程是：得到`rememberMe的cookie值`-->`Base64解码`-->`AES解密`-->`反序列化`。
然而AES的密钥是硬编码的，就导致了攻击者可以构造恶意数据造成反序列化的RCE漏洞。

# 0x02  漏洞影响

Apache Shiro <=1.2.4

# 0x03  复现过程

使用docker搭建环境：[https://www.jianshu.com/p/5e69341157d9](https://www.jianshu.com/p/5e69341157d9)

使用2个工具

第一个：[https://github.com/feihong-cs/ShiroExploit](https://github.com/feihong-cs/ShiroExploit)

![](../Images/2bb0e1f095c61385abfe4b81ab23655d.png)

 具体复现看这篇：[https://www.cnblogs.com/paperpen/p/11312671.html](https://www.cnblogs.com/paperpen/p/11312671.html)

第二个工具：https://github.com/ianxtianxt/ShiroScan

这个工具的Key比上一个更多，因此上一个工具没成功的可以用这个试试

需要import crypto库，这个库在python3中已经没有了

安装pycryptodome库代替，安装之前先把之前安装的crypto库和pycrypto库都卸载掉

![](../Images/799b3215b52fbb4a274842342f1b4a57.png)

 ![](../Images/dde5bee912a75540fb501cdc48e2e36e.png)