# （CVE-2016-4437）Apache Shiro <=1.2.4 反序列化漏洞复现 - rnss - 博客园

> 原文：[`www.cnblogs.com/rnss/p/13575615.html`](https://www.cnblogs.com/rnss/p/13575615.html)

# 0x01  漏洞简介

Apache shiro 默认使用了`CookieRememberMeManager`，其处理 cookie 的流程是：得到`rememberMe 的 cookie 值`-->`Base64 解码`-->`AES 解密`-->`反序列化`。
然而 AES 的密钥是硬编码的，就导致了攻击者可以构造恶意数据造成反序列化的 RCE 漏洞。

# 0x02  漏洞影响

Apache Shiro <=1.2.4

# 0x03  复现过程

使用 docker 搭建环境：[`www.jianshu.com/p/5e69341157d9`](https://www.jianshu.com/p/5e69341157d9)

使用 2 个工具

第一个：[`github.com/feihong-cs/ShiroExploit`](https://github.com/feihong-cs/ShiroExploit)

![](img/2bb0e1f095c61385abfe4b81ab23655d.png)

 具体复现看这篇：[`www.cnblogs.com/paperpen/p/11312671.html`](https://www.cnblogs.com/paperpen/p/11312671.html)

第二个工具：https://github.com/ianxtianxt/ShiroScan

这个工具的 Key 比上一个更多，因此上一个工具没成功的可以用这个试试

需要 import crypto 库，这个库在 python3 中已经没有了

安装 pycryptodome 库代替，安装之前先把之前安装的 crypto 库和 pycrypto 库都卸载掉

![](img/799b3215b52fbb4a274842342f1b4a57.png)

 ![](img/dde5bee912a75540fb501cdc48e2e36e.png)