# 目标主机 showmount -e 信息泄露(CVE-1999-0554)与 NFS 共享目录未授权访问(CVE-1999-0554)修复与验证过程记录 - 迪克推多 0 - 博客园

> 原文：[`www.cnblogs.com/zcg-cpdd/p/14505731.html`](https://www.cnblogs.com/zcg-cpdd/p/14505731.html)

首先放上漏扫结果中对于这两个漏洞的描述及修复建议。

![](img/cca42e26c37e2336022848180343df1e.png)

![](img/12bcba27ae9d1a92add3d2fc6982246b.png)

两个漏洞其实都是 NFS 共享目录信息泄露的漏洞。showmout -e 这个检查的是 rpc.mountd 这个 NFS 的守护进程，rpc.mountd 可以访问文件系统，当客户端顺利地通过 rpc.nfsd 登录 NFS 服务器后，在使用 NFS 服务器所提供的文件前，还必须通过文件使用权限的验证，rpc.mountd 会读取 NFS 的配置文件/etc/exports 来对比客户端的权限。通过类似 showmount -e 这个过程展示 nfs 的挂载列表；第二个漏洞 NFS 这个漏洞，是从协议的角度进行检查的，检查是否对 nfs 端口服务的访问进行了限制。

通过 showmount -e 漏洞可以获取的信息如下,显示出了目标机 nfs 的挂载列表:

![](img/61f374b4bc6b62502c686775c8821136.png)

通过 NFS 共享目录信息泄露漏洞可以获取的信息如下,同样显示出了目标机 nfs 的共享目录及共享 IP:

```
shared dir:/app,shared ip:10.xx.xx.xx/24
```

漏洞修复:

一、除非必要，关闭 NFS 服务  rpc.mountd 进程。

二、如果必须使用 NFS 服务，可采用以下 3 种方式避免信息泄露漏洞:

1.登录 NFS 服务器端所在的机器，修改 hosts 配置文件,vim /etc/hosts.allow 设置允许查询 NFS 共享目录的 IP。

可添加多个（以下假设允许查询的 IP 为 192.168.100.1 等）

```
mountd:192.168.100.1
mountd:192.168.100.2
mountd:192.168.100.3
rpcbind:192.168.100.1
rpcbind:192.168.100.2
rpcbind:192.168.100.3 
```

然后 vim /etc/hosts.deny 设置拒绝除 hosts.allow 以外其他所有 IP 查询共享目录

```
mountd:all
rpcbind:all
```

*2.在 NFS 服务器端 iptables 防火墙配置规则允许特定的 IP 访问 nfs 服务端口，其他全部禁止,vim /etc/sysconfig/iptables。*

可添加多个(假设允许 nfs 客户端 192.168.100.1 访问本机 nfs 服务端的相关 nfs 端口 2049,20048 等)

```
#下面是要添加的规则

#允许 nfs 客户端 192.168.100.1 访问本机 nfs 服务端的相关 nfs 端口
-A INPUT -p tcp -s 192.168.100.1 --dport 2049 -j ACCEPT
-A INPUT -p udp -s 192.168.100.1 --dport 2049 -j ACCEPT
-A INPUT -p tcp -s 192.168.100.1 --dport 20048 -j ACCEPT
-A INPUT -p udp -s 192.168.100.1 --dport 20048 -j ACCEPT

#禁止其他主机访问本机 nfs 服务端的相关 nfs 端口
-A INPUT -p tcp --dport 2049 -j DROP
-A INPUT -p udp --dport 2049 -j DROP
-A INPUT -p tcp --dport 20048 -j DROP
-A INPUT -p udp --dport 20048 -j DROP
COMMIT
```

3.在 NFS 的配置文件/etc/exports 中进行设置，可以定义 NFS 系统的输出目录（即共享目录）、访问权限和允许访问的主机等参数,该文件默认为空。然后启动 NFS 服务即可。

发现一位大佬写的关于 NFS 的配置与应用博客实在是太详细了，自认为写不到那么全面深刻，所以放上链接:

```
https://www.cnblogs.com/nufangrensheng/p/3486839.html
```