# CVE-2019-0232 远程代码执行漏洞-复现 - 小菜鸟当黑客 - 博客园

> 原文：[`www.cnblogs.com/bflw/p/12347137.html`](https://www.cnblogs.com/bflw/p/12347137.html)

### 0x00 漏洞介绍

  该漏洞是由于 Tomcat CGI 将命令行参数传递给 Windows 程序的方式存在错误，使得 CGIServlet 被命令注入影响。

  该漏洞只影响 Windows 平台，要求启用了 CGIServlet 和 enableCmdLineArguments 参数。但是 CGIServlet 和 enableCmdLineArguments 参数默认情况下都不启用。

### 0x01 漏洞影响范围

  Apache Tomcat 9.0.0.M1 to 9.0.17        

  Apache Tomcat 8.5.0 to 8.5.39        

  Apache Tomcat 7.0.0 to 7.0.93

### 0x02 环境 

  VMware 虚拟机 windows 7      

  JDK 1.8.0_73      

Apache tomcat 9.0.13 

### 0x03 复现步骤

### （一）首先安装 JDK（这里我安装的是 JDK 1.8.0_73）然后配置环境变量

    ![](img/5631303988b9af93542453485ee49877.png)

    ![](img/4e066c0854359b2ec032a422b2891ed5.png)

  新建变量名为 JAVA_HOME 的变量变量值为你安装 jdk 的路径

  例：变量名:JAVA_HOME 变量值:C:\Program Files (x86)\Java\jdk1.8.0_73

  新建变量名为 JRE_HOME 的变量变量值为你安装 jdk 文件夹中 jre 文件夹的路径

  例：变量名 JRE_HOME 变量值: C:\Program Files (x86)\Java\jdk1.8.0_73\jre

  新建变量名为 CLASSPATH 的变量变量值为.;%JAVA_HOME%\lib;%JAVA_HOME%\lib\tools.jar(ps:前面有个点)

  在变量 path 新增变量值为;%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin(ps:前面有;)  

  配好变量后打开 cmd 命令框输入 java –version 出现 java 版本号等信息则说明变量安装成功。

   如图：

      ![](img/b1f9b24df1a19aa62489d76e93dbcc64.png)

### （二）安装 tomcat

  这里我用的是 apache - tomcat - 19.0.3

  tomcat 各个版本下载链接：https://archive.apache.org/dist/tomcat/

  安装完成之后，cmd 启动 tomcat

![](img/12fc7f398e6bff29c4afade64bb049cf.png)

打开浏览器访问正常，说明 tomcat 安装完毕。 

![](img/da48bc88155168177c71f38be9077253.png)

### （三）修改配置文件  

  1.apache-tomcat-9.0.13\conf\web.xml  该文件    

   需要取消掉注释的一共是俩部分，并且将下图框中内容插入

![](img/97efac93ae8af870b37e22bef8dc9a85.png)

![](img/bff5a72def7eb5e2582567a03a41051e.png)

  2.conf/context.xml  中的<Context>添加 privileged="true"语句 如下图

![](img/afd7d47035d1224e804db61dd968728b.png)

  3.在 C:\Users\lenovo\Desktop\apache-tomcat-9.0.13\apache-tomcat-9.0.13\webapps\ROOT\WEB-INF    

   下创建一个 cgi-bin 文件夹，并在文件夹内创建一个 bat 文件可以什么都不写或者写一些 bat 语句。

     ![](img/cea84454970a44166d68035338f1cc47.png)

     ![](img/ee49f7298e47b012d8633e67a53c713e.png)

  一切准备完成。

### （四）重启 tomcat。

### （五）利用 payload

  payload：http://localhost:8080/cgi-bin/hello.bat?&C:\Windows\System32\calc.exe

  该 payload 为打开计算器，访问之后成功打开计算器。

   ![](img/bcabe26dd3911479db8e0e6f2261b8f6.png)

### （六）复现成功。

### Tank You ！！

### 博主公众号

![](img/c6c1a4b057b858c88387a767f55d83a4.png)

本文欢迎转载。 如转载请务必注明出处。 觉得写的不错的可以右侧打赏一手。 群在上边欢迎大家来撩。