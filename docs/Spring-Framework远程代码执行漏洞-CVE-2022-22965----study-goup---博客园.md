# Spring Framework 远程代码执行漏洞(CVE-2022-22965) - study_goup - 博客园

> 原文：[`www.cnblogs.com/my-first-blog-lgz/p/16158546.html`](https://www.cnblogs.com/my-first-blog-lgz/p/16158546.html)

转至：https://assbbs.com/thread-29815.htm

漏洞等级 High

CVE 编号 CVE-2022-22965

漏洞描述

Spring Framework 是一个开源应用框架，旨在降低应用程序开发的复杂度。它是轻量级、松散耦合的。它具有分层体系结构，允许用户选择组件，同时还为 J2EE 应用程序开发提供了一个有凝聚力的框架。但是在 JDK9 及以上版本环境中，一些新的版本特性，可以使攻击者绕过一些安全特性，借助某些中间件构造数据包修改敏感文件，达到远程代码执行目的。

漏洞影响排查方法

1.JDK 版本号排查

在业务系统的运行服务器上，Windows 操作系统可在运行中执行 cmd 打开命令行，Linux 操作系统可打开控制台窗口。执行“java -version"命令查看运行的 JDK 版本，如果版本号小于等于 8，则不受此漏洞影响。

2.Spring 框架使用情况排査

a、如果业务系统项目以 war 包形式部署，按照如下的步骤进行判断。

  1）解压 war 包：将 war 文件的后级修改成 .zip 文件。

  2）在解压缩目录下搜索是否存在 spring-beans-*.jar 格式的文件（例如 spring-beans-5.3.16.jar），如存在则说明业务系统使用了 Spring 框架进行开发。

  3）如果 spring-beans-*.jar 文件不存在，则在解压缩目录下搜索 CachedlntrospectionResults.class 文件是否存在，如存在则说明业务系统使用了 Spring 框架进行开发。

b、如果业务系统项目以 jar 包形式独立运行，按照如下的步骤进行判断。

  1）解压 jar 包：将 jar 文件的后缀修改成 zip，解压 zip 文件。

  2）在解压缩目录下搜索是否存在 spring-beans-*.jar 格式的 jar 文件（例如 spring-beans-5.3.16.jar），如存在则说明业务系统使用了 Spring 框架进行开发。

  3）如果 spring-beans-*.jar 文件不存在，则在解压缩目录下搜索 CachedIntrospectionResults.class 文件是否存在，如果存在则说明业务系统使用了 Spring 框架进行开发。

c、综合判断

在完成以上两个步骤排査后，同时满足以下三个条件可确定受此漏洞影响：

1）JDK 版本 >= 9。

2）使用了 Spring 框架或衍生框架。

3）项目中 Controller 参数接收实体类对象并存在代码调用。

解决方案

一、版本升级

目前，Spring 官方已发布漏洞修复版本，请用户及时更新至最新版本。

https://github.com/spring-projects/spring-framework/tags

安全版本：

    Spring Framework == 5.3.18

    Spring Framework == 5.2.20

二、缓解措施

无法升级版本的用户，建议采用以下两个临时方案进行防护。

1. UWAF 防护

在 UWAF 配置中，根据实际业务部署的情况，配置正则规则，对 "class.module.*" 字符串添加过滤规则，在部署过滤规则后，对业务运行情况进行测试，避免产生额外影响。

注意：其中流量特征 "class.module.*" 对大小写不敏感。

2. 临时修复措施

需同时按以下两个步骤进行漏洞的临时修复：

（1）在应用中全局搜索@InitBinder 注解，着看方法体内是否调用 dataBinder.setDisallowedFields 方法，如果发现此代码片段的引入，则在原来的黑名单中添加 { " class.module.*"}。

         注意：如果此代码片段使用较多，需要每个地方都追加。

（2）在应用系统的项目包下新建以下全局类，并保证这个类被 Spring 加载到（推荐在 Controller 所在的包中添加），完成类添加后，需对项目进行重新编译打包和功能验证测试，并重新发布项目。对项目进行重新编译打包和功能验证测试。并重新发布项目。

    import org.springframework.core.annotation.Order;

        import org.springframework.web.bind.WebDataBinder;

        import org.springframework.web.bind.annotation.ControllerAdvice;

        import org.springframework.web.bind.annotation.InitBinder;

        @ControllerAdvice

        @Order(10000)

        public class GlobalControllerAdvice{

             @InitBinder

             public void setAllowedFields(webdataBinder dataBinder){

             String[]abd=new string[]{"class.*","Class.*","*.class.*","*.Class.*"};

             dataBinder.setDisallowedFields(abd);

             }

        }

搜索

复制