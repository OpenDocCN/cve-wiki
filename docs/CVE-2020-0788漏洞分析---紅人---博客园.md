# CVE-2020-0788 漏洞分析 - 紅人 - 博客园

> 原文：[`www.cnblogs.com/feizianquan/p/16491527.html`](https://www.cnblogs.com/feizianquan/p/16491527.html)

### 0x00 漏洞信息

漏洞影响：本地提权

漏洞文件：win32kfull.sys

漏洞函数：NtGdiBitBltInternal

漏洞原因：越界写

漏洞日期：2020 年 3 月 12 日

### 0x01 漏洞分析

在 NtGdiBitBltInternal  写入打印机设备上下文时会调用 UMPDDrvBitBlt

UMPDDrvBitBlt 会调用 3 环 hook 修改调色板大小

回到 0 环 后会调用 CreateXlateObject 申请的堆比预期调色板大小要小 导致写越界

win32kfull!CreateXlateObject+0x3fb:ffff8300`404bf580 4589748754 mov dword ptr [r15+rax*4+54h],r14d  写入越界 ds:002b:fffffcb2`42f590f0=????????调用堆栈列表 nt!DbgBreakPointWithStatusnt!KiBugCheckDebugBreak+0x12nt!KeBugCheck2+0x962nt!KeBugCheckEx+0x107nt!MiSystemFault+0xd88nt!MmAccessFault+0x1f8nt!KiPageFault+0x31awin32kfull!CreateXlateObject+0x3fbwin32kfull!NtGdiBitBltInternal+0xe87win32kfull!NtGdiBitBlt+0x5bnt!KiSystemServiceCopyEnd+0x13win32u!NtGdiBitBlt+0x14