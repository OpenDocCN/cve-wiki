# Drupal 远程代码执行漏洞（CVE-2019-6339）简单复现 - Mke2fs - 博客园

> 原文：[`www.cnblogs.com/mke2fs/p/12631677.html`](https://www.cnblogs.com/mke2fs/p/12631677.html)

1.搭建环境 docker

出于时间考虑，这里采用的是 vulhub 的镜像进行复现的地址 https://vulhub.org/#/environments/drupal/CVE-2019-6339/

![](img/b01091a0e9062183d283b4e86129e3a9.png)

2.poc

https://github.com/thezdi/PoC/blob/master/Drupal/drupal_xss_rce.zip

管理员修改资料处上传头像

![](img/7629c4085b7daa5f843df37fec87cf60.png)

3.先查看一下之前上传的图片的地址

Drupal 的默认文件保存地址是/site/default/files/pictures/xxx-xxx/图片名字

```
phar://./sites/default/files/pictures/2020-04/blog-ZDI-CAN-7232-cat.jpg
```

然后设置一个临时目录

![](img/d424325806e48ddff7851dc7dc75356b.png)

4.查看效果

![](img/1cf6a7224cb7f977100450d69ca524ea.png)

 这里列举出了/etc/passwd，证明是可以执行命令的

5\. 简单分析了一下 poc,然后修改一下

![](img/70a764736873b66a32700bce3c4251e4.png)

这里执行的是一条很简单的命令，稍微替换一下，比如 ps -aux，此时是 7 个字节数，要把 s 对应的字节数目改成 7

![](img/52d9609f6a3c4239af6bb11963f89beb.png)

看一下结果

![](img/47a4391fcd965a1c9933fff509331afa.png)

本来打算写个马的。。。但是 www-data 在这个 html 这个目录下权限是如下

aaa.txt 是通过 rce 在 www-data 权限下的 touch 命令创建的，aa 则是 root 用户创建的

```
-rw-r--r--  1 root     root         43 Apr  4 07:55 aa.txt
-rw-r--r--  1 www-data www-data      0 Apr  4 08:05 aaa.txt

```

有点闹不明白，既然命令可以执行，为什么写不进去文件，打算重新看看，后面再来填坑

**参考文章：**

https://vulhub.org/#/environments/drupal/CVE-2019-6339/