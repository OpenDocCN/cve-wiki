# CVE-2019-2615[2618] 任意文件读取,任意文件上传-getshell - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15747427.html`](https://www.cnblogs.com/peace-and-romance/p/15747427.html)

### 0X00-引言

* * *

买了两本书，一百多，为知识付费我开心😭

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-漏洞描述

* * *

官方描述没找到

比较典型任意文件读取，文件上传

### 0X03-漏洞复现

* * *

`http://192.168.234.128:7001/console/login/LoginForm.jsp`

![image-20211229144157381](img/6bdddc3b8d65da4a0e2a678e6d59a1e4.png)

##### 01-读取登录密码

访问`http://your-ip:7001/hello/file.jsp?path=/etc/passwd`可以成功获取 passwd 文件

![image-20211229144514041](img/c599b40329e7b29a7a5cef38cf04a45e.png)

weblogic 密码使用 AES 加密，对称加密可解密，只要找到加密的密文和秘钥即可

这两个文件均位于 base_domain 下，名为`SerializedSystemIni.dat`和`config.xml`，在本环境中为`./security/SerializedSystemIni.dat`和`./config/config.xml`（基于当前目录`/root/Oracle/Middleware/user_projects/domains/base_domain`）

SerializedSystemIni.dat 是一个二进制文件，用 burp 保存成一个.dat 文件即可

![image-20211229145732275](img/740942f25568e0c4eadb78fbf1c0ab37.png)

获取加密密文-`config.xml`是 base_domain 的全局配置文件

`<node-manager-password-encrypted>`的值，即为加密后的管理员密码

![image-20211229145851624](img/6b2a0b13c12278891de40e4007fa7dcb.png)

工具解密：工具在靶场内

![image-20211229153740440](img/30cc30293e09dbc355bd0299f3bae3db.png)

![image-20211229153809246](img/497375a417018ae4f9d307e3bb801321.png)

若是出现报错-是二进制秘钥存在问题秘钥

burp 访问`/root/Oracle/Middleware/user_projects/domains/base_domain/security/SerializedSystemIni.dat`再导出一次秘钥

若还是出现问题-这里有篇[文章](https://github.com/TideSec/Decrypt_Weblogic_Password)关于 weblogic 解密的

![image-20211229153924714](img/eeef1569973509395bd98e65822aba06.png)

密码知道-用户名知道-登录

```
username：weblogic
password：Oracle@123 
```

![image-20211229155308886](img/c3bc6f074476aa38c667f27b774faf8e.png)

##### 02-上传马(getshell)

点击

![image-20211229160051126](img/94ab3a55c3f861192cff3226cb46cec7.png)

war 包存在靶场中-修改 war 包-先解压

修改 war 包中 WEB-INF 下的 weblogic.xml 文件-目录修改为 shell

![image-20211229171022676](img/415f293b5847dc5c0d857021e0e9a764.png)

要传的马放进 war 包(我的是哥斯拉的马)

![image-20211229171113380](img/e0fb710b92ca1d9405556349bc353682.png)

上传

![image-20211229170057871](img/4595aea2c8072449978f0088fa02ebc1.png)

![image-20211229171241049](img/509f641bf59c26888bbf11ce8240e5da.png)

一路下一步直到命名此部署-修改为 shell-防止目录重合

![image-20211229171413724](img/c9e819a3bb213e73cf835a599713d399.png)

然后下一步直到完成

上传的路径为`http://192.168.234.128:7001/shell/shell.jsp`

哥斯拉连接

![image-20211229171631500](img/9100280e56716dd3ae8d1701655d65a0.png)

![image-20211229171650019](img/bf8d8906a1139b4c5580a3b73229e856.png)

### 0X04-工具检测

* * *

工具地址：[`github.com/Liqunkit/LiqunKit_`](https://github.com/Liqunkit/LiqunKit_)

![image-20211229172453760](img/1c064edb9c2c006cb1709c608184eb49.png)

### 0X05-漏洞防御

* * *

升级版本

### 0X06-免责声明

* * *

仅供学习参考，切勿用于非法用途

### 0X07-参考

* * *

[`vulhub.org/#/environments/weblogic/weak_password/`](https://vulhub.org/#/environments/weblogic/weak_password/)