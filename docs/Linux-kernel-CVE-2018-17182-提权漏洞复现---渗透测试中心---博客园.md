# Linux kernel（CVE-2018-17182）提权漏洞复现 - 渗透测试中心 - 博客园

> 原文：[`www.cnblogs.com/backlion/p/9729914.html`](https://www.cnblogs.com/backlion/p/9729914.html)

##  0x01 漏洞前言

     Google Project Zero 的网络安全研究人员发布了详细信息，并针对自内核版本 3.16 到 4.18.8 以来 Linux 内核中存在的高严重性漏洞的概念验证（PoC）漏洞利用。由白帽黑客 Jann Horn 发现，内核漏洞（CVE-2018-17182）是 Linux 内存管理子系统中的缓存失效错误，导致释放后使用漏洞，如果被利用，可能允许攻击者获得根权限目标系统上的特权。免费使用后（UAF）漏洞是一类内存损坏错误，非特权用户可利用这些错误来破坏或更改内存中的数据，从而导致拒绝服务（系统崩溃）或升级权限以获得管理权限访问系统 Linux 的内核漏洞于 9 月 18 日在 OSS-安全邮件列表中公开，并在第二天在上游支持的稳定内核版本 4.18.9,4.14.71,4.9.128 和 4.4.157 中进行了修补。在 58 年 3 月 16 日版本中也有一个修复程序。为版本 4.15.0-34.37 的 Ubuntu 18.04，内核 linux-image-4.15.0-34-generic 附加了一个丑陋的漏洞。它需(40min~1hour)在弹出 root shell 之前运行。

## 0x02 漏洞影响版本

Linux kernel 4.18.8 及之前版本

## 0x03 漏洞复现

1. 本次复现环境：ubuntu18.04*64  内核版本：linux-image-4.15.0-34-generic

![](img/9e77ea0c095bd0abdab25725eb93660b.png)

2. 添加更新源

sudo vi /etc/apt/sources.list

deb-src  [`mirrors.tuna.tsinghua.edu.cn/help/ubuntu/`](https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/) main restricted

![](img/a39e0c5f322799eefe4c72dda7482fb0.png)

3. 更新操作系统

sudo apt-get update

4\. 更新操作系统

sudo apt-get dist-upgrade

5\. 安装 GCC 和 G++

sudo apt-get install gcc

sudo apt-get install g++

6.新建一个 test 账号

![](img/cb05a7bd0d724d8d34a3603718ab81fa.png)

7.下载利用 exp

git clone [`github.com/backlion/CVE-2018-17182.git`](https://github.com/backlion/CVE-2018-17182.git)

8.进入到 vmacache 目录，删除已编译好的文件。

rm [puppet](https://github.com/backlion/CVE-2018-17182/blob/master/vmacache/puppet "puppet>")  [puppeteer](https://github.com/backlion/CVE-2018-17182/blob/master/vmacache/puppeteer "puppeteer>") [suidhelper](https://github.com/backlion/CVE-2018-17182/blob/master/vmacache/suidhelper "suidhelper>")

![](img/e6942023c1b7ea2f627b9f872056fc50.png)

9.通过运行[compile.sh](https://github.com/backlion/CVE-2018-17182/blob/master/vmacache/compile.sh "compile.sh>")进行编译，当前目录下会生成三个二进制文件分别为：[puppet](https://github.com/backlion/CVE-2018-17182/blob/master/vmacache/puppet "puppet>")， [puppeteer](https://github.com/backlion/CVE-2018-17182/blob/master/vmacache/puppeteer "puppeteer>")，[suidhelper](https://github.com/backlion/CVE-2018-17182/blob/master/vmacache/suidhelper "suidhelper>")

![](img/7b193df64f8fc7dade385e2f597a9423.png)

10.然后切换到普通用户权限 test:

![](img/ef1a035e5187eb8b14aa64102722c2ea.png) 

11.执行二进制提权文件[puppeteer](https://github.com/backlion/CVE-2018-17182/blob/master/vmacache/puppeteer "puppeteer>")，大约需要等 1 到 1 个半小时，最终看到从 test 权限提升为 root 权限。

![](img/e0799603c3a0aefd13cfecf3bac8b407.png)

## 0x04 漏洞修复建议

目前厂商已发布升级补丁以修复漏洞，补丁获取链接：

[`git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=7a9cdebdcc17e426fb5287e4a82db1dfe86339b2`](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=7a9cdebdcc17e426fb5287e4a82db1dfe86339b2)