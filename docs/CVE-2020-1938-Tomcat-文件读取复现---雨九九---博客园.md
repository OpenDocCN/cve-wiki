# CVE-2020-1938 Tomcat 文件读取复现 - 雨九九 - 博客园

> 原文：[`www.cnblogs.com/Rain99-/p/12436126.html`](https://www.cnblogs.com/Rain99-/p/12436126.html)

目录

*   CVE-2020-1938 Tomcat 文件读取复现
    *   漏洞简介
        *   关于 ajp
    *   影响版本
    *   复现
        *   docker 环境
            *   环境搭建
            *   复现
        *   真实环境

# CVE-2020-1938 Tomcat 文件读取复现

## 漏洞简介

apache tomcat 服务器的 8009 端口上的 ajp 协议存在漏洞。
导致未授权用户可以读取 Tomcat 下部署的所有 webapp 目录下的任意文件，。
同时，如果此应用在网站服务中具备上传功能，攻击者也可以先向服务端上传一个含有 JSP 代码的恶意文件，然后利用此漏洞进行文件包含，从而达到代码执行的危害。

### 关于 ajp

![](img/fd7cfade93683175867bb92a196dfc58.png)

## 影响版本

```
ApacheTomcat 9.x < 9.0.31
ApacheTomcat 8.x < 8.5.51
ApacheTomcat 7.x < 7.0.100
ApacheTomcat 6.x 
```

## 复现

### docker 环境

#### 环境搭建

```
docker search tomcat-8.5.32
docker pull duonghuuphuc/tomcat-8.5.32
docker run -d -p 8080:8080 -p 8009:8009 --name ghostcat duonghuuphuc/tomcat-8.5.32
docker port ghostcat 
```

![](img/d8d7982ac12e5eb8f03a7a333735fb3a.png)
![](img/d38fce35e73e7faea5bbfac519e089fb.png)

#### 复现

1.  webapps/ROOT 写入测试文件
    ![](img/a6026482e7b8b228ad2e92ff52b94dc0.png)

2.  exp 读取测试文件
    [`github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi/`](https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi/)
    ![](img/64487e47b22bd50fd20e3ca52af3a647.png)

3.  exp 读取配置文件
    ![](img/c319c7d7d5085e6e01ffa00aad20b912.png)

### 真实环境

[`github.com/Kit4y/CNVD-2020-10487-Tomcat-Ajp-lfi-Scanner`](https://github.com/Kit4y/CNVD-2020-10487-Tomcat-Ajp-lfi-Scanner)

1.  使用 fofa api 获取 100 个相关 ip
2.  使用批量检测脚本检测后，有 46 个 ip 疑似存在漏洞
3.  在某巴西网站检测出漏洞
    ![](img/151628090b09017b30cef4ea75636f22.png)