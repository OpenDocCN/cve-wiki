# IIS_CVE-2017-7269 IIS6.0远程代码执行漏洞复现 - 雨中落叶 - 博客园

> 原文：[https://www.cnblogs.com/yuzly/p/10886461.html](https://www.cnblogs.com/yuzly/p/10886461.html)

CVE-2017-7269 IIS6.0远程代码执行漏洞复现

**一、漏洞描述**

IIS 6.0默认不开启WebDAV,一旦开启了WebDAV,安装了IIS6.0的服务器将可能受到该漏洞的威胁。

**二、影响版本以及利用条件**

Windows 2003 R2开启WebDAV服务的IIS6.0

**三、漏洞环境搭建**

1.  Windows server 2003 R2 安装IIS服务,并且开启了WebDAV
2.  Exp下载地址：https://github.com/zcgonvh/cve-2017-7269
3.  IIS6.exe提权工具
4.  3389.bat

**四、漏洞复现**

1.IIS开启WebDAV

　　![](../Images/5e55d8d293e821e0a6a504fa711650e0.png)

2.github下载exp

　　![](../Images/ec626d83db8bddab025e9a8f263e312d.png)

3.把exp放入到msf中,#注意模块的命名名称,单词之间加下划线

Cp cve-2017-7269.rb  /usr/share/metasploit-framework/modules/exploits/windows/iis/

　　![](../Images/b92849942d239c9b0b0ecfdd8f86ab72.png)

4.使用模块,设置参数

　　![](../Images/36c2e35447e651743b9987f3f24cc6a9.png)

5.开始攻击,获得一个shell，获得的是一个低权限用户   #攻击失败需要恢复快照

　　![](../Images/b1db0df41021ccaa477ca53315176bbb.png)

提权一、iis6.exe提权

6.上传iis6.exe到目标服务器上

　　![](../Images/5fc63f57e0f5c95b44e041bd025de5c1.png)

7.进入shell,查看是否上传成功

　　![](../Images/21d38b04842fc81e660f2eb1fadb7c03.png)

8.执行iis6.exe 

　　![](../Images/a56d9a9087249f4d6c77257ad7563089.png)

9.以使用iis6.exe创建用户，并将其添加到管理员组

　　![](../Images/de5b2ff68f9dfe82a1c51b81825961b3.png)

　　![](../Images/2fcab4ecb9ea801c8af45832ad102df0.png)

10.查看是否开启了3389端口,发现目标主机没有开启

　　![](../Images/7d506566b6bd626dbe68f096ad802929.png)

11.上传开启3389端口的批处理文件

　　![](../Images/98986a80439bd76d03b79b2c555dc02a.png)

12.使用iis6.exe 执行上传的3389.bat文件

　　![](../Images/a6c9f9e969657991276467170eb42e26.png)

13.查看目标是否开启了3389端口,发现目标已经开启

　　![](../Images/9ba9723b33ec295b44185605612515b9.png)

14\. 然后远程桌面连接就可以了

提权二、pr.exe提权

15.或者上传pr.exe到目标主机

　　![](../Images/e7493bc9566b7f10653a661c03d7e2ec.png)

16.创建用户

　　![](../Images/20062cac79008829e4fc69d577a38275.png)

17.把创建的用户加入到管理员组中

　　![](../Images/6e2c9b8e22a88c6c2fb2c7277748c6a8.png)

18.上传3389.bat

　　![](../Images/1ff803240af3e39dba739f89e391e915.png)

19.开启目标的3389端口

　　![](../Images/fe9c72a277560559281a39189e17c2eb.png)

20.查看目标是否开启了3389端口

　　![](../Images/b694022796df82ca4b261f9d492442e4.png)

21.远程桌面连接

　　![](../Images/2e24a9f58c884d90034b5079f88af52a.png)

五、漏洞修复

禁用WebDAV