# Linux Polkit 的一个本地提权漏洞(cve-2021-4034) - -小-白- - 博客园

> 原文：[`www.cnblogs.com/xiongty/p/16009593.html`](https://www.cnblogs.com/xiongty/p/16009593.html)

​

1、漏洞描述：

在 polkit 的 pkexec 工具程序中发现了一个本地权限升级漏洞。
polkit 是用于在类 Unix 操作系统中控制系统范围特权的组件，它为非特权进程提供了与特权进程进行通信的有组织的方式。
polkit 的 pkexec 存在本地权限提升漏洞，已获得普通权限的攻击者可通过此漏洞获取 root 权限。

2、安全版本
所有的主流 Linux 版本均受影响
安全版本：

```
CentOS 系列：
   CentOS 6：polkit-0.96-11.el6_10.2
   CentOS 7：polkit-0.112-26.el7_9.1
   CentOS 8.0：polkit-0.115-13.el8_5.1
   CentOS 8.2：polkit-0.115-11.el8_2.2
   CentOS 8.4：polkit-0.115-11.el8_4.2
Ubuntu 系列：
   Ubuntu 20.04 LTS：policykit-1 - 0.105-26ubuntu1.2
   Ubuntu 18.04 LTS：policykit-1 - 0.105-20ubuntu0.18.04.6
   Ubuntu 16.04 ESM：policykit-1 - 0.105-14.1ubuntu0.5+esm1
   Ubuntu 14.04 ESM：policykit-1 - 0.105-4ubuntu3.14.04.6+esm1
```

![](img/484c72ff503c7f989166c5709e752c90.png "点击并拖拽以移动")

3、漏洞复现-POC

下载地址：[`github.com/berdav/CVE-2021-4034`](https://github.com/berdav/CVE-2021-4034 "https://github.com/berdav/CVE-2021-4034")

使用 centos7.6 版本复现此漏洞

查看默认 polkit 版本，可以看到根据安全版本判断此版本存在该问题

![](img/a0719fc2c71a4aaa5b6bd8521db0f072.png)![](img/484c72ff503c7f989166c5709e752c90.png "点击并拖拽以移动")​

自行创建普通账号，我是用的账号为 test

上传 POC 进行提权

![](img/af5568cd36f5a6d53917df46f7071972.png)![](img/484c72ff503c7f989166c5709e752c90.png "点击并拖拽以移动")​

4、修复

（1）临时解决方案

删除 pkexec 的 SUID 位：

```
chmod 0755 /usr/bin/pkexec
```

![](img/484c72ff503c7f989166c5709e752c90.png "点击并拖拽以移动")

注：suid 设置在 umask 值的第一位，suid 的值为 4，其作用是让执行该命令的用户以该命令拥有者(该组件的拥有者为 root)的权限去执行

（2）升级 polkit 到安全版本

![](img/b6220e582d8bfc7007af7d0cfd2e4dcb.png)![](img/484c72ff503c7f989166c5709e752c90.png "点击并拖拽以移动")​

再次测试  已修复![](img/a98bafaadb591c90ab7b58d66f7a9497.png)![](img/484c72ff503c7f989166c5709e752c90.png "点击并拖拽以移动")​

​