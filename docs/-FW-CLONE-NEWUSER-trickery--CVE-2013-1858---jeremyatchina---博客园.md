# [FW]CLONE_NEWUSER trickery: CVE-2013-1858 - jeremyatchina - 博客园

> 原文：[`www.cnblogs.com/bittorrent/p/3272408.html`](https://www.cnblogs.com/bittorrent/p/3272408.html)

### CLONE_NEWUSER trickery: CVE-2013-1858

Recent kernels (3.8+ something) introduced a feature called
user-namespaces (user-ns, **CLONE_NEWUSER **flag)
in which you can have your own UID 0.
Think of it as a container solution, so you can
set up compartments on a host. A nice thing,
but it has some security implications. In particular
if you mix this feature with **CLONE_FS**, which means
that the file-system state is shared between the
containers (e.g. processes). You suddenly get this:

![](http://2.bp.blogspot.com/-OIsgJhPrN-4/UUCoqRHO5WI/AAAAAAAAAPg/-2bTMD57ooQ/s1600/clown-newuser.jpg)    The problem here is that parent and child share the
FS info (the chroot in this case), but only the child
has got its own user-ns. Since it has the
capability to do the *chroot()* in its own user-ns,
it will succeed doing the *chroot()* syscall but due to
**CLONE_FS**, it will also affect the parent.
Parent however stays in the init user-ns (the user-ns
that is default upon boot and the namespace where you
want to have root).
Getting a rootshell from inside a user controlled chroot
with help from outside processes is straight forward.
  The xSports can be found [here](http://stealth.openwall.net/xSports/clown-newuser.c).
  **Update:**
A CVE has been assigned (CVE-2013-1858) and [a patch](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=e66eded8309ebf679d3d3c1f5820d1f2ca332c71) was made.