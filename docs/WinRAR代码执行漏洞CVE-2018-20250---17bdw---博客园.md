# WinRAR 代码执行漏洞 CVE-2018-20250 - 17bdw - 博客园

> 原文：[`www.cnblogs.com/17bdw/p/10416145.html`](https://www.cnblogs.com/17bdw/p/10416145.html)

## 0x01 分析思路

*   利用 https://github.com/googleprojectzero/winafl 漏洞分析框架模糊测试 WinRAR。
*   几个存档格式的崩溃，例如 RAR，LZH 和 ACE，这些存档格式会导致内存损坏，例如 Out-of-Bounds Write
*   发现 WinRAR 使用名为 unacev2.dll 的 DLL 来解析 ACE 归档文件。快速浏览一下这个 dll 就会发现它是 2006 年没有保护机制的旧版 dll
*   了解 ACE 格式

## 0x02 漏洞细节

漏洞允许提取文件到任意路径并完全忽略目的文件夹，并将提取的文件相对路径作为完全路径。

导致路径遍历漏洞有两个限制：

```
1\. 第一个字符是‘/’、 ‘\’；

2\. ‘*’ 至少应该包含在文件名中一次。位置没有关系。 
```

WinRAR 部分存在路径遍历漏洞：

从 WinRAR 回调函数（ACE_CALLBACK_RETURN_CANCEL）获取中止代码（abort code）后，unacev2.dll 并不中止操作。因为对 WinRAR 回调的返回代码的延迟检查，创建了漏洞利用文件中指定的目录。

提取的文件也会创建在漏洞利用文件指定的完全路径。

## 0x03 利用方式

[`github.com/WyAtu/CVE-2018-20250`](https://github.com/WyAtu/CVE-2018-20250)

![](img/fda4cae366332e15ad22b93e1c587864.png)

## 0x04 效果

桌面上解压或者是右键解压就会复现效果

## 0x05 相关样本 IOC

ModifiedVersion3.rar

6c702c25ec425764a303418b2d3f99ae

## 0x06 参考

[`blog.csdn.net/liqiuman180688/article/details/88052788`](https://blog.csdn.net/liqiuman180688/article/details/88052788)

[`blog.csdn.net/chen_yi_ang/article/details/88395823`](https://blog.csdn.net/chen_yi_ang/article/details/88395823)

[`research.checkpoint.com/extracting-code-execution-from-winrar/`](https://research.checkpoint.com/extracting-code-execution-from-winrar/)

成功获取 WinRAR 19 年历史代码执行漏洞

[`www.anquanke.com/post/id/171403`](https://www.anquanke.com/post/id/171403)