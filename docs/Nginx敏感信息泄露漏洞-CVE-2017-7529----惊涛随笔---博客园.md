# Nginx 敏感信息泄露漏洞（CVE-2017-7529） - 惊涛随笔 - 博客园

> 原文：[`www.cnblogs.com/jtnote/p/7183228.html`](https://www.cnblogs.com/jtnote/p/7183228.html)

2017 年 7 月 11 日，为了修复整数溢出漏洞(CVE-2017-7529)， Nginx 官方发布了 nginx-1.12.1 stable 和 nginx-1.13.3 mainline 版本，并且提供了官方 patch。

当使用 Nginx 并且开启缓存功能时，攻击者可以构造特定 header 头字段，能越界读取到缓存文件的文件头信息。文件头信息中可能会包含 Nginx 代理站点的真实 IP，造成敏感信息泄露。

另外，一些第三方模块可能会因此导致拒绝服务或者当前进程的内存泄漏，但 Nginx 官方暂未发现这样的第三方模块。

此漏洞涉及了 nginx 0.5.6 - 1.13.2 全版本

此漏洞需要在 Nginx 用作代理缓存的情况下才能触发，如基于 Nginx 的 CDN 服务等。

**修复方式:**

**1、升级 Nginx 到最新无漏洞版本，当前 1.13.3,1.12.1 版本中已修复了这个问题。**
**2、临时方案：配置 max_ranges 1;**
**3、使用[百度云加速](https://bsi.baidu.com/stat/redirect?to=http%3A%2F%2Fsu.baidu.com%2F%3Ffrom%3Dbsi/)WAF 防火墙进行防御。**
**4、添加网站至[安全指数](http://bsi.baidu.com/)，及时了解网站组件突发/0day 漏洞。**

**本篇随笔采用第一种修复方式修复此漏洞**

**从官网上下载 nginx-1.13.3.tar.gz,然后上传到 centos7 服务器**

**解压 nginx-1.13.3.tar.gz**

```
tar zxvf nginx-1.13.3.tar.gz
```

进入 nginx-1.13.3 目录

```
cd nginx-1.13.3
```

查看 nginx 原来的配置

```
nginx -V
```

![](img/da3bfb49328eb79584e2704ffdf4f0e7.png)

执行 configure 命令,后面跟上原来 nginx 的配置

![](img/30b9934daf68ad115ad9086d9c8a8524.png)

报错

![](img/08afc2832885966f3f794cd9209b4d2f.png)

改为（有关 dynamic 去掉）

在执行一次

![](img/230203f699a849474be7e45a02c8cf96.png)

这次没有提示 error, 执行 make 令命编译 nginx, 编译好以后 objs 目录下多出一个 nginx 文件，这个就是已编辑好的 nginx 程序

在执行 configure 时可能碰到的几个错误:

1\. rewrite 需要 pcre 支持, 错误提示：./configure: error: the HTTP rewrite module requires the PCRE library.

```
yum -y install pcre-devel
```

2.openssl 导致的错误

```
yum -y install openssl openssl-devel 
```

执行 make 令命编译 nginx, 编译好以后 objs 目录下多出一个 nginx 文件，这个就是已编辑好的 nginx 程序

```
make
```

更改旧的 nginx 程序的名子,并复制新的程序过去,我的旧 nginx 程序放在/usr/sbin/目录中

```
mv /usr/sbin/nginx /usr/sbin/nginx-bak cp objs/nginx /usr/sbin/nginx /usr/sbin/nginx -t
```

执行下面的命令来升级 nginx

```
make upgrade
```

![](img/301dc2ba9ecc60a73b03efc028ed959d.png)

查看 nginx 版本

```
nginx -V
```

![](img/5ad2be2a083fbb7849e921861fd28fe8.png)