# Drupal XSS 漏洞复现（CVE-2019-6341） - kalibb - 博客园

> 原文：[`www.cnblogs.com/lzkalislw/p/16196479.html`](https://www.cnblogs.com/lzkalislw/p/16196479.html)

**1、漏洞介绍：**

方式：通过文件模块或者子系统上传恶意文件触发 XSS 漏洞

参考：https://paper.seebug.org/897/

**2、漏洞危害：**

JS 代码执行（Cookies 资料窃取、会话劫持、钓鱼欺骗、网页挂马等）

**3、漏洞复现：**

kali linux:192.168.4.157

ubuntu :192.168.4.128

docker

该漏洞需要利用 drupal 文件模块上传文件的漏洞，伪造一个图片文件，上传，文件的内容实际是一段 HTML 代码，内嵌 JS，这样其他用户在访问这个链接时，就可能触发 XSS 漏洞。

Drupal 的图片默认存储位置为 `/sites/default/files/pictures/<YYYY-MM>/`，默认存储名称为其原来的名称，所以之后在利用漏洞时，可以知道上传后的图片的具体位置。

使用 PoC 上传构造好的伪造 GIF 文件，PoC 参考[thezdi/PoC](https://github.com/thezdi/PoC/tree/master/Drupal)的 PoC。

kali linux 上输入如下命令，即可使用 PoC 构造样本并完成上传功能，第一个参数为目标 IP 第二个参数为目标端口。

** php ./blog-poc.php 192.168.4.128 8080** 

![](img/1578699d3e4cba53cbff1f359c1dc4c4.png)

 在服务端查看执行的结果：

![](img/a6046fb9c3f6f92d6127b08f75152971.png)

上传成功后，访问图片位置，即可触发 XSS 漏洞，如下图所示。

![](img/3831fa3321798ea292e567fb7b762cfb.png)

Tips:

1.  因为 Chrome 和 FireFox 浏览器自带部分过滤 XSS 功能，所以验证存在时可使用 Edge 浏览器或者 IE 浏览器。
2.  访问的图片名称为 _0 的原因是因为 Drupal 的规则机制，具体原理见[Drupal 1-click to RCE 分析](https://paper.seebug.org/897/)