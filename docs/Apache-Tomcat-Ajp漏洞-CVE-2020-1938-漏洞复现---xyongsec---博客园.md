# Apache-Tomcat-Ajp 漏洞(CVE-2020-1938)漏洞复现 - xyongsec - 博客园

> 原文：[`www.cnblogs.com/xyongsec/p/12340606.html`](https://www.cnblogs.com/xyongsec/p/12340606.html)

# 前言

　　Apache Tomcat 会开启 AJP 连接器,方便与其他 Web 服务器通过 AJP 协议进行交互。由于 Tomcat 本身也内含了 HTTP 服务器，因此也可以视作单独的 Web 服务器。此漏洞为文件包含漏洞，**攻击者可利用该漏洞读取或包含 Tomcat 上所有 webapp 目录下的任意文件，如：****webapp 配置文件、源代码等。**

# ****编号****

　　**CNVD-2020-10487**

**CVE-2020-1938**

# **影响**

        Apache Tomcat = 6

        7 <= Apache Tomcat <7.0.100

        8 <= Apache Tomcat <8.5.51

        9 <= Apache Tomcat <9.0.31

# 复现过程

我这里是使用 docker 拉取 tomcat-8.5.32 环境复现的

docker 搜索 tomcat 镜像

docker search tomcat-8.5.32

![](img/e9554721a27d0543c4e599510426a216.png)

拉取镜像

docker pull duonghuuphuc/tomcat-8.5.32

拉取完成后查看是否拉取成功 

docker images

![](img/ff0d27da9f9bca99aa795229a9592632.png)

运行镜像并映射端口

docker run -d -p 8080:8080 -p 8090:8009 duonghuuphuc/tomcat-8.5.32

并查看是否运行成功

docker ps -a

![](img/9c0e55c08a976036cc1cf88dd6a95d03.png)

成功后访问系统地址

![](img/39ea5d13d851a106d3ec1d94f6845d93.png)

 nmap 一下试试

![](img/0dcc20305cb34c48b37aebaf35f045d9.png)

至此环境搭建成功

# exp1

　　https://github.com/0nise/CVE-2020-1938

# exp2

　　https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi

# 演示

 ![](img/37e70e016d3ff22abb03b4e7cd6a0145.png)

#  修复方案

*   临时禁用 AJP 协议端口，在 conf/server.xm l 配置文件中注释掉<Connector port="8009" protocol="AJP/1.3"redirectPort="8443" />

*   配置 ajp 配置中的 secretRequired 跟 secret 属性来限制认证

*   官方下载最新版下载地址：

https://tomcat.apache.org/download-70.cgi

https://tomcat.apache.org/download-80.cgi

https://tomcat.apache.org/download-90.cgi

https://github.com/apache/tomcat/releases