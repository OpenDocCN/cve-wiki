# Node.js 反序列化漏洞远程执行代码（CVE-2017-5941） - -Zad- - 博客园

> 原文：[`www.cnblogs.com/kuaile1314/p/11371059.html`](https://www.cnblogs.com/kuaile1314/p/11371059.html)

## 实验目的 (转载自 I 春秋  )

了解 Node.js 序列化漏洞原理

掌握利用 Node.js 序列化漏洞进行任意代码执行

漏洞原理

现在我们使用 0.0.4 版本的 node-serialize 进行研究，成功利用的话，不可信输入传递到 unserialize()的时候可以执行任意代码。创建

Payload 最好使用同一模块的 serialize()函数。 我创建了以下 JavaScript 对象，将其传入 serialize() 函数。

![](img/d82a0245b4ede02b9effd875e2dfdd99.png)

运行后得到以下输出：

![](img/ad70fd66988ef3795f145521586fe4f1.png)

现在我们得到序列化的字符串，可以用 unserialize() 函数进行反序列化操作。那么问题来了，怎么代码执行呢？

只有触发对象的 rce 成员函数才可以。 后来我想到可以使用 JavaScript 的立即调用的函数表达式（IIFE）来调用该函数。

如果我们在函数后使用 IIFE 括号 () ，在对象被创建时，函数就会马上被调用。有点类似于 C 中的类构造函数。 现在修改过的

代码经 serialize() 函数马上会被调用。

![](img/49271fe79d0697df54cd440ea73efe0c.png)

运行后得到以下输出：

![](img/bcd09266e91e390cdf36f1620bb949d8.png)

我们知道了，在之前序列化的字符串中函数体后面

加上括号 ()，并将其传入 unserialize() 函数，很幸运，成功执行。那么就有了下面的 exploit： 

![](img/26a71c76f2f945af78f6b4806fdd465e.png)

将其传入 unserialize() 函数，触发代码执行。 

![](img/2c8c7d51b2688b6ab4fd8fa18ddd6f95.png)

运行后得到以下输出： 

![](img/d5e95885844532f172cca03619d94eb4.png)

## 实验环境

操作机：kali linux

目标机：Centos6.5

实验工具 exp.txt:

利用 nodejs 代码执行的代码文件。 

## 实验步骤

首先访问目标机器 http://172.16.12.2 可以看到一个存在 node.js 漏洞的登录界面。 我们使用 nc 监听本地端口，用于接收漏洞环境的反弹 Shell. nc -lv -p 8080 即监听本机 8080 端口 Alt text 将实验工具提供的 exp 代码，下载后修改里面的 <ip> <port>，修改为本机 IP 和 NC 监听的端口号。修改后复制该代码，去尝试到登录界面利用。 Alt text 用户名任意输入，将修改好的 exp 代码复制到密码框点击登录即可。 小提示: 如果代码错误，出现报错导致环境崩溃请从新创建环境，并检测代码错误继续实验 点击登录后，如下图所示：利用成功，已经反弹回一个 shell，并且权限为 root。 

![](img/68f724bad5a33d9a9f6bd2ca7369ecb7.png)