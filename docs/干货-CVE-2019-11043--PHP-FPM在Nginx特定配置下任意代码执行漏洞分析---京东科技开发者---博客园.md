# å¹²è´§|CVE-2019-11043: PHP-FPMåœ¨Nginxç‰¹å®šé…ç½®ä¸‹ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ - äº¬ä¸œç§‘æŠ€å¼€å‘è€… - åšå®¢å›­

> åŸæ–‡ï¼š[https://www.cnblogs.com/jdclouddeveloper/p/11857622.html](https://www.cnblogs.com/jdclouddeveloper/p/11857622.html)

![Alt](../Images/4c421a702454ffc7a936ed3df14ac660.png)

> è¿‘æœŸï¼Œå›½å¤–å®‰å…¨ç ”ç©¶å‘˜Andrew Danauï¼Œåœ¨å‚åŠ å¤ºæ——èµ›ï¼ˆCTF: Capture the
> Flagï¼‰æœŸé—´ï¼Œå¶ç„¶å‘ç°php-fpmç»„ä»¶å¤„ç†ç‰¹å®šè¯·æ±‚æ—¶å­˜åœ¨ç¼ºé™·ï¼šåœ¨ç‰¹å®šNginxé…ç½®ä¸‹ï¼Œç‰¹å®šæ„é€ çš„è¯·æ±‚ä¼šé€ æˆphp-fpmå¤„ç†å¼‚å¸¸ï¼Œè¿›è€Œå¯¼è‡´è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚å½“å‰ï¼Œä½œè€…å·²ç»åœ¨githubä¸Šå…¬å¸ƒäº†ç›¸å…³æ¼æ´ä¿¡æ¯åŠè‡ªåŠ¨åŒ–åˆ©ç”¨ç¨‹åºã€‚é‰´äºNginx+PHPç»„åˆåœ¨Webåº”ç”¨å¼€å‘é¢†åŸŸæ‹¥æœ‰æé«˜çš„å¸‚åœºå æœ‰ç‡ï¼Œè¯¥æ¼æ´å½±å“èŒƒå›´è¾ƒä¸ºå¹¿æ³›ã€‚

#### æ¼æ´æ¦‚è¿°

PHP-FPMåœ¨Nginxç‰¹å®šé…ç½®ä¸‹å­˜åœ¨ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚å…·ä½“ä¸ºï¼š
ä½¿ç”¨Nginx + PHP-FPMæ­å»ºçš„æœåŠ¡å™¨åœ¨ä½¿ç”¨ç±»ä¼¼å¦‚ä¸‹é…ç½®çš„nginx.confæ—¶ï¼š

```
location ~ [^/]\.php(/|$) {
        fastcgi_split_path_info ^(.+?\.php)(/.*)$;
        fastcgi_param PATH_INFO       $fastcgi_path_info;
        fastcgi_pass   php:9000;
        ... 
```

Nginxä¸­fastcgi_split_path_info åœ¨å¤„ç†å­˜åœ¨"\n"(%oA) çš„path_infoæ—¶ï¼Œä¼šå°†ä¼ é€’ç»™PHP-FPMçš„PATH_INFOç½®ä¸ºç©ºï¼ˆPATH_INFO="")ï¼Œå½±å“å…³é”®æŒ‡é’ˆçš„æŒ‡å‘ï¼Œå¯¼è‡´åç»­path_info[0]=0çš„ç½®é›¶æ“ä½œä½ç½®å¯æ§ï¼Œé€šè¿‡æ„é€ ç‰¹å®šé•¿åº¦å’Œå†…å®¹çš„è¯·æ±‚ï¼Œå¯ä»¥è¦†ç›–å†™ç‰¹å®šä½ç½®æ•°æ®ï¼Œæ’å…¥ç‰¹å®šç¯å¢ƒå˜é‡ï¼Œè¿›è€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚

#### æ¼æ´åˆ†æ

é¦–å…ˆï¼Œåˆ†æå…¶è¡¥ä¸ï¼šåœ¨è¿›è¡Œrequest_infoç»“æ„ä½“åˆå§‹åŒ–çš„static void init_request_info(void)å‡½æ•°ä¸­ï¼Œå¢æ·»å¯¹pilen å’Œslençš„å¤§å°æ ¡éªŒï¼Œè§„é¿äº†æŒ‡é’ˆçš„éé¢„æœŸå›æº¯ç§»åŠ¨ã€‚

```
 // php-src/sapi/fpm/fpm/fpm_main.c
     ...
     if (pt) {
        while ((ptr = strrchr(pt, '/')) || (ptr = strrchr(pt, '\\'))) {
             // å¯¹ä¼ å…¥PATH_INFO è¿›è¡Œæ ¡éªŒã€‚é€šè¿‡åˆ¤æ–­æ–‡ä»¶çŠ¶æ€ï¼Œè·å–çœŸå®PATH_INFO
             *ptr = 0;
             f (stat(pt, &st) == 0 && S_ISREG(st.st_mode)) {
             int ptlen = strlen(pt); # Path-translated CONTENT_LENGTH
             int slen = len - ptlen;  //script length
            int pilen = env_path_info ? strlen(env_path_info) : 0;  //Path info é•¿åº¦ 0
            int tflag = 0;
            char *path_info;

            if (apache_was_here) {
                /* recall that PATH_INFO won't exist */
                path_info = script_path_translated + ptlen;
                tflag = (slen != 0 && (!orig_path_info || strcmp(orig_path_info, path_info) != 0));
            } else {
        -       path_info = env_path_info ? env_path_info + pilen - slen : NULL; // é€šè¿‡åç§»è®¾ç½®æ–°env_path_infoï¼Œä½†æ˜¯æœªå¯¹åç§»é‡åšæ ¡éªŒ
        -       tflag = (orig_path_info != path_info);
        +       path_info = (env_path_info && pilen > slen) ? env_path_info + pilen - slen : NULL;
        +       tflag = path_info && (orig_path_info != path_info);
            }

            if (tflag) {
                if (orig_path_info) {
                char old;

                FCGI_PUTENV(request, "ORIG_PATH_INFO", orig_path_info);
                old = path_info[0];
                path_info[0] = 0; //ç½®é›¶æ“ä½œ
                if (!orig_script_name ||
                    strcmp(orig_script_name, env_path_info) != 0) {
                    if (orig_script_name) {
                        FCGI_PUTENV(request, "ORIG_SCRIPT_NAME", orig_script_name);//è§¦å‘å…¥å£
                    }
                    SG(request_info).request_uri = FCGI_PUTENV(request, "SCRIPT_NAME", env_path_info);
                    } else {
                    SG(request_info).request_uri = orig_script_name;
                    }
                    path_info[0] = old;
                }
        ... 
```

å…¶ä¸­

```
 //ä»¥http://localhost/info.php/test?a=bä¸ºä¾‹
     PATH_INFO=/test
     PATH_TRANSLATED=/docroot/info.php/test
     SCRIPT_NAME=/info.php
     REQUEST_URI=/info.php/test?a=b
     SCRIPT_FILENAME=/docroot/info.php
     QUERY_STRING=a=b

     pt = script_path_translated; // = env_script_filename => "/docroot/info.php/test"
    len = script_path_translated_len  // ä¸º"/docroot/info.php/test"

    // ç»è¿‡é‡æ–°è®¡ç®—å¤„ç†å
    int ptlen = strlen(pt); // strlen("/docroot/info.php")
    int pilen = env_path_info ? strlen(env_path_info) : 0;  // å³len(PATH_INFO) "/test"
    int slen = len - ptlen;   // len("/test")

    path_info = env_path_info + pilen - slen; // pilen å–å€¼å¯èƒ½æœª0 æˆ–slen, å³åç§»ä¸º0 æˆ– -N 
```

å¯è§ï¼Œå½“PATH_INFOä¸ºç©ºæ—¶ï¼Œpath_info æŒ‡å‘å‘ç”Ÿå‘å‰åç§»ï¼Œåç§»é•¿åº¦ä¸ºtestçš„é•¿åº¦ã€‚è¿›è€Œpath_info[0] = 0;å¯ä»¥å°†ç‰¹å®šä½ç½® å•å­—èŠ‚ç½®é›¶ã€‚ä½†æ˜¯ï¼Œæ™®é€šä½ç½®çš„ç½®é›¶å¹¶ä¸ä¼šé€ æˆRCEï¼Œè¿›ä¸€æ­¥åˆ©ç”¨éœ€è¦å°†ç‰¹å®šæ§åˆ¶ä½ç½®é›¶ï¼Œä¸”è¯¥æ§åˆ¶ä½æ°å·§èƒ½æ§åˆ¶å†™å…¥ä½ç½®ã€‚request->env->data->posä¾¿æ˜¯è¿™æ ·ä¸€å¤„ä½ç½®ã€‚è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹å„å˜é‡çš„å­˜å‚¨æ–¹å¼ã€‚

é€šè¿‡fastcgiåè®®ä¼ å…¥çš„å„ç¯å¢ƒå˜é‡ä¼šå­˜å‚¨åˆ°_fcgi_request->env è¿™ä¸ªfcgi_hashç»“æ„ä½“ä¸­ï¼Œä¾›åç»­æ‰§è¡Œå–ç”¨ï¼Œç»“æ„å…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š

```
 // php-src/sapi/fpm/fpm/fastcgi.c
     typedef struct _fcgi_hash_bucket {
         unsigned int              hash_value;
         unsigned int              var_len;
         char                     *var;
         unsigned int              val_len;
         char                     *val;
         struct _fcgi_hash_bucket *next;
         struct _fcgi_hash_bucket *list_next;
   } fcgi_hash_bucket;

    typedef struct _fcgi_hash_buckets {
        unsigned int               idx;
        struct _fcgi_hash_buckets *next;
        struct _fcgi_hash_bucket   data[FCGI_HASH_TABLE_SIZE];
    } fcgi_hash_buckets;

    typedef struct _fcgi_data_seg {
        char                  *pos;
        char                  *end;
        struct _fcgi_data_seg *next;
        char                   data[1];
    } fcgi_data_seg;

    typedef struct _fcgi_hash {
        fcgi_hash_bucket  *hash_table[FCGI_HASH_TABLE_SIZE];
        fcgi_hash_bucket  *list;
        fcgi_hash_buckets *buckets;
        fcgi_data_seg     *data;
    } fcgi_hash;
    ...
    /* hash table */
    //åˆå§‹åŒ–æ“ä½œ
    static void fcgi_hash_init(fcgi_hash *h)
    {
        memset(h->hash_table, 0, sizeof(h->hash_table));
        h->list = NULL;
        h->buckets = (fcgi_hash_buckets*)malloc(sizeof(fcgi_hash_buckets));
        h->buckets->idx = 0;
        h->buckets->next = NULL;
        h->data = (fcgi_data_seg*)malloc(sizeof(fcgi_data_seg) - 1 + FCGI_HASH_SEG_SIZE); // é»˜è®¤åˆ†é… (4*8 - 1) + 4096
        h->data->pos = h->data->data; //æŒ‡å‘ç¯å¢ƒå˜é‡åˆå§‹å†™å…¥ä½ç½®
        h->data->end = h->data->pos + FCGI_HASH_SEG_SIZE; æŒ‡å‘//data_segæœ«å°¾
        h->data->next = NULL;
    }
    ... 
```

å…¶ä¸­æˆ‘ä»¬ä¸»è¦å…³æ³¨å…¶ä¸­çš„get/setæ“ä½œï¼Œå®ç°å¦‚ä¸‹ï¼š

```
 static char *fcgi_hash_get(fcgi_hash *h, unsigned int hash_value, char *var, unsigned int var_len, unsigned int *val_len)
     // å…³è” FCGI_GETENV()
     {
         unsigned int      idx = hash_value & FCGI_HASH_TABLE_MASK;
        fcgi_hash_bucket *p = h->hash_table[idx];

         while (p != NULL) {
         //éœ€è¦hast_valueå€¼ç›¸åŒï¼Œvar_lenç›¸åŒæ‰èƒ½å–å‡ºå€¼
             if (p->hash_value == hash_value &&
                p->var_len == var_len &&
                memcmp(p->var, var, var_len) == 0) {
                *val_len = p->val_len;
                return p->val;
            }
            p = p->next;
        }
        return NULL;
    }

    static char* fcgi_hash_set(fcgi_hash *h, unsigned int hash_value, char *var, unsigned int var_len, char *val, unsigned int val_len)
    // å…³è” FCGI_PUTENV()
    {
        unsigned int      idx = hash_value & FCGI_HASH_TABLE_MASK;  // è®¡ç®—hash_valueç¡®å®š index
        fcgi_hash_bucket *p = h->hash_table[idx];  //è·å–åŸæœ‰hash_tableä¸­çš„å¯¹åº”å€¼

        while (UNEXPECTED(p != NULL)) {
            if (UNEXPECTED(p->hash_value == hash_value) &&
                p->var_len == var_len &&
                memcmp(p->var, var, var_len) == 0) {

                p->val_len = val_len;
                p->val = fcgi_hash_strndup(h, val, val_len);
                return p->val;
            }
            p = p->next;
        }

       if (UNEXPECTED(h->buckets->idx >= FCGI_HASH_TABLE_SIZE)) {
            fcgi_hash_buckets *b = (fcgi_hash_buckets*)malloc(sizeof(fcgi_hash_buckets));
            b->idx = 0;
            b->next = h->buckets;
            h->buckets = b;
        }

        p = h->buckets->data + h->buckets->idx;
        h->buckets->idx++;
        p->next = h->hash_table[idx];
        h->hash_table[idx] = p;
        p->list_next = h->list;
        h->list = p;

        p->hash_value = hash_value;
        p->var_len = var_len;
        p->var = fcgi_hash_strndup(h, var, var_len);
        p->val_len = val_len;
        p->val = fcgi_hash_strndup(h, val, val_len);
        return p->val;
    }

    static inline char* fcgi_hash_strndup(fcgi_hash *h, char *str, unsigned int str_len)
    // å®é™…æ“ä½œrequest->env->data,è¿›è¡Œæ•°æ®å†™å…¥ã€‚
    {
        char *ret;

        if (UNEXPECTED(h->data->pos + str_len + 1 >= h->data->end)) {
        //å¦‚æœå‡†å¤‡å†™å…¥çš„æ•°æ®é•¿åº¦å¤§äºå½“å‰æŒ‡å‘çš„fcgi_hash_segå¤§å°ï¼Œåˆ™å‘å‰æ’å…¥æ–°çš„fcgi_hash_seg
                unsigned int seg_size = (str_len + 1 > FCGI_HASH_SEG_SIZE) ? str_len + 1 : FCGI_HASH_SEG_SIZE;//è¾ƒé•¿å€¼ï¼Œä¸è·¨è¶Šä¸¤ä¸ªsegè¿›è¡Œå†™å…¥ã€‚
                fcgi_data_seg *p = (fcgi_data_seg*)malloc(sizeof(fcgi_data_seg) - 1 + seg_size);
                p->pos = p->data;
                p->end = p->pos + seg_size;
                p->next = h->data;
                h->data = p;
            }

            ret = h->data->pos;
           memcpy(ret, str, str_len); //äºh->data->posåå†™å…¥æ•°æ®
            ret[str_len] = 0;
            h->data->pos += str_len + 1; //åç§»h->data->posåˆ°æ–°çš„å¯å†™å…¥ä½ç½®
            return ret;
    } 
```

ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼šrequest->env->data->posçš„æŒ‡å‘ç›´æ¥å½±å“æˆ‘ä»¬ç¯å¢ƒå˜é‡Keyï¼ŒValueçš„å†™å…¥ä½ç½®ï¼Œåªè¦æˆ‘ä»¬æ§åˆ¶äº†char* posçš„æŒ‡å‘ï¼Œå°±å¯èƒ½è¦†ç›–å·²æœ‰çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œè¦æƒ³è¾¾æˆRCEè¿˜å­˜åœ¨ä»¥ä¸‹è¦æ±‚åŠé™åˆ¶ï¼š

1.  æŒ‡é’ˆå‰ç§»å—å½“å‰fcgi_hash_segç©ºé—´ç»“æ„å½±å“ï¼Œè¿‡çŸ­æ— æ³•å°†char*
    posç½®é›¶ï¼Œè¿‡é•¿ä¼šåˆ†é…åˆ°æ–°fcgi_hash_segç©ºé—´ã€‚(å¦‚ä¼ é€’"å½¢å¦‚"[http://127.0.0.1/Somefile_exits/AAAAA.php/](http://127.0.0.1/Somefile_exits/AAAAA.php/)"ä¹Ÿå¯é€ æˆæŒ‡é’ˆåç§»ï¼Œ)

2.  path_info[0] = 0 ä»…èƒ½å°†å•å­—èŠ‚ç½®é›¶ï¼Œæœ€å¥½ä¸ºæœ€ä½ä½ï¼Œå¦åˆ™ä¼šé€ æˆæŒ‡é’ˆä½ç½®åç¦»è¿‡å¤šã€‚

3.  é‰´äºæ¡ä»¶ 2 è¢«è¦†ç›–å†™çš„åœ°å€æœ€ä½ä½åº”ä¸º0ï¼Œä¸”å…¶åä¸ºç¬¦åˆæ¡ä»¶çš„å¯è¦†ç›–çš„ç¯å¢ƒå˜é‡ã€‚

4.  è¢«è¦†ç›–ä½ç½®ç¯å¢ƒå˜é‡çš„keyå¿…é¡»ä¸é¢„æœŸå†™å…¥çš„keyæ»¡è¶³ï¼švarã€hash_valueå’Œvar_lenå‡ç›¸åŒï¼Œæ‰å¯èƒ½è¢«è¯»å–ã€‚

5.  æ‰§è¡ŒFCGI_PUTENV(request, "ORIG_PATH_INFO",
    orig_path_info);æ—¶ï¼Œåˆ†åˆ«å†™å…¥ORIG_SCRIPT_NAMEã€orig_script_nameï¼ˆ"ORIG_SCRIPT_NAME/index.php/PHP_VALUE\nAAAAAA"ï¼‰ã€‚

ç›¸åº”åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1.  é€šè¿‡æ§åˆ¶query_stringçš„é•¿åº¦ï¼Œä½¿path_infoæ°å¥½å¤„äºæ–°fcgi_hash_segçš„dataé¦–ä½ï¼Œè¿™æ—¶æˆ‘ä»¬ä»…éœ€ç§»åŠ¨8+8+8+len("PATH_INFO\0")+N= 34 + Nå³å¯å®Œæˆå¯¹char* posçš„ç¯¡æ”¹ã€‚æ»¡è¶³æ¡ä»¶1ï¼Œ2çš„è¦æ±‚ã€‚
2.  é€šè¿‡è‡ªå®šä¹‰http headerï¼Œæ“çºµrequest headerçš„é•¿åº¦å°†é¢„æœŸè¦†ç›–çš„ç¯å¢ƒå˜é‡æ”¾ç½®åˆ°ç‰¹å®šçš„ä½ç½®ï¼ˆ0x____00+len("ORIG_SCRIPT_NAME")+len("/index.php/")ï¼‰ã€‚æ»¡è¶³æ¡ä»¶3ï¼Œ5è¦æ±‚ã€‚ï¼ˆåœ¨NGINXä¸­ï¼ŒHTTPä¸­çš„è¯·æ±‚å¤´ä¼šä»¥"HTTP_XXX"çš„å½¢å¼ä¼ å…¥PHP-FPMï¼Œéšåå†™å…¥åˆ°request-envä¸­ï¼‰
3.  Expä½œè€…æä¾›äº†EBUTè¿™ä¸ªè‡ªå®šä¹‰å¤´ï¼Œå…¶envå˜é‡åHTTP_EBUTä¸PHP_VALUEåœ¨é•¿åº¦å’Œhash_valueæ–¹é¢ç›¸ç­‰ï¼Œä¸”PHP_VALUEä¼šåœ¨åç»­å¤„ç†ä¸­è¢«å°è¯•è¯»å–(ini =
    FCGI_GETENV(request, "PHP_VALUE")ğŸ˜‰ã€‚æ»¡è¶³æ¡ä»¶4çš„è¦æ±‚ã€‚

![Alt](../Images/cf30c34565a03329c7cedb0d4a5307a1.png)
é™¤æ­¤ä¹‹å¤–ï¼Œé‰´äºPATH_INFOé‡æ–°å–å€¼éƒ¨åˆ†é€»è¾‘ä¸»è¦æ˜¯å¤„ç†PATH_INFOä¸çœŸå®path_infoä¸åŒçš„æƒ…å†µï¼Œå¯¹å¼€å¤´æåŠçš„nginxé…ç½®é¡¹ï¼Œå­˜åœ¨ä¸€ç§æƒ…å†µï¼Œå‘èµ·å½¢å¦‚http://localhost/index/info.php/test?a=bçš„urlï¼Œå¯ä»¥æ„é€ ä»¥ä¸‹åœºæ™¯

```
 //ä»¥http://localhost/index/info.php/test?a=bä¸ºä¾‹ï¼Œindexä¸ºå­˜åœ¨çš„æ–‡ä»¶
     PATH_INFO=/test
     PATH_TRANSLATED=/docroot/index/info.php/test
     SCRIPT_NAME=/index/info.php
     REQUEST_URI=/index/info.php/test?a=b
     SCRIPT_FILENAME=/docroot/index/info.php
     QUERY_STRING=a=b

     pt = script_path_translated; // = env_script_filename => "/docroot/index/info.php/test"
    len = script_path_translated_len  // ä¸º"/docroot/index/info.php/test"

    // ç»è¿‡é‡æ–°è®¡ç®—å¤„ç†å
    int ptlen = strlen(pt); // strlen("/docroot/index")
    int pilen = env_path_info ? strlen(env_path_info) : 0;  // å³len(PATH_INFO) "/test"
    int slen = len - ptlen;   // len("/info.php/test ")

    path_info = env_path_info + pilen - slen;  // pilen < slenï¼Œ å³åç§»ä¸º-N 
```

æ­¤æ—¶URLä¸­æ— éœ€å­˜åœ¨%0Aï¼Œäº¦å¯å®ŒæˆæŒ‡é’ˆç§»ä½ï¼Œæ¼æ´è¿‡ç¨‹ä¸ä¸Šè¿°ç±»ä¼¼ï¼Œä½†æ˜¯å› ä¸ºscript_nameæ— æ•ˆï¼Œæ— æ³•ç›´è§‚æ˜¾ç¤ºæ”»å‡»çŠ¶æ€ï¼Œåˆ©ç”¨éš¾åº¦è¾ƒé«˜ï¼Œä¸å†èµ˜è¿°ã€‚

> path_infoæŒ‡å‘äº†request->env->data->posåçš„å†…å­˜å¸ƒå±€
> ![Alt](../Images/e4da0647d9612082cfc217c44d464c71.png)

#### æ¼æ´åˆ©ç”¨

Expä½œè€…åˆ©ç”¨PHP_VALUEå‘PHPä¼ é€’å¤šä¸ªç¯å¢ƒå˜é‡ï¼Œä½¿PHPäº§ç”Ÿé”™è¯¯ï¼Œä»¥é”™è¯¯æ—¥å¿—çš„å½¢å¼å°†webshellè¾“å‡ºåˆ°/tmp/aï¼Œå¹¶é€šè¿‡auto_prepend_fileè‡ªåŠ¨æ‰§è¡Œ/tmp/aä¸­çš„æ¶æ„ä»£ç ï¼Œè¾¾æˆgetshellã€‚

```
 var chain = []string{
         "short_open_tag=1", //å¼€å¯phpçŸ­æ ‡ç­¾
         "html_errors=0",   // åœ¨é”™è¯¯ä¿¡æ¯ä¸­å…³é—­HTMLæ ‡ç­¾ã€‚
         "include_path=/tmp",  //åŒ…å«è·¯å¾„
         "auto_prepend_file=a",  //æŒ‡å®šè„šæœ¬æ‰§è¡Œå‰è‡ªåŠ¨åŒ…å«çš„æ–‡ä»¶ï¼ŒåŠŸèƒ½ç±»ä¼¼require()ã€‚
         "log_errors=1",  //ä½¿èƒ½é”™è¯¯æ—¥å¿—
         "error_reporting=2",   //æŒ‡å®šé”™è¯¯çº§åˆ«
         "error_log=/tmp/a",  //é”™è¯¯æ—¥å¿—è®°å½•æ–‡ä»¶
         "extension_dir=\"<?=\`\"",   //æŒ‡å®šextensionçš„åŠ è½½ç›®å½•
        "extension=\"$_GET[a]\`?>\"", //æŒ‡å®šåŠ è½½çš„extension
    } 
```

#### å½±å“èŒƒå›´

åœ¨æ–‡åˆæåˆ°çš„é…ç½®ä¸‹ï¼Œè¯¥æ¼æ´å½±å“ä»¥ä¸‹ç‰ˆæœ¬çš„PHPï¼š
7.1.x < 7.1.33
7.2.x < 7.2.24
7.3.x < 7.3.11

#### æ¼æ´ä¿®å¤

å¯ä»¥é€šè¿‡ Nginx å¢æ·»é…ç½®try_files %uri = 404phpè®¾ç½®cgi.fix_pathinfo=0é€‰é¡¹ï¼Œä¸´æ—¶è§„é¿æ¼æ´å½±å“ã€‚ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨å®˜æ–¹å·²ç»é‡Šå‡ºçš„æ›´æ–°è¿›è¡Œå®Œå…¨ä¿®å¤ã€‚

äº¬ä¸œäº‘-WAFç°å·²æ”¯æŒå¯¹è¯¥æ¼æ´çš„é˜²æŠ¤ï¼Œç‚¹å‡»ã€[é˜…è¯»](https://www.jdcloud.com/cn/products/web-application-firewall?utm_source=_cnblogs&utm_medium=Footer&utm_campaign=cnblogs_online_Developer_Community&utm_term=web-application-firewall)ã€‘ï¼Œè·å–æ›´å¤šäº§å“ä¿¡æ¯ã€‚

æ¬¢è¿ç‚¹å‡»â€œ[äº¬ä¸œäº‘](https://developer.jdcloud.com/?utm_source=PMM_cnblogs&utm_medium=Footer&utm_campaign=cnblogs_online_Developer_Community&utm_term=jdcloud)â€äº†è§£æ›´å¤šç²¾å½©

![Alt](../Images/8c85cb2060c49e307eadf6aadbeb743e.png)

![Alt](../Images/2cc4b9b5396a47066369bc21b64df579.png)