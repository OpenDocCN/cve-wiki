# Linux sudo 权限提升漏洞（CVE-2019-14287） - 信安本原 - 博客园

> 原文：[`www.cnblogs.com/wuxinmengyi/p/11678655.html`](https://www.cnblogs.com/wuxinmengyi/p/11678655.html)

# **目录**

0x01 漏洞介绍

0x02 漏洞影响

0x03 漏洞复现

0x04 漏洞细节

0x05 参考

# **0x01 漏洞介绍**

此漏洞可以使受限制的用户运行 root 命令

# **0x02 漏洞影响**

1.8.28 之前的 sudo 版本均会受到影响

此漏洞的利用需要使用户具有 sudo 的权限

# **0x03 漏洞复现**

![file](img/8d120d2d8a40a1d1cb7490cf3253287c.png)

# **0x04 漏洞细节**

因为需要用户拥有 root 权限，这也意味着用户的 sudoers 中的 runas 说明符中具有特殊值 ALL

我们这里来查看一下`/etc/sudoers`

![file](img/85f33ea484136f7b4cc27aca422d1b58.png)

我们可以看到下面几个用户权限的配置信息，它们的含义是这样的

```
授权用户/组 主机=[(切换到哪些用户或组)][是否需要输入密码验证] 命令 1,命令 2 
```

第一个字段中，不以%开头的，代表“将要授权的用户”，例如其中的`root`；以%开头的表示“将要授权的组”，比如其中的`%admin`、`%sudo`

第二个字段表示允许登陆的主机，ALL 表示所有，这里指明的是用户可以在哪些服务器上登陆本服务器来执行 sudo 命令，比如

```
wuxin ALL=/usr/sbin/reboot,/usr/sbin/shutdown 
```

表示的是普通用户 wuxin 在所有主机上，都可以通过 sudo 运行 reboot 和 shutdown 两个命令

第三个字段如果省略的话，表示切换到 root 用户，如果为 ALL，则表示可以切换到任何用户，里面的(ALL:ALL)表示的是允许切换到任何(用户:组)

PS：如果没有省略，必须使用括号将两个值括起来

第四个参数为 NOPASSWD，这个文件中的这个省略掉了，意味着都是需要密码来进行操作的，如果为下面这个样子就不需要输入密码了

```
wuxin ALL=(ALL:ALL) NOPASSWD:ALL 
```

第五个参数为授权操作的命令，如果值为 ALL 的话，就可以执行任意的命令了

这里解释了这么多，也就是说明了我们这个环境下的所有的用户都是可以执行 sudo 的。

在这种情况下，我们就可以使用#uid 语法以任意用户 ID 来运行它

例如执行

```
sudo -u#1234 id -u 
```

将会返回 1234

![file](img/bd558fbddc78726d106ba6582fc32175.png)

但是 sudo 执行前用于更改用户 ID 的 setresuid(2)和 setreuid(2)，特别对待用户 ID-1(或其等效的 4294967295)，不会更改此用户的 ID 值，实际上他们返回的值为 0

![file](img/301846343c33a79967cb9cc8830a1b96.png)

这是因为 sudo 本身已经用用户 ID 0 运行，因此在尝试更改用户 ID 为-1 时，是不会发生任何更改的，另外由于通过-u 指定的用户 ID 在密码数据库是不存在的，因此不会允许任何 PAM 会话模块

# **0x05 参考**

[`www.sudo.ws/alerts/minus_1_uid.html`](https://www.sudo.ws/alerts/minus_1_uid.html)

文章首发公众号：无心的梦呓(wuxinmengyi)

这是一个记录红队学习、信安笔记，个人成长的公众号

扫码关注即可

![file](img/51c0153cd39c2775d41a8c19e7200bc8.png)