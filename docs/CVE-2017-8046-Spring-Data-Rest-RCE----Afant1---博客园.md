# CVE-2017-8046（Spring Data Rest RCE） - Afant1 - 博客园

> 原文：[`www.cnblogs.com/afanti/p/10682316.html`](https://www.cnblogs.com/afanti/p/10682316.html)

环境搭建参考第一个链接，springboot 启动文件如下，不同的启类，将 Application.class 修改一下就可以了，直接 debug。**注意：默认版本是 2.0.3 版本，修改成低版本，看一下 mvn 下载的 jar 包版本**
![Alt text](img/849392b5a71625038bbdd6b74e386c9b.png)
漏洞利用：
第一次请求：
![Alt text](img/c33df6ffa9c44baae13d51fc129d024b.png)
第二次请求：
![Alt text](img/3768a3d5f0ccf1da16a69cd4d366a5c4.png)
注意的点：
需要用 PATCH 方法，而且请求格式为 JSON。根据 RFC 6902，发送 JSON 文档结构需要注意以下两点：
1、请求头为 Content-Type: application/json-patch+json
2、需要参数 op、路径 path，其中 op 所支持的方法很多，如 test，add，replace 等，path 参数则必须使用斜杠分割
下断调试一下，跟入 applyPatch
![Alt text](img/573537759792bdcc233e11a4670628b6.png)
跟入 getPatchOperations
![Alt text](img/ee001ccd113072831b11fee933728517.png)
跟入 convert 函数，来到这里，path 是传入的 EL 表达式
![Alt text](img/72c6f8f337e77678cbab1e54c2e15656.png)
![Alt text](img/3079b13e02ac78713f9397a639b6ea28.png)
![Alt text](img/2a9f44c34d1c4752b83c37bcf191a03f.png)
命令执行的地方
![Alt text](img/e579b673deacd83aa35275167c95c5bf.png)
string 转 bytes[]脚本

```
public class Test
{
    public static void main(String[] args)
    {
        //Original String
        String string = "calc";
        //Convert to byte[]
        byte[] bytes = string.getBytes();
        int i;
        for (i=0;i<bytes.length;i++)
        {
            if (i==0)
            {
                System.out.print("[");
            }
            System.out.print(bytes[i]+",");
            if (i==bytes.length-1)
            {
                System.out.print("]");
            }
        }
    }
} 
```

参考链接：[`www.cnblogs.com/co10rway/p/9380441.html`](https://www.cnblogs.com/co10rway/p/9380441.html)
[`github.com/spring-guides/gs-accessing-data-rest.git`](https://github.com/spring-guides/gs-accessing-data-rest.git)
[`github.com/vulhub/vulhub/tree/master/spring/CVE-2017-8046`](https://github.com/vulhub/vulhub/tree/master/spring/CVE-2017-8046)