# CVE-2019-6340 Drupal8's REST RCE 漏洞复现 - 20181217Cindy - 博客园

> 原文：[`www.cnblogs.com/cindy123456/p/14710447.html`](https://www.cnblogs.com/cindy123456/p/14710447.html)

**0X1 漏洞概述**

Drupal 官方之前更新了一个非常关键的安全补丁，修复了因为接受的反序列化数据过滤不够严格，在开启 REST 的 Web 服务拓展模块的情况下，可能导致 PHP 代码执行的严重安全。

根据官方公告和自身实践，8.6.x 或（<8.6.10）两种情况可能导致问题出现：

*   RESTful Web Services 拓展开启，并且启用了 REST 资源（默认配置即可），不需要区分 GET，POST 等方法即可完成攻击。
*   JSON：API 服务模块开启，此服务尚未分析。

漏洞影响版本：

```
Drupal < 8.6.10Drupal < 8.5.12 
```

**docker 安装：**

**![](img/8ff0358dac6ca503086a5c7e0b1cf2c4.png)**

 ![](img/dbb5b7618a43de948eae681144c65118.png)

 查看 docker 版本

![](img/3a7f9f888a15e58d37669669cc593286.png)

设置每次开机自动开启 docker

 ![](img/14c9ad6d1ea360902753181b38e5aabf.png)

 首先新建一个 docker 组，然后把当前用户加入 docker 组，重启 docker，切换当前会话到新 group，最后测试下效果`docker version。`

**![](img/dd6d60ec45884f08db37989d29c7fbd3.png)**

**0X2 环境搭建**

使用 search‍‍命令进行查找，然后拉取第一个镜像，使用 pull 命令 docker pull knqyf263/cve-2019-6340

 ![](img/388eee6184dff604a953f7e768addbd6.png)

 最后等到拉取完成。

然后启动镜像，运行环境 docker run -d -p 80:80 --name Drupal8 knqyf263/cve-2019-6340

![](img/22888979bb740bdc972d50abd862156a.png)

 ![](img/522786a38eb419938de6c8c385e071f2.png)

Ipconfig 查看：本机 ip 和 dockerip。

![](img/8ea350c7c2a18c23dc69cf2769602380.png)

 访问网站首页

![](img/d840ecd974ff272d48a46a3f19c93c06.png)

在 github 上可以找到关于此 CVE 漏洞编号的很多脚本，但是用法不一，因此，我们使用 rapid 官方给出的脚本进行测试。在 kali 下将 metasploit 更新到最新，使用模块：

 use exploit/unix/webapp/drupal_restws_unserialize，然后 show options 查看一下：

![](img/5a2bfbd8fad079d07a2551102592c99a.png)

设置 RHOSTS 参数和 LHOST 参数

![](img/b817aa106fcbdd5d2a53667a82418748.png)

 ![](img/dcfc75e0384723a6ed8084efd45d96e0.png)

Exploit 攻击成功！可以查看 shell~~

![](img/6c484683b94008b92debee6232fb16c9.png)

 或者查看一下网页目录~

![](img/7bc03a1b2165e77906a968351a9a1f89.png)