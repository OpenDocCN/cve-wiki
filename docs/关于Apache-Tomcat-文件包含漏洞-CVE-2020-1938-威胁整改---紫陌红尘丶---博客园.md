# 关于 Apache Tomcat 文件包含漏洞（CVE-2020-1938）威胁整改 - 紫陌红尘丶 - 博客园

> 原文：[`www.cnblogs.com/yukarin/p/12344612.html`](https://www.cnblogs.com/yukarin/p/12344612.html)

1、昨天收到关于这个漏洞的整改通告（[`mp.weixin.qq.com/s/qIG_z9imxdLUobviSv7knw`](https://mp.weixin.qq.com/s/qIG_z9imxdLUobviSv7knw)），考虑到版本升级可能带来其他问题，所以采用如下方式：

![image](https://img2018.cnblogs.com/blog/1929150/202002/1929150-20200222113134617-1984194959.png)

2、用的 apache-tomcat-8.5.47.tar.gz，修改 server.xml 配置。

注意:这里不能直接用 RAR 或者 360ZIP 进行修改，这样会导致包出问题，我就是踩了这个低级错误坑。导致报(

org.apache.coyote.AbstractProtocol.pause Pausing ProtocolHandler ["ajp-nio-8009"]

172.20.11.14921-Feb-2020 16:20:25.952 WARNING [localhost-startStop-2] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application [] appears to have started a thread named [pool-2-thread-1] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:

)的错误。

有两种方式修改：

①window 上下载 7zip 修改；

②在 linux 上修改，tar.gz 格式：
【压缩】：tar -zcvf 目录文件名.tar.gz 目录文件名
【解压】：tar -zxvf 目录文件名.tar.gz

3、修改完配置之后，传到 docker 打镜像的服务器上任意目录；

```
①备份原有镜像到本地当前目录：

docker save tomcat:8 -o tomat-8.tar

还原镜像只需在镜像所在目录执行：

docker load -i tomat-8.tar

②打镜像：

docker build -t tomcat:8 .     （注意有个.）

③之后重新打应用镜像包发布即可；
```

4、验证：

进入镜像，进入/opt/apache-tomcat-8.5.47，找到 server.xml，查看修改的配置有无生效；

![image](https://img2018.cnblogs.com/blog/1929150/202002/1929150-20200222113147218-400325261.png)