# CVE-2020-0796 - kalibb - 博客园

> 原文：[`www.cnblogs.com/lzkalislw/p/12817670.html`](https://www.cnblogs.com/lzkalislw/p/12817670.html)

CVE-2020-0796 SMBv3 漏洞复现

0X00 漏洞简介

Microsoft Windows 和 Microsoft Windows Server 都是美国微软（Microsoft）公司的产品，Microsoft Windows 是一套个人设备使用的操作系统，Microsoft Windows Server 是一套服务器操作系统，Server Message Block 是其中的一个服务器信息传输协议。

微软公布了在 Server Message Block 3.0（SMBv3）中发现的“蠕虫型”预授权远程代码执行漏洞。

0X01 漏洞概述

**(CVE-2020-0796 SMBGhost)**该漏洞是由于 SMBv3 协议在处理恶意的压缩数据包时出错所造成的，它可让远程且未经身份验证的攻击者在目标系统上执行任意代码。

0X02 影响版本

适用于 32 位系统的 Windows 10 版本 1903

Windows 10 1903 版（用于基于 x64 的系统）

Windows 10 1903 版（用于基于 ARM64 的系统）

Windows Server 1903 版（服务器核心安装）

适用于 32 位系统的 Windows 10 版本 1909

Windows 10 版本 1909（用于基于 x64 的系统）

Windows 10 1909 版（用于基于 ARM64 的系统）

Windows Server 版本 1909（服务器核心安装）

0X03 环境搭建

可在虚拟机中搭建 win10 系统来进行复现。如有需要可留言获取 iso 文件。

0X04 漏洞检测

漏洞检测脚本有很多这里简单分享俩个。

gitHub 检测工具：[`github.com/ollypwn/SMBGhost`](https://github.com/ollypwn/SMBGhost)

某信 cert 检测工具私聊可获取。

某检测工具演示：

![](img/2a2b40d29b31f92aee8ef266a18a0949.png)

Ip 地址为 win10 地址，本地测试是需关闭 win10 防火墙成可 ping 通状态。

0X05 漏洞攻击

现在已有蓝屏 poc，poc 私聊获取。

安装好 poc 所需依赖库后即可进行攻击。

![](img/555fca6789cef5046b9bc2c7baec9d68.png)

攻击后，受攻击机器蓝屏

![](img/20c716075ca21d5760a2d0994ed4aea6.png)

0X06 漏洞修复

目前厂商已发布升级补丁以修复漏洞，补丁获取链接：

[`portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0796`](https://portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0796)

或者你可以使用以下 PowerShell 命令禁用 SMBv3 服务的压缩（无需重新启动）：

```
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" DisableCompression -Type DWORD -Value 1 –Force
```

此外你还可以通过禁止 SMB 的流量流向外网来防御攻击。

转载自 https://www.cnblogs.com/L0ading/p/12519325.html

CVE-2020-0796 SMBv3 漏洞复现

0X00 漏洞简介

Microsoft Windows 和 Microsoft Windows Server 都是美国微软（Microsoft）公司的产品，Microsoft Windows 是一套个人设备使用的操作系统，Microsoft Windows Server 是一套服务器操作系统，Server Message Block 是其中的一个服务器信息传输协议。

微软公布了在 Server Message Block 3.0（SMBv3）中发现的“蠕虫型”预授权远程代码执行漏洞。

0X01 漏洞概述

**(CVE-2020-0796 SMBGhost)**该漏洞是由于 SMBv3 协议在处理恶意的压缩数据包时出错所造成的，它可让远程且未经身份验证的攻击者在目标系统上执行任意代码。

0X02 影响版本

适用于 32 位系统的 Windows 10 版本 1903

Windows 10 1903 版（用于基于 x64 的系统）

Windows 10 1903 版（用于基于 ARM64 的系统）

Windows Server 1903 版（服务器核心安装）

适用于 32 位系统的 Windows 10 版本 1909

Windows 10 版本 1909（用于基于 x64 的系统）

Windows 10 1909 版（用于基于 ARM64 的系统）

Windows Server 版本 1909（服务器核心安装）

0X03 环境搭建

可在虚拟机中搭建 win10 系统来进行复现。如有需要可留言获取 iso 文件。

0X04 漏洞检测

漏洞检测脚本有很多这里简单分享俩个。

gitHub 检测工具：[`github.com/ollypwn/SMBGhost`](https://github.com/ollypwn/SMBGhost)

某信 cert 检测工具私聊可获取。

某检测工具演示：

![](img/2a2b40d29b31f92aee8ef266a18a0949.png)

Ip 地址为 win10 地址，本地测试是需关闭 win10 防火墙成可 ping 通状态。

0X05 漏洞攻击

现在已有蓝屏 poc，poc 私聊获取。

安装好 poc 所需依赖库后即可进行攻击。

![](img/555fca6789cef5046b9bc2c7baec9d68.png)

攻击后，受攻击机器蓝屏

![](img/20c716075ca21d5760a2d0994ed4aea6.png)

0X06 漏洞修复

目前厂商已发布升级补丁以修复漏洞，补丁获取链接：

[`portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0796`](https://portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0796)

或者你可以使用以下 PowerShell 命令禁用 SMBv3 服务的压缩（无需重新启动）：

```
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" DisableCompression -Type DWORD -Value 1 –Force
```

此外你还可以通过禁止 SMB 的流量流向外网来防御攻击。

转载自 https://www.cnblogs.com/L0ading/p/12519325.html