# CVE-2020-0796 - kalibb - 博客园

> 原文：[https://www.cnblogs.com/lzkalislw/p/12817670.html](https://www.cnblogs.com/lzkalislw/p/12817670.html)

CVE-2020-0796 SMBv3漏洞复现

0X00漏洞简介

Microsoft Windows和Microsoft Windows Server都是美国微软（Microsoft）公司的产品，Microsoft Windows是一套个人设备使用的操作系统，Microsoft Windows Server是一套服务器操作系统，Server Message Block是其中的一个服务器信息传输协议。

微软公布了在Server Message Block 3.0（SMBv3）中发现的“蠕虫型”预授权远程代码执行漏洞。

0X01漏洞概述

**(CVE-2020-0796 SMBGhost)**该漏洞是由于SMBv3协议在处理恶意的压缩数据包时出错所造成的，它可让远程且未经身份验证的攻击者在目标系统上执行任意代码。

0X02影响版本

适用于32位系统的Windows 10版本1903

Windows 10 1903版（用于基于x64的系统）

Windows 10 1903版（用于基于ARM64的系统）

Windows Server 1903版（服务器核心安装）

适用于32位系统的Windows 10版本1909

Windows 10版本1909（用于基于x64的系统）

Windows 10 1909版（用于基于ARM64的系统）

Windows Server版本1909（服务器核心安装）

0X03环境搭建

可在虚拟机中搭建win10系统来进行复现。如有需要可留言获取iso文件。

0X04漏洞检测

漏洞检测脚本有很多这里简单分享俩个。

gitHub检测工具：[https://github.com/ollypwn/SMBGhost](https://github.com/ollypwn/SMBGhost)

某信cert检测工具私聊可获取。

某检测工具演示：

![](../Images/2a2b40d29b31f92aee8ef266a18a0949.png)

Ip地址为win10地址，本地测试是需关闭win10防火墙成可ping通状态。

0X05漏洞攻击

现在已有蓝屏poc，poc私聊获取。

安装好poc所需依赖库后即可进行攻击。

![](../Images/555fca6789cef5046b9bc2c7baec9d68.png)

攻击后，受攻击机器蓝屏

![](../Images/20c716075ca21d5760a2d0994ed4aea6.png)

0X06漏洞修复

目前厂商已发布升级补丁以修复漏洞，补丁获取链接：

[https://portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0796](https://portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0796)

或者你可以使用以下PowerShell命令禁用SMBv3服务的压缩（无需重新启动）：

```
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" DisableCompression -Type DWORD -Value 1 –Force
```

此外你还可以通过禁止SMB的流量流向外网来防御攻击。

转载自https://www.cnblogs.com/L0ading/p/12519325.html

CVE-2020-0796 SMBv3漏洞复现

0X00漏洞简介

Microsoft Windows和Microsoft Windows Server都是美国微软（Microsoft）公司的产品，Microsoft Windows是一套个人设备使用的操作系统，Microsoft Windows Server是一套服务器操作系统，Server Message Block是其中的一个服务器信息传输协议。

微软公布了在Server Message Block 3.0（SMBv3）中发现的“蠕虫型”预授权远程代码执行漏洞。

0X01漏洞概述

**(CVE-2020-0796 SMBGhost)**该漏洞是由于SMBv3协议在处理恶意的压缩数据包时出错所造成的，它可让远程且未经身份验证的攻击者在目标系统上执行任意代码。

0X02影响版本

适用于32位系统的Windows 10版本1903

Windows 10 1903版（用于基于x64的系统）

Windows 10 1903版（用于基于ARM64的系统）

Windows Server 1903版（服务器核心安装）

适用于32位系统的Windows 10版本1909

Windows 10版本1909（用于基于x64的系统）

Windows 10 1909版（用于基于ARM64的系统）

Windows Server版本1909（服务器核心安装）

0X03环境搭建

可在虚拟机中搭建win10系统来进行复现。如有需要可留言获取iso文件。

0X04漏洞检测

漏洞检测脚本有很多这里简单分享俩个。

gitHub检测工具：[https://github.com/ollypwn/SMBGhost](https://github.com/ollypwn/SMBGhost)

某信cert检测工具私聊可获取。

某检测工具演示：

![](../Images/2a2b40d29b31f92aee8ef266a18a0949.png)

Ip地址为win10地址，本地测试是需关闭win10防火墙成可ping通状态。

0X05漏洞攻击

现在已有蓝屏poc，poc私聊获取。

安装好poc所需依赖库后即可进行攻击。

![](../Images/555fca6789cef5046b9bc2c7baec9d68.png)

攻击后，受攻击机器蓝屏

![](../Images/20c716075ca21d5760a2d0994ed4aea6.png)

0X06漏洞修复

目前厂商已发布升级补丁以修复漏洞，补丁获取链接：

[https://portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0796](https://portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0796)

或者你可以使用以下PowerShell命令禁用SMBv3服务的压缩（无需重新启动）：

```
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" DisableCompression -Type DWORD -Value 1 –Force
```

此外你还可以通过禁止SMB的流量流向外网来防御攻击。

转载自https://www.cnblogs.com/L0ading/p/12519325.html